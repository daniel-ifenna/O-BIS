module.exports=[36733,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(72131),e=a.i(50944),f=a.i(40695),g=a.i(3130),h=a.i(2150),i=a.i(21958),j=a.i(13749),k=a.i(84505);let l=(0,a.i(70106).default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);var m=a.i(58042),n=a.i(94222),o=a.i(54419),p=a.i(27034),q=a.i(2274),r=a.i(48662),s=a.i(48280),t=a.i(77924),u=a.i(68544),v=a.i(62931),w=a.i(85850),x=a.i(72844),y=a.i(77687);function z(){let{id:a}=(0,e.useParams)(),{getProject:z,setProjectStatus:A}=(0,w.useProjects)(),[B,C]=(0,d.useState)([]),[D,E]=(0,d.useState)([]),[F,G]=(0,d.useState)(!1),[H,I]=(0,d.useState)(0);(0,d.useEffect)(()=>{(async()=>{try{let b=await fetch(`/api/projects/${a}/daily-reports`);b.ok&&C(await b.json())}catch{}try{let b=await fetch(`/api/projects/${a}/milestones`);if(b.ok){let a=await b.json();E(a.map(a=>({id:a.id,name:a.name,weight:Number(a.weight)||0,progress:Number(a.progress)||0,status:a.status||"Pending"})))}}catch{}G(!0)})()},[a]);let J=z(a),K=J?.createdAt?new Date(J.createdAt):null,L=K?Math.max(0,Math.floor((Date.now()-K.getTime())/864e5)):0,M=J?.acceptedBidDays?Number(J.acceptedBidDays):J?.bidDays?Number(J.bidDays):0,N=J?.budget?(0,x.formatNaira)(J.budget):(0,x.formatNaira)(0),O={name:J?.title||"",location:J?.location||"",budget:N,contractorBudget:N,daysElapsed:L,plannedDays:M,status:J?.status||""},P=D.reduce((a,b)=>a+b.weight*b.progress/100,0),Q=K||new Date,R=a=>{let b=new Date(a);return isNaN(b.getTime())?null:b},S=(a,b)=>new Date(a.getTime()+24*b*36e5),T=(a,b)=>Math.max(0,Math.floor((b.getTime()-a.getTime())/864e5))+1,U=D.map(a=>({...a,s:R(a.startDate),e:R(a.endDate)})).filter(a=>a.weight>0&&a.s&&a.e&&a.e.getTime()>=a.s.getTime()),V=U.length?U.reduce((a,b)=>b.s<a?b.s:a,U[0].s):Q,W=Math.max(1,T(V,U.length?U.reduce((a,b)=>b.e>a?b.e:a,U[0].e):S(Q,Math.max(0,(M||56)-1)))),X=Math.max(1,Math.ceil(W/7)),Y=U.reduce((a,b)=>a+(Number(b.weight)||0),0)||100,Z=U.map(a=>({...a,nWeight:(Number(a.weight)||0)*(100/Y)})),$=Array.from({length:W},()=>0);Z.forEach(a=>{let b=a.s,c=a.e,d=Math.max(1,T(b,c)),e=a.nWeight/d;for(let a=0;a<W;a++){let d=S(V,a);d.getTime()>=b.getTime()&&d.getTime()<=c.getTime()&&($[a]+=e)}});for(let a=1;a<$.length;a++)$[a]=Math.min(100,$[a]+$[a-1]);let _={};(B||[]).map(a=>({date:new Date(a.date||Q),progress:Number(a.workPercentage||0)})).forEach(a=>{let b=Math.max(0,Math.floor((a.date.getTime()-V.getTime())/6048e5));_[b]=Math.max(_[b]||0,a.progress)});let aa=Array.from({length:X}).map((a,b)=>{let c=Math.min(100,Math.round($[Math.min(W-1,(b+1)*7-1)]||$[$.length-1]||0)),d=Math.min(100,Math.round(_[b]??(b>0?_[b-1]??0:0)));return{week:`W${b+1}`,planned:c,actual:d}});Array.from({length:X}).map((a,b)=>{let c=Math.max(0,Math.min(Math.max(0,M||0),(b+1)*7)),d=Math.max(0,Math.min(L,(b+1)*7));return{week:`W${b+1}`,plannedDays:c,actualDays:d}});let ab=aa.length>0?aa[aa.length-1]:{planned:0,actual:0},ac=L>0?Math.min(1,Math.max(0,Math.min(L,Math.max(0,M||0))/L)):0,ad=Math.max(0,L>0?(L-Math.min(L,Math.max(0,M||0)))/Math.max(1,Math.min(L,Math.max(0,M||0)))*100:0),ae=ac>=1?"Green":ac>=.95?"Amber":"Red",af=K?new Date(K.getTime()+24*Math.max(0,M||0)*36e5):null,ag=Math.min(L,Math.max(0,M||0)),ah=(()=>{try{let a=JSON.parse("[]"),b=[];if(Array.isArray(a))for(let c of a){let a=Number(c?.timestamp||Date.parse(c?.ts||""))||Date.now(),d=Number(c?.daysElapsed??c?.actualDays??0),e=Number(c?.plannedDays??0),f=Number(c?.actualDays??0),g=Number(c?.sv??e-f),h=String(c?.rag||"");b.push({timestamp:a,daysElapsed:d,plannedDays:e,actualDays:f,sv:g,rag:h.toLowerCase()})}return b}catch{return[]}})(),ai=ah.map(a=>a.daysElapsed),aj=ah.map(a=>a.sv),ak=a=>a.length?a.reduce((a,b)=>a+b,0)/a.length:0,al=ak(ai),am=ak(aj),an=ai.reduce((a,b,c)=>a+(b-al)*((aj[c]??0)-am),0),ao=ai.reduce((a,b)=>a+(b-al)*(b-al),0),ap=0!==ao?an/ao:0,aq=am-ap*al,ar=Math.max(0,M||0),as=Math.abs(ap)>.01?ap*ar+aq:0,at=Math.max(0,Math.round(Math.max(1,ar-as)-L)),au=new Date(Date.now()+24*at*36e5),av=(()=>{if(!K||M<=0)return ae;let a=Math.max(0,Math.floor((au.getTime()-af.getTime())/864e5)),b=M>0?a/M*100:0;return 0===b?"Green":b<=5?"Amber":"Red"})(),aw=ah.slice().sort((a,b)=>a.daysElapsed-b.daysElapsed),ax=Array.from({length:Math.max(1,Math.ceil(Math.max(1,ar)/7)+1)}).map((a,b)=>{let c=Math.min(ar,7*b),d=Math.min(ar,c),e=ap*c+aq,f=Math.min(ar,Math.max(0,d-(a=>{let b=0;for(let c=0;c<aw.length;c++){let d=aw[c];if(d.daysElapsed<=a)b=d.sv;else break}return b})(c))),g=Math.min(ar,Math.max(0,d-e));return{x:c,planned:d,regression:g,actual:f}});return(0,d.useEffect)(()=>{try{let a=Math.max(0,Math.min(ag,L))-L,b=a>=0?"green":a>=-.05*Math.max(1,ag)?"amber":"red",c={timestamp:Date.now(),daysElapsed:L,plannedDays:Math.max(0,M||0),actualDays:L,sv:a,rag:b},d=JSON.parse("[]");[c,...Array.isArray(d)?d:[]].slice(0,200)}catch{}"Amber"===ae?(0,y.toast)({title:"Schedule alert",description:`Slight delay detected (${ad}%). Monitor closely.`}):"Red"===ae&&(0,y.toast)({title:"Schedule risk",description:`Significant delay (${ad}%). Immediate action required.`})},[a,ab.planned,ab.actual,ad,ae]),(0,d.useEffect)(()=>{Math.round(P)>=100&&A(a,"Completed")},[P,a,A]),(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-40",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(c.default,{href:`/manager/project/${a}`,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(j.ChevronLeft,{className:"w-5 h-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Project Overview"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:O.name})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{fetch(`/api/reports/project-overview/${a}/pdf`).then(async a=>{if(!a.ok)return;let b=await a.blob(),c=document.createElement("a");c.href=URL.createObjectURL(b),c.download=`Project_Overview_${(O.name||"Project").replace(/[^a-z0-9_-]+/gi,"_")}.pdf`,document.body.appendChild(c),c.click(),document.body.removeChild(c)}).catch(()=>{})},children:[(0,b.jsx)(k.Download,{className:"w-4 h-4 mr-1"}),"Export PDF"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{try{let a=`Project Overview – ${O.name||"Project"}`;navigator.share&&navigator.share({title:a,url:""})}catch{}},children:[(0,b.jsx)(l,{className:"w-4 h-4 mr-1"}),"Share"]})]})]})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,b.jsx)(g.Card,{className:"bg-gradient-to-r from-primary/10 to-accent/10 border-primary/30 mb-8",children:(0,b.jsx)(g.CardContent,{className:"pt-8",children:(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Overall Project Progress"}),(0,b.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,b.jsxs)("span",{className:"text-5xl font-bold text-primary",children:[Math.round(P),"%"]}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Complete"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Progress,{value:P,className:"h-4 mb-4"}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Days Elapsed"}),(0,b.jsxs)("p",{className:"font-semibold",children:[O.daysElapsed,"/",O.plannedDays]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Budget"}),(0,b.jsx)("p",{className:"font-semibold",children:O.budget})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Status"}),(0,b.jsx)("p",{className:"font-semibold text-accent",children:O.status})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm mt-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Planned End"}),(0,b.jsx)("p",{className:"font-semibold",children:af?af.toLocaleDateString():"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Predicted Completion"}),(0,b.jsx)("p",{className:"font-semibold",children:au?au.toLocaleDateString():"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"RAG (Schedule)"}),(0,b.jsx)("p",{className:"font-semibold",children:av})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"SPI"}),(0,b.jsx)("p",{className:"font-semibold",children:ac.toFixed(2)})]})]})]})]})})}),(0,b.jsxs)(i.Tabs,{defaultValue:"milestones",className:"space-y-6",children:[(0,b.jsxs)(i.TabsList,{children:[(0,b.jsx)(i.TabsTrigger,{value:"milestones",children:"Milestone Tracker"}),(0,b.jsx)(i.TabsTrigger,{value:"variance",children:"Schedule Variance"}),(0,b.jsx)(i.TabsTrigger,{value:"activities",children:"Activity Log"})]}),(0,b.jsx)(i.TabsContent,{value:"milestones",children:(0,b.jsxs)(g.Card,{className:"bg-card/60 border-border/50",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Weighted Milestone Tracker"}),(0,b.jsx)(g.CardDescription,{children:"Weight % | Actual Progress % | Weighted Contribution | Status"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:D.map(a=>(0,b.jsxs)("div",{className:"pb-4 border-b border-border last:border-0",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold",children:a.name}),(0,b.jsxs)("div",{className:"flex gap-6 mt-1 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Weight: ",a.weight,"%"]}),(0,b.jsxs)("span",{children:["Progress: ",a.progress,"%"]}),(0,b.jsxs)("span",{className:"font-semibold text-primary",children:["Contribution: ",(a.weight*a.progress/100).toFixed(1),"%"]})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs font-semibold ${"Completed"===a.status?"bg-green-100 text-green-800":"In Progress"===a.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:a.status})})]}),(0,b.jsx)(h.Progress,{value:a.progress,className:"h-2"})]},a.id))})})]})}),(0,b.jsx)(i.TabsContent,{value:"variance",children:(0,b.jsxs)(g.Card,{className:"bg-card/60 border-border/50",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Schedule Variance: Planned vs Actual Progress"}),(0,b.jsx)(g.CardDescription,{children:"Comparison of planned vs actual cumulative progress over time"})]}),(0,b.jsxs)(g.CardContent,{children:[!1,(0,b.jsx)("div",{className:"w-full h-64 mt-6",children:(0,b.jsx)(r.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(s.ComposedChart,{data:ax,margin:{top:10,right:30,left:0,bottom:0},children:[(0,b.jsx)(o.CartesianGrid,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),(0,b.jsx)(m.XAxis,{type:"number",dataKey:"x",domain:[0,ar]}),(0,b.jsx)(n.YAxis,{type:"number",domain:[0,ar]}),(0,b.jsx)(p.Tooltip,{content:(0,b.jsx)(({active:a,payload:c})=>{if(!a||!c||!c.length)return null;let d=c.find(a=>"planned"===a.dataKey)?.value??0,e=c.find(a=>"actual"===a.dataKey)?.value??0;return(0,b.jsxs)("div",{style:{background:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:8,padding:8},children:[(0,b.jsxs)("div",{children:["Planned: ",Math.round(d)," days"]}),(0,b.jsxs)("div",{children:["Actual: ",Math.round(e)," days"]}),(0,b.jsxs)("div",{children:["SPI: ",(e>0?d/e:0).toFixed(2)]}),(0,b.jsxs)("div",{children:["Delay: ",(d>0?(d-e)/d*100:0).toFixed(1),"%"]})]})},{})}),(0,b.jsx)(q.Legend,{}),(0,b.jsx)(t.Line,{type:"monotone",dataKey:"planned",stroke:"hsl(var(--primary))",strokeWidth:2,name:"Planned",dot:{r:2},activeDot:{r:4}}),(0,b.jsx)(t.Line,{type:"monotone",dataKey:"regression",stroke:"hsl(var(--accent))",strokeWidth:2,name:"Regression",dot:{r:2},activeDot:{r:4}}),(0,b.jsx)(t.Line,{type:"monotone",dataKey:"actual",stroke:"#3b82f6",strokeWidth:2,name:"Actual",dot:{r:2},activeDot:{r:4}})]})})}),(0,b.jsx)("div",{className:"w-full h-64 mt-6",children:(0,b.jsx)(r.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(v.ScatterChart,{margin:{top:10,right:30,left:0,bottom:0},children:[(0,b.jsx)(o.CartesianGrid,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),(0,b.jsx)(m.XAxis,{type:"number",dataKey:"x",name:"Days Elapsed"}),(0,b.jsx)(n.YAxis,{type:"number",dataKey:"y",name:"SV (planned - actual)"}),(0,b.jsx)(p.Tooltip,{cursor:{strokeDasharray:"3 3"},content:(0,b.jsx)(({active:a,payload:c})=>{if(!a||!c||!c.length)return null;let d=c[0],e=d?.value,f=d?.payload?.x,g=d?.payload?.rag,h="number"==typeof d?.payload?.sv?d?.payload?.sv:null;return(0,b.jsxs)("div",{style:{background:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:8,padding:8},children:[(0,b.jsxs)("div",{style:{fontWeight:600},children:["Days Elapsed: ",f]}),(0,b.jsxs)("div",{children:["SV: ",e]}),null!=h&&(0,b.jsxs)("div",{children:["SV (stored): ",h]}),g&&(0,b.jsxs)("div",{children:["RAG: ",String(g).toUpperCase()]})]})},{})}),(0,b.jsx)(q.Legend,{}),(0,b.jsx)(u.Scatter,{name:"Green",data:ah.filter(a=>"green"===a.rag).map(a=>({x:a.daysElapsed,y:a.sv,sv:a.sv,rag:a.rag})),fill:"#16a34a"}),(0,b.jsx)(u.Scatter,{name:"Amber",data:ah.filter(a=>"amber"===a.rag).map(a=>({x:a.daysElapsed,y:a.sv,sv:a.sv,rag:a.rag})),fill:"#f59e0b"}),(0,b.jsx)(u.Scatter,{name:"Red",data:ah.filter(a=>"red"===a.rag).map(a=>({x:a.daysElapsed,y:a.sv,sv:a.sv,rag:a.rag})),fill:"#dc2626"})]})})}),(0,b.jsx)("div",{className:`mt-4 p-4 rounded-lg ${"Green"===ae?"bg-green-100 text-green-800":"Amber"===ae?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:(0,b.jsxs)("p",{className:"text-sm",children:["Status: ",ae," • Delay: ",ad.toFixed(1),"% • SPI: ",ac.toFixed(2)]})})]})]})}),(0,b.jsx)(i.TabsContent,{value:"activities",children:(0,b.jsxs)(g.Card,{className:"bg-card/60 border-border/50",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Activity Log"}),(0,b.jsx)(g.CardDescription,{children:"Chronological posts with descriptions, milestones, and visual proof"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("div",{className:"space-y-6",children:F&&0===B.length?(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"No daily activities yet"}):B.map(a=>(0,b.jsxs)("div",{className:"pb-6 border-b border-border last:border-0",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-semibold text-lg",children:["Progress: ",a.workPercentage,"%"]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.date," ",a.time]})]}),(0,b.jsxs)("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded",children:[Array.isArray(a.attachments)?a.attachments.length:0," photos"]})]}),(0,b.jsx)("p",{className:"text-foreground mb-3",children:a.workDescription}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mb-3",children:["Reported by: ",(0,b.jsx)("span",{className:"font-semibold text-foreground",children:a.crew})]}),Array.isArray(a.attachments)&&a.attachments.length>0&&(0,b.jsx)("div",{className:"flex gap-2",children:a.attachments.map((a,c)=>(0,b.jsx)("div",{className:"w-20 h-20 bg-muted rounded-lg flex items-center justify-center text-xs text-muted-foreground hover:bg-primary/10 cursor-pointer transition-colors",children:a},c))})]},a.id))})})]})})]})]})]})}a.s(["default",()=>z],36733)}];

//# sourceMappingURL=app_manager_project_%5Bid%5D_overview_page_tsx_446855ec._.js.map