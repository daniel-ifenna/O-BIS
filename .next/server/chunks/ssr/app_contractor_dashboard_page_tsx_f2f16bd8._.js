module.exports=[89606,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(72131),e=a.i(50944),f=a.i(40695),g=a.i(3130),h=a.i(21958),i=a.i(2150),j=a.i(15618),k=a.i(16201),l=a.i(41710),m=a.i(92e3),n=a.i(81010),o=a.i(73570),p=a.i(63588),q=a.i(21937),r=a.i(85850),s=a.i(75652),t=a.i(48662),u=a.i(48280),v=a.i(77924),w=a.i(54419),x=a.i(58042),y=a.i(94222),z=a.i(2274),A=a.i(27034),B=a.i(62931),C=a.i(68544),D=a.i(77687);function E(){let a=(0,e.useRouter)(),{user:E}=(0,q.useAuth)(),{getComplaintsByContractor:F}=(0,s.useComplaints)(),{projects:G}=(0,r.useProjects)(),H=E?F(E.id):[],I=H.filter(a=>"open"===a.status).length;H.filter(a=>"acknowledged"===a.status||"investigating"===a.status).length;let J=G.filter(a=>a.contractorId===E?.id),[K,L]=(0,d.useState)([]),[M,N]=(0,d.useState)([]);(0,d.useEffect)(()=>{(async()=>{let a=J[0]?.id;if(a){try{let b=await fetch(`/api/projects/${a}/milestones`);if(b.ok){let a=await b.json();L(a.map(a=>({id:a.id,name:a.name,weight:a.weight,progress:a.progress,status:a.status,startDate:a.startDate,endDate:a.endDate})))}}catch{}try{let b=await fetch(`/api/projects/${a}/daily-reports`);b.ok&&N(await b.json())}catch{}}})()},[J]);let O=()=>Math.round(K.reduce((a,b)=>a+b.weight*b.progress/100,0)),P=J[0],Q=P?.createdAt?new Date(P.createdAt):null,R=Q?Math.max(0,Math.floor((Date.now()-Q.getTime())/864e5)):0,S=P?.acceptedBidDays?Number(P.acceptedBidDays):P?.bidDays?Number(P.bidDays):0,T=Math.min(R,Math.max(0,S||0)),U=R>0?Math.min(1,Math.max(0,T/R)):0,V=T-R,W=U>=1?"Green":U>=.95?"Amber":"Red",X=Q?new Date(Q.getTime()+24*Math.max(0,S||0)*36e5):null,Y=(()=>{try{P&&P.id;let a=JSON.parse("[]"),b=[];if(Array.isArray(a))for(let c of a){let a=Number(c?.timestamp||Date.parse(c?.ts||""))||Date.now(),d=Number(c?.daysElapsed??c?.actualDays??0),e=Number(c?.plannedDays??0),f=Number(c?.actualDays??0),g=Number(c?.sv??e-f),h=String(c?.rag||"");b.push({timestamp:a,daysElapsed:d,plannedDays:e,actualDays:f,sv:g,rag:h.toLowerCase()})}return b}catch{return[]}})(),Z=Y.map(a=>a.daysElapsed),$=Y.map(a=>a.sv),_=a=>a.length?a.reduce((a,b)=>a+b,0)/a.length:0,aa=_(Z),ab=_($),ac=Z.reduce((a,b,c)=>a+(b-aa)*(($[c]??0)-ab),0),ad=Z.reduce((a,b)=>a+(b-aa)*(b-aa),0),ae=0!==ad?ac/ad:0,af=Math.max(0,S||0),ag=Math.abs(ae)>.01?ae*af+(ab-ae*aa):0,ah=Math.max(0,Math.round(Math.max(1,af-ag)-R)),ai=new Date(Date.now()+24*ah*36e5),aj=Math.max(1,Math.ceil(Math.max(1,af)/7)),ak={};(M||[]).map(a=>({date:new Date(a.date||Q||Date.now()),progress:Number(a.workPercentage||0)})).forEach(a=>{if(!Q)return;let b=Math.max(0,Math.floor((a.date.getTime()-Q.getTime())/6048e5));ak[b]=Math.max(ak[b]||0,a.progress)});let al=Array.from({length:aj}).map((a,b)=>{let c=af>0?Math.min(100,Math.round(Math.min((b+1)*7,af)/af*100)):0,d=Math.min(100,Math.round(ak[b]??(b>0?ak[b-1]??0:0)));return{week:`W${b+1}`,planned:c,actual:d}}),am=Y.map(a=>({x:a.daysElapsed,y:a.sv,rag:a.rag}));return(0,d.useEffect)(()=>{"Amber"===W?(0,D.toast)({title:"Schedule alert",description:"Slight delay detected. Please align with the manager."}):"Red"===W&&(0,D.toast)({title:"Schedule risk",description:"Significant delay. Immediate action needed with the manager."})},[W]),(0,b.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,b.jsx)("div",{className:"bg-accent/10 border-b border-accent/30 px-4 py-2",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center gap-2 text-sm text-accent",children:[(0,b.jsx)(o.AlertTriangle,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:"Preview Mode: Sign in to access full contractor features"})]})}),(0,b.jsx)("header",{className:"border-b border-border bg-card/50 backdrop-blur-sm sticky top-0 z-40",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("button",{onClick:()=>a.push("/"),className:"p-2 hover:bg-accent/10 rounded-lg transition-colors",title:"Go to home",children:(0,b.jsx)(n.Home,{className:"w-5 h-5 text-foreground"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-foreground",children:"Contractor Dashboard"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Track projects and milestones"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(c.default,{href:"/contractor/milestones",children:(0,b.jsxs)(f.Button,{variant:"outline",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"Define Milestones"]})}),(0,b.jsx)(c.default,{href:"/contractor/daily-report",children:(0,b.jsxs)(f.Button,{className:"bg-primary hover:bg-primary/90",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"Daily Report"]})})]})]})}),(0,b.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[I>0&&(0,b.jsx)(g.Card,{className:"bg-destructive/10 border-destructive/30 mb-6",children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(o.AlertTriangle,{className:"w-5 h-5 text-destructive"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-destructive",children:"Active Complaints"}),(0,b.jsxs)("p",{className:"text-sm text-destructive/80",children:[I," issue(s) awaiting manager response"]})]})]}),(0,b.jsx)(c.default,{href:"/contractor/complaints",children:(0,b.jsx)(f.Button,{size:"sm",className:"bg-destructive hover:bg-destructive/90",children:"View Complaints"})})]})})}),J.length>0?(0,b.jsxs)(g.Card,{className:"bg-card/60 border-border/50 mb-8",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(g.CardTitle,{children:"Overall Project Progress"}),(0,b.jsx)(g.CardDescription,{children:J[0].title})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:"text-3xl font-bold text-primary",children:[O(),"%"]})})]})}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)(i.Progress,{value:O(),className:"h-3"}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 mt-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Location"}),(0,b.jsx)("p",{className:"font-semibold",children:J[0].location})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Status"}),(0,b.jsx)("p",{className:"font-semibold",children:J[0].status})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Bids Received"}),(0,b.jsx)("p",{className:"font-semibold",children:J[0].bids})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Start Date"}),(0,b.jsx)("p",{className:"font-semibold text-sm",children:J[0].createdAt})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 mt-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Planned End"}),(0,b.jsx)("p",{className:"font-semibold",children:X?X.toLocaleDateString():"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Predicted Completion"}),(0,b.jsx)("p",{className:"font-semibold",children:ai?ai.toLocaleDateString():"—"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"RAG (Schedule)"}),(0,b.jsx)("p",{className:"font-semibold",children:W})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Days Behind"}),(0,b.jsx)("p",{className:"font-semibold",children:V<0?Math.abs(V):0})]})]})]})]}):(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50 mb-8",children:(0,b.jsx)(g.CardContent,{className:"pt-6 text-center",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"No assigned projects"})})}),(0,b.jsxs)(h.Tabs,{defaultValue:"milestones",className:"space-y-6",children:[(0,b.jsxs)(h.TabsList,{children:[(0,b.jsx)(h.TabsTrigger,{value:"milestones",children:"Milestones"}),(0,b.jsx)(h.TabsTrigger,{value:"schedule",children:"Schedule"}),(0,b.jsx)(h.TabsTrigger,{value:"reports",children:"Recent Reports"}),(0,b.jsx)(h.TabsTrigger,{value:"procurement",children:"Procurement"}),(0,b.jsxs)(h.TabsTrigger,{value:"complaints",children:["Complaints (",H.length,")"]})]}),(0,b.jsx)(h.TabsContent,{value:"milestones",className:"space-y-4",children:K.length>0?(0,b.jsx)("div",{className:"grid gap-4",children:K.map(a=>(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50",children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)("div",{className:"flex items-center justify-center",children:(a=>{switch(a){case"Completed":return(0,b.jsx)(k.CheckCircle,{className:"w-5 h-5 text-green-600"});case"In Progress":return(0,b.jsx)(l.Clock,{className:"w-5 h-5 text-primary"});case"Pending":return(0,b.jsx)(m.AlertCircle,{className:"w-5 h-5 text-muted-foreground"});default:return null}})(a.status)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.startDate," — ",a.endDate]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[a.weight,"% of project"]}),(0,b.jsxs)("p",{className:"text-xl font-bold text-primary",children:[a.progress,"%"]})]})]}),(0,b.jsx)(i.Progress,{value:a.progress,className:"h-2"})]})]})})},a.id))}):(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50",children:(0,b.jsxs)(g.CardContent,{className:"pt-6 text-center",children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"No milestones defined"}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsx)(c.default,{href:"/contractor/milestones",children:(0,b.jsx)(f.Button,{variant:"outline",children:"Define Milestones"})})})]})})}),(0,b.jsx)(h.TabsContent,{value:"schedule",children:(0,b.jsxs)(g.Card,{className:"bg-card/60 border-border/50",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Planned vs Actual Progress"}),(0,b.jsx)(g.CardDescription,{children:"Simplified timeline of planned work vs actual progress"})]}),(0,b.jsxs)(g.CardContent,{children:[(0,b.jsx)("div",{className:"w-full h-64",children:(0,b.jsx)(t.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(u.ComposedChart,{data:al,margin:{top:10,right:30,left:0,bottom:0},children:[(0,b.jsx)(w.CartesianGrid,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),(0,b.jsx)(x.XAxis,{dataKey:"week"}),(0,b.jsx)(y.YAxis,{domain:[0,100]}),(0,b.jsx)(A.Tooltip,{}),(0,b.jsx)(z.Legend,{}),(0,b.jsx)(v.Line,{type:"monotone",dataKey:"planned",stroke:"hsl(var(--primary))",strokeWidth:2,name:"Planned",dot:{r:2},activeDot:{r:4}}),(0,b.jsx)(v.Line,{type:"monotone",dataKey:"actual",stroke:"#3b82f6",strokeWidth:2,name:"Actual",dot:{r:2},activeDot:{r:4}})]})})}),am.length>0&&(0,b.jsx)("div",{className:"w-full h-64 mt-6",children:(0,b.jsx)(t.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(B.ScatterChart,{margin:{top:10,right:30,left:0,bottom:0},children:[(0,b.jsx)(w.CartesianGrid,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),(0,b.jsx)(x.XAxis,{type:"number",dataKey:"x",name:"Days Elapsed"}),(0,b.jsx)(y.YAxis,{type:"number",dataKey:"y",name:"SV (planned - actual)"}),(0,b.jsx)(A.Tooltip,{cursor:{strokeDasharray:"3 3"}}),(0,b.jsx)(z.Legend,{}),(0,b.jsx)(C.Scatter,{name:"Green",data:am.filter(a=>"green"===a.rag),fill:"#16a34a"}),(0,b.jsx)(C.Scatter,{name:"Amber",data:am.filter(a=>"amber"===a.rag),fill:"#f59e0b"}),(0,b.jsx)(C.Scatter,{name:"Red",data:am.filter(a=>"red"===a.rag),fill:"#dc2626"})]})})}),(0,b.jsx)("div",{className:`mt-4 p-4 rounded-lg ${"Green"===W?"bg-green-100 text-green-800":"Amber"===W?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:(0,b.jsxs)("p",{className:"text-sm",children:["Status: ",W," • Predicted Completion: ",ai?ai.toLocaleDateString():"—"]})})]})]})}),(0,b.jsx)(h.TabsContent,{value:"reports",children:(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50",children:(0,b.jsxs)(g.CardContent,{className:"pt-6",children:[(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"No daily reports yet. Create your first report."}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsx)(c.default,{href:"/contractor/daily-report",children:(0,b.jsxs)(f.Button,{className:"bg-primary hover:bg-primary/90",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"Create Report"]})})})]})})}),(0,b.jsx)(h.TabsContent,{value:"procurement",children:(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50",children:(0,b.jsxs)(g.CardContent,{className:"pt-6",children:[(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"No active procurement requests"}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsx)(c.default,{href:"/contractor/procurement/create",children:(0,b.jsxs)(f.Button,{className:"bg-primary hover:bg-primary/90",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"Request Materials"]})})})]})})}),(0,b.jsx)(h.TabsContent,{value:"complaints",className:"space-y-4",children:H.length>0?(0,b.jsx)("div",{className:"grid gap-4",children:H.map(a=>(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50",children:(0,b.jsxs)(g.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsx)("h3",{className:"font-semibold text-foreground",children:a.subject}),(0,b.jsx)("span",{className:`text-xs font-semibold px-2 py-1 rounded ${"open"===a.status?"bg-red-100 text-red-800":"resolved"===a.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:a.status})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-2",children:[a.description.substring(0,100),"..."]}),(0,b.jsx)(c.default,{href:`/contractor/complaints/${a.id}`,children:(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(p.MessageSquare,{className:"w-4 h-4 mr-2"}),"View Details"]})})]})},a.id))}):(0,b.jsx)(g.Card,{className:"bg-card/60 border-border/50",children:(0,b.jsxs)(g.CardContent,{className:"pt-6",children:[(0,b.jsx)("p",{className:"text-center text-muted-foreground",children:"No complaints filed"}),(0,b.jsx)("div",{className:"mt-4 text-center",children:(0,b.jsx)(c.default,{href:"/contractor/complaints/create",children:(0,b.jsxs)(f.Button,{className:"bg-primary hover:bg-primary/90",children:[(0,b.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"File Complaint"]})})})]})})})]})]})]})}function F(){return(0,b.jsx)(E,{})}a.s(["default",()=>F])}];

//# sourceMappingURL=app_contractor_dashboard_page_tsx_f2f16bd8._.js.map