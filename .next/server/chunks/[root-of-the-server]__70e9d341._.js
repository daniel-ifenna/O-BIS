module.exports=[69041,(e,t,a)=>{t.exports=e.x("firebase-admin",()=>require("firebase-admin"))},21127,e=>{"use strict";var t=e.i(69041);let a=new Set(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","image/jpeg","image/png"]);function i(e){let t=[e.category];return e.projectId&&t.push(`project_${e.projectId}`),e.bidId&&t.push(`bid_${e.bidId}`),e.procurementId&&t.push(`proc_${e.procurementId}`),e.vendorId&&t.push(`vendor_${e.vendorId}`),e.userId&&t.push(`user_${e.userId}`),t.push(`${new Date().toISOString().replace(/[^0-9]/g,"")}-${e.filename.toLowerCase().replace(/[^a-z0-9_.-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.|\.$/g,"")}`),t.join("/")}class n{bucket;constructor(e){t.default.apps.length||t.default.initializeApp({credential:t.default.credential.cert({projectId:e.projectId,clientEmail:e.clientEmail,privateKey:e.privateKey.replace(/\\n/g,"\n")}),storageBucket:e.bucket}),this.bucket=t.default.storage().bucket(e.bucket)}async uploadBuffer(e,t){if(!a.has(t.contentType))throw Error("Unsupported content type");let n=i(t),r=this.bucket.file(n);await r.save(e,{contentType:t.contentType,gzip:t.gzip??!0,resumable:!1,metadata:{cacheControl:t.cacheControl??"public, max-age=31536000",metadata:t.metadata}}),t.makePublic&&await r.makePublic();let[c]=await r.getMetadata();return{path:n,size:Number(c.size||0),contentType:c.contentType||t.contentType,md5Hash:c.md5Hash,generation:c.generation?String(c.generation):void 0,etag:c.etag,mediaLink:c.mediaLink,publicUrl:t.makePublic?this.getPublicUrl(n):void 0}}async uploadStream(e,t){if(!a.has(t.contentType))throw Error("Unsupported content type");let n=i(t),r=this.bucket.file(n),c=r.createWriteStream({contentType:t.contentType,gzip:t.gzip??!0,resumable:!1,metadata:{cacheControl:t.cacheControl??"public, max-age=31536000",metadata:t.metadata}});return new Promise((a,i)=>{c.on("error",i),c.on("finish",async()=>{try{t.makePublic&&await r.makePublic();let[e]=await r.getMetadata();a({path:n,size:Number(e.size||0),contentType:e.contentType||t.contentType,md5Hash:e.md5Hash,generation:e.generation?String(e.generation):void 0,etag:e.etag,mediaLink:e.mediaLink,publicUrl:t.makePublic?this.getPublicUrl(n):void 0})}catch(e){i(e)}}),e.pipe(c)})}async getSignedUrl(e,t=3600){let a=this.bucket.file(e),i={action:"read",expires:Date.now()+1e3*t},[n]=await a.getSignedUrl(i);return n}getPublicUrl(e){return`https://storage.googleapis.com/${this.bucket.name}/${e}`}async delete(e){let t=this.bucket.file(e);await t.delete({ignoreNotFound:!0})}async exists(e){let t=this.bucket.file(e),[a]=await t.exists();return a}async copy(e,t){let a=this.bucket.file(e),i=this.bucket.file(t);await a.copy(i)}async move(e,t){await this.copy(e,t),await this.delete(e)}async getMetadata(e){let t=this.bucket.file(e),[a]=await t.getMetadata();return a}}function r(){let e=process.env.FIREBASE_PROJECT_ID||"",t=process.env.FIREBASE_CLIENT_EMAIL||"",a=(process.env.FIREBASE_PRIVATE_KEY||"").replace(/\r?\n/g,"\n"),i=process.env.FIREBASE_STORAGE_BUCKET||"";if(!e||!t||!a||!i)throw Error("Missing Firebase credentials");return new n({projectId:e,clientEmail:t,privateKey:a,bucket:i})}e.s(["FirebaseStorage",()=>n,"createFirebaseStorageFromEnv",()=>r])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__70e9d341._.js.map