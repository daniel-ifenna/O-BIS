module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},62294,e=>{"use strict";var t=e.i(29173);let r=globalThis,a=process.env.DATABASE_URL_PGBOUNCER||process.env.DATABASE_URL||"",n=r.prisma||function(){if(a)return new t.PrismaClient({datasources:{db:{url:a}}});let e=e=>{throw Error(`Database unavailable: set DATABASE_URL before calling ${e}`)};return new Proxy({},{get:(t,r)=>"$use"===r?()=>{}:"$transaction"===r?()=>e("$transaction"):()=>e(String(r))})}();r.prisma||(r.prisma=n);let i=new Set(["User","Contractor","Vendor","Manager","Project","Bid","BidInvitation","ProcurementRequest","EscrowWalletTransaction","FileStorageRecord","PaymentRequest","Milestone","DailyReport","VendorQuote"]);"function"==typeof n.$use&&n.$use(async(e,t)=>{let r,a,n,s,o,l=new Date,d=(r=l.getFullYear(),a=String(l.getMonth()+1).padStart(2,"0"),n=String(l.getDate()).padStart(2,"0"),`${r}-${a}-${n}`),c=(s=String(l.getHours()).padStart(2,"0"),o=String(l.getMinutes()).padStart(2,"0"),`${s}:${o}`),p=i.has(e.model||"");if("true"!==String(process.env.ALLOW_DELETE||"").toLowerCase()&&("delete"===e.action||"deleteMany"===e.action))throw Error("Delete operations are disabled");if(p){if("create"===e.action)e.args.data={...e.args.data||{},recordDate:d,recordTime:c};else if("createMany"===e.action){let t=e.args.data;Array.isArray(t)?e.args.data=t.map(e=>({...e||{},recordDate:d,recordTime:c})):e.args.data={...t||{},recordDate:d,recordTime:c}}else if("update"===e.action||"upsert"===e.action)e.args.data={...e.args.data||{},recordDate:d,recordTime:c};else if("updateMany"===e.action){let t=e.args.data;e.args.data={...t||{},recordDate:d,recordTime:c}}}return t(e)}),e.s(["prisma",0,n])},69041,(e,t,r)=>{t.exports=e.x("firebase-admin",()=>require("firebase-admin"))},21127,e=>{"use strict";var t=e.i(69041);let r=new Set(["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","image/jpeg","image/png"]);function a(e){let t=[e.category];return e.projectId&&t.push(`project_${e.projectId}`),e.bidId&&t.push(`bid_${e.bidId}`),e.procurementId&&t.push(`proc_${e.procurementId}`),e.vendorId&&t.push(`vendor_${e.vendorId}`),e.userId&&t.push(`user_${e.userId}`),t.push(`${new Date().toISOString().replace(/[^0-9]/g,"")}-${e.filename.toLowerCase().replace(/[^a-z0-9_.-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$|^\.|\.$/g,"")}`),t.join("/")}class n{bucket;constructor(e){t.default.apps.length||t.default.initializeApp({credential:t.default.credential.cert({projectId:e.projectId,clientEmail:e.clientEmail,privateKey:e.privateKey.replace(/\\n/g,"\n")}),storageBucket:e.bucket}),this.bucket=t.default.storage().bucket(e.bucket)}async uploadBuffer(e,t){if(!r.has(t.contentType))throw Error("Unsupported content type");let n=a(t),i=this.bucket.file(n);await i.save(e,{contentType:t.contentType,gzip:t.gzip??!0,resumable:!1,metadata:{cacheControl:t.cacheControl??"public, max-age=31536000",metadata:t.metadata}}),t.makePublic&&await i.makePublic();let[s]=await i.getMetadata();return{path:n,size:Number(s.size||0),contentType:s.contentType||t.contentType,md5Hash:s.md5Hash,generation:s.generation?String(s.generation):void 0,etag:s.etag,mediaLink:s.mediaLink,publicUrl:t.makePublic?this.getPublicUrl(n):void 0}}async uploadStream(e,t){if(!r.has(t.contentType))throw Error("Unsupported content type");let n=a(t),i=this.bucket.file(n),s=i.createWriteStream({contentType:t.contentType,gzip:t.gzip??!0,resumable:!1,metadata:{cacheControl:t.cacheControl??"public, max-age=31536000",metadata:t.metadata}});return new Promise((r,a)=>{s.on("error",a),s.on("finish",async()=>{try{t.makePublic&&await i.makePublic();let[e]=await i.getMetadata();r({path:n,size:Number(e.size||0),contentType:e.contentType||t.contentType,md5Hash:e.md5Hash,generation:e.generation?String(e.generation):void 0,etag:e.etag,mediaLink:e.mediaLink,publicUrl:t.makePublic?this.getPublicUrl(n):void 0})}catch(e){a(e)}}),e.pipe(s)})}async getSignedUrl(e,t=3600){let r=this.bucket.file(e),a={action:"read",expires:Date.now()+1e3*t},[n]=await r.getSignedUrl(a);return n}getPublicUrl(e){return`https://storage.googleapis.com/${this.bucket.name}/${e}`}async delete(e){let t=this.bucket.file(e);await t.delete({ignoreNotFound:!0})}async exists(e){let t=this.bucket.file(e),[r]=await t.exists();return r}async copy(e,t){let r=this.bucket.file(e),a=this.bucket.file(t);await r.copy(a)}async move(e,t){await this.copy(e,t),await this.delete(e)}async getMetadata(e){let t=this.bucket.file(e),[r]=await t.getMetadata();return r}}function i(){let e=process.env.FIREBASE_PROJECT_ID||"",t=process.env.FIREBASE_CLIENT_EMAIL||"",r=(process.env.FIREBASE_PRIVATE_KEY||"").replace(/\r?\n/g,"\n"),a=process.env.FIREBASE_STORAGE_BUCKET||"";if(!e||!t||!r||!a)throw Error("Missing Firebase credentials");return new n({projectId:e,clientEmail:t,privateKey:r,bucket:a})}e.s(["FirebaseStorage",()=>n,"createFirebaseStorageFromEnv",()=>i])},17322,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),i=e.i(61916),s=e.i(14444),o=e.i(37092),l=e.i(69741),d=e.i(16795),c=e.i(87718),p=e.i(95169),u=e.i(47587),m=e.i(66012),g=e.i(70101),h=e.i(26937),f=e.i(10372),b=e.i(93695);e.i(52474);var w=e.i(220),y=e.i(89171),x=e.i(62294),v=e.i(21127);async function R(t,{params:r}){try{let a=await t.json();for(let e of["bidderName","companyName","email","amount","duration"])if(!a[e])return y.NextResponse.json({error:`${e} is required`},{status:400});let n=a.uploads||{},i="true"===String(process.env.REQUIRE_BID_UPLOADS||"").toLowerCase(),s=n?.proposal;if(i&&(!Array.isArray(s)||0===s.length))return y.NextResponse.json({error:"proposal upload is required"},{status:400});let{id:o}=await r,l=await x.prisma.project.findUnique({where:{id:o}}).catch(()=>null);if(!l&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o))try{let e=await x.prisma.project.findFirst({where:{title:{equals:o,mode:"insensitive"}}});e&&(l=e)}catch{}if(!l)try{let e=await x.prisma.project.findFirst({orderBy:{createdAt:"desc"}});e&&(l=e)}catch{}if(!l)try{let{getProjectById:t}=await e.A(37211),r=await t(o);r&&(l=r)}catch{}if(!l)return y.NextResponse.json({error:"Project not found"},{status:404});if(["Closed","Awarded","Completed"].includes(l.status))return y.NextResponse.json({error:"Bidding closed"},{status:403});let d=Number(l.maxBids||0);if(d>0&&await x.prisma.bid.count({where:{projectId:o}}).catch(()=>0)>=d)return y.NextResponse.json({error:"Submission limit reached"},{status:403});let c=Number(l.bidDays||0);if(c>0&&l.createdAt){let e=new Date(new Date(l.createdAt).getTime()+24*c*36e5);if(new Date>e)return y.NextResponse.json({error:"Submission window ended"},{status:403})}let p=String(a.amount).replace(/[^0-9.]/g,"");if(!p||isNaN(Number(p)))return y.NextResponse.json({error:"amount must be numeric"},{status:400});let u=Number(String(a.duration));if(!Number.isFinite(u)||u<=0)return y.NextResponse.json({error:"duration must be a positive number"},{status:400});let m=new Date,g=m.getFullYear(),h=String(m.getMonth()+1).padStart(2,"0"),f=String(m.getDate()).padStart(2,"0"),b=String(m.getHours()).padStart(2,"0"),w=String(m.getMinutes()).padStart(2,"0"),R=`${g}-${h}-${f}`,S=`${b}:${w}`,E=null;if("string"==typeof a.contractorId&&a.contractorId&&"public"!==a.contractorId)try{await x.prisma.contractor.findUnique({where:{id:a.contractorId}})&&(E=a.contractorId)}catch{}let A=l?.id||o;try{let e=await x.prisma.bid.create({data:{projectId:A,contractorId:E,bidderName:String(a.bidderName),companyName:String(a.companyName),email:String(a.email),phone:a.phone?String(a.phone):null,address:a.address?String(a.address):null,amount:String(p),duration:u,message:a.message||null,status:"New",recordDate:R,recordTime:S}});try{let t=(0,v.createFirebaseStorageFromEnv)(),r=async(r,a,n)=>{if(!Array.isArray(n))return[];let i=[];for(let s=0;s<n.length;s++){let o=n[s];if("string"!=typeof o)continue;let l=/^data:([^;]+);base64,(.+)$/i.exec(o);if(!l)continue;let d=l[1],c=l[2];try{let n=Buffer.from(c,"base64"),o=await t.uploadBuffer(n,{category:a,filename:`${r}_${s+1}.pdf`,contentType:d,projectId:A,bidId:e.id,makePublic:!0}),l=o.publicUrl||t.getPublicUrl(o.path);await x.prisma.fileStorageRecord.create({data:{category:a.replace(/-/g,"_"),url:l,path:o.path,contentType:o.contentType,size:o.size,projectId:A,bidId:e.id,recordDate:R,recordTime:S}}),i.push(l)}catch{i.push(o)}}return i},n=a.uploads||{},i=await r("proposal","technical-proposals",n.proposal),s=await r("profile","technical-proposals",n.profile),o=await r("specs","procurement-specifications",n.specs),l=await r("tax","financial-proposals",n.tax),d=await r("bond","financial-proposals",n.bond),c=await r("additional","technical-proposals",n.additional);e.uploads={proposal:i,profile:s,specs:o,tax:l,bond:d,additional:c},e.subcontractors=Array.isArray(a.subcontractors)?a.subcontractors:[]}catch{}try{await x.prisma.project.update({where:{id:A},data:{status:"Published"===l.status?"Bidding":l.status}})}catch{}return y.NextResponse.json(e,{status:201})}catch(t){try{let{createBid:t,saveBids:r}=await e.A(37211),n=await t(A,{bidderName:String(a.bidderName),companyName:String(a.companyName),email:String(a.email),phone:a.phone?String(a.phone):"",address:a.address?String(a.address):"",amount:String(p),duration:u,message:a.message||"",contractorId:String(a.contractorId||"")});return y.NextResponse.json(n,{status:201})}catch(e){return console.error("POST /api/projects/",o,"bids",JSON.stringify({body:a}),String(t?.message||t)),y.NextResponse.json({error:"Failed to submit bid"},{status:500})}}}catch(e){return y.NextResponse.json({error:"Failed to submit bid"},{status:500})}}async function S(e,{params:t}){try{let{id:e}=await t,r=(()=>{try{return(0,v.createFirebaseStorageFromEnv)()}catch{return null}})(),a=await x.prisma.bid.findMany({where:{projectId:e},orderBy:{submittedAt:"desc"},include:{files:!0}}),n=e=>{if(!e)return"";let t=e.split("/").pop()||"",r=t.indexOf("-");return r>=0?t.slice(r+1):t},i=e=>{let t=e.url;if(!t&&e.path&&r)try{t=r.getPublicUrl(e.path)}catch{}return t},s=a.map(e=>{let t={proposal:[],profile:[],specs:[],tax:[],bond:[],additional:[]};for(let r of e.files||[]){let e=n(r.path).toLowerCase(),a=i(r);a&&(e.startsWith("proposal")?t.proposal.push(a):e.startsWith("profile")?t.profile.push(a):e.startsWith("specs")?t.specs.push(a):e.startsWith("tax")?t.tax.push(a):e.startsWith("bond")?t.bond.push(a):e.startsWith("additional")&&t.additional.push(a))}return{...e,uploads:t}});return y.NextResponse.json(s)}catch(e){return y.NextResponse.json({error:"Failed to load project bids"},{status:500})}}e.s(["GET",()=>S,"POST",()=>R],13340);var E=e.i(13340);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/projects/[id]/bids/route",pathname:"/api/projects/[id]/bids",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/projects/[id]/bids/route.ts",nextConfigOutput:"",userland:E}),{workAsyncStorage:N,workUnitAsyncStorage:T,serverHooks:j}=A;function I(){return(0,a.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:T})}async function C(e,t,a){A.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/projects/[id]/bids/route";y=y.replace(/\/index$/,"")||"/";let x=await A.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:R,nextConfig:S,parsedUrl:E,isDraftMode:N,prerenderManifest:T,routerServerContext:j,isOnDemandRevalidate:I,revalidateOnlyGenerated:C,resolvedPathname:P,clientReferenceManifest:k,serverActionsManifest:_}=x,$=(0,l.normalizeAppPath)(y),D=!!(T.dynamicRoutes[$]||T.routes[P]),U=async()=>((null==j?void 0:j.render404)?await j.render404(e,t,E,!1):t.end("This page could not be found"),null);if(D&&!N){let e=!!T.routes[P],t=T.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await U();throw new b.NoFallbackError}}let M=null;!D||A.isDev||N||(M="/index"===(M=P)?"/":M);let O=!0===A.isDev||!D,F=D&&!O;_&&k&&(0,s.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:k,serverActionsManifest:_,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:_})});let q=e.method||"GET",B=(0,i.getTracer)(),H=B.getActiveScopeSpan(),L={params:R,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:O,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>A.onRequestError(e,t,a,j)},sharedContext:{buildId:v}},z=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),W=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let s=async e=>A.handle(W,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${q} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${y}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var i,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&I&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(n);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(z,K,i,L.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:I})},j),t}},c=await A.handleResponse({req:e,nextConfig:S,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!D)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",I?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&D||p.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,h.getCacheControlHeader)(c.cacheControl)),await (0,m.sendResponse)(z,K,new Response(c.value.body,{headers:p,status:c.value.status||200})),null};H?await l(H):await B.withPropagatedContext(e.headers,()=>B.trace(p.BaseServerSpan.handleRequest,{spanName:`${q} ${y}`,kind:i.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},l))}catch(t){if(t instanceof b.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:I})}),D)throw t;return await (0,m.sendResponse)(z,K,new Response(null,{status:500})),null}}e.s(["handler",()=>C,"patchFetch",()=>I,"routeModule",()=>A,"serverHooks",()=>j,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>T],17322)},37211,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__74e0f837._.js"].map(t=>e.l(t))).then(()=>t(27087)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ab59d0e4._.js.map