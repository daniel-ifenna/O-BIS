{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient }\n\nconst dbUrl = process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL || \"\"\n\nfunction createPrismaOrMock(): PrismaClient | any {\n  if (dbUrl) {\n    return new PrismaClient({\n      datasources: {\n        db: { url: dbUrl },\n      },\n    })\n  }\n  const warn = (op: string) => {\n    throw new Error(`Database unavailable: set DATABASE_URL before calling ${op}`)\n  }\n  return new Proxy(\n    {},\n    {\n      get(_, prop) {\n        if (prop === \"$use\") return () => {}\n        if (prop === \"$transaction\") return () => warn(\"$transaction\")\n        return () => warn(String(prop))\n      },\n    },\n  ) as PrismaClient\n}\n\nexport const prisma = globalForPrisma.prisma || createPrismaOrMock()\n\nif (!globalForPrisma.prisma) globalForPrisma.prisma = prisma\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nconst TARGET_MODELS = new Set([\n  \"User\",\n  \"Contractor\",\n  \"Vendor\",\n  \"Manager\",\n  \"Project\",\n  \"Bid\",\n  \"BidInvitation\",\n  \"ProcurementRequest\",\n  \"EscrowWalletTransaction\",\n  \"FileStorageRecord\",\n  \"PaymentRequest\",\n  \"Milestone\",\n  \"DailyReport\",\n  \"VendorQuote\",\n])\n\nif (typeof (prisma as any).$use === \"function\") (prisma as any).$use(async (params: any, next: any) => {\n  const now = new Date()\n  const date = fmtDate(now)\n  const time = fmtTime(now)\n  const modelMatches = TARGET_MODELS.has(params.model || \"\")\n  const preventDeletes = String(process.env.ALLOW_DELETE || \"\").toLowerCase() !== \"true\"\n  if (preventDeletes && (params.action === \"delete\" || params.action === \"deleteMany\")) {\n    throw new Error(\"Delete operations are disabled\")\n  }\n\n  if (modelMatches) {\n    if (params.action === \"create\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"createMany\") {\n      const data = params.args.data\n      if (Array.isArray(data)) {\n        params.args.data = data.map((item: any) => ({ ...(item || {}), recordDate: date, recordTime: time }))\n      } else {\n        params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n      }\n    } else if (params.action === \"update\" || params.action === \"upsert\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"updateMany\") {\n      const data = params.args.data\n      params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n    }\n  }\n\n  return next(params)\n})\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/auth/password.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\"\r\n\r\nexport async function hashPassword(plain: string): Promise<string> {\r\n  const rounds = Number(process.env.BCRYPT_ROUNDS || 10)\r\n  const salt = await bcrypt.genSalt(rounds)\r\n  return bcrypt.hash(plain, salt)\r\n}\r\n\r\nexport async function verifyPassword(plain: string, hash: string): Promise<boolean> {\r\n  return bcrypt.compare(plain, hash)\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,eAAe,aAAa,KAAa;IAC9C,MAAM,SAAS,OAAO,QAAQ,GAAG,CAAC,aAAa,IAAI;IACnD,MAAM,OAAO,MAAM,8IAAM,CAAC,OAAO,CAAC;IAClC,OAAO,8IAAM,CAAC,IAAI,CAAC,OAAO;AAC5B;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,OAAO,8IAAM,CAAC,OAAO,CAAC,OAAO;AAC/B"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/email-service.ts"],"sourcesContent":["import nodemailer, { type Transporter } from \"nodemailer\"\nimport { PDFDocument, StandardFonts, rgb } from \"pdf-lib\"\nimport path from \"path\"\nimport type { Bid } from \"@/lib/database-schema\"\n\ninterface ContractAwardParams {\n  to: string\n  companyName: string\n  projectName: string\n  estimatedBudget: number\n  estimatedDuration: number\n  contractPdfBuffer?: Buffer\n  loginUrl: string\n  loginEmail?: string\n  tempPassword?: string\n  isPasswordSetup?: boolean\n}\n\nexport class EmailService {\n  private transporter: Transporter | null = null\n  private isVerified = false\n\n  constructor() {\n    void this.initializeTransporter()\n  }\n\n  private async initializeTransporter() {\n    const smtpHost = process.env.SMTP_HOST\n    const smtpPort = Number(process.env.SMTP_PORT || 0)\n    const smtpUser = process.env.SMTP_USER\n    const smtpPass = process.env.SMTP_PASS\n    const gmailUser = process.env.GMAIL_USER\n    const gmailPass = process.env.GMAIL_APP_PASSWORD\n\n    if (smtpHost && smtpPort && smtpUser && smtpPass) {\n      this.transporter = nodemailer.createTransport({ host: smtpHost, port: smtpPort, secure: smtpPort === 465, auth: { user: smtpUser, pass: smtpPass } })\n    } else if (gmailUser && gmailPass) {\n      this.transporter = nodemailer.createTransport({ service: \"gmail\", auth: { user: gmailUser, pass: gmailPass } })\n    } else {\n      console.warn(\"[EmailService] Email service not configured (missing SMTP/Gmail envs).\")\n      return\n    }\n\n    try {\n      await this.transporter.verify()\n      this.isVerified = true\n      console.log(\"[EmailService] SMTP verified successfully\")\n    } catch (err) {\n      console.error(\"[EmailService] SMTP verification failed:\", err)\n      this.isVerified = false\n    }\n  }\n\n  getStatus() {\n    return { ready: this.isVerified }\n  }\n\n  buildHtmlTemplate(params: { preheader?: string; title: string; greeting?: string; bodyHtml: string; ctaText?: string; ctaUrl?: string; footerNote?: string }) {\n    const pre = params.preheader || params.title\n    const href = this.resolveUrl(params.ctaUrl)\n    const cta = params.ctaText && href\n      ? `<a href=\"${href}\" style=\"display:inline-block;padding:12px 18px;background:#ea580c;color:#fff;text-decoration:none;border-radius:6px\">${params.ctaText}</a>`\n      : \"\"\n    const note = params.footerNote ? `<p style=\"margin:16px 0;color:#6b7280\">${params.footerNote}</p>` : \"\"\n    const greet = params.greeting ? `<p style=\"margin:0 0 12px 0\">${params.greeting}</p>` : \"\"\n    return `<!DOCTYPE html>\n<html>\n<body style=\"margin:0;padding:0;background:#f7f7f7;font-family:Inter,Arial,sans-serif;color:#1f2937\">\n  <div style=\"display:none;max-height:0;overflow:hidden\">${pre}</div>\n  <table role=\"presentation\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" style=\"background:#f7f7f7\">\n    <tr>\n      <td align=\"center\" style=\"padding:24px\">\n        <table role=\"presentation\" width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background:#ffffff;border-radius:12px;border:1px solid #e5e7eb\">\n          <tr>\n            <td style=\"padding:24px;border-bottom:1px solid #e5e7eb\">\n              <div style=\"display:flex;align-items:center;gap:8px\">\n                <div style=\"width:32px;height:32px;border-radius:8px;background:#ea580c\"></div>\n                <div style=\"font-weight:700;color:#0f172a\">Open-Eye Africa Technologies – O-BIS</div>\n              </div>\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding:24px\">\n              <h2 style=\"margin:0 0 8px 0;color:#0f172a\">${params.title}</h2>\n              ${greet}\n              ${params.bodyHtml}\n              ${cta}\n              ${note}\n            </td>\n          </tr>\n          <tr>\n            <td style=\"padding:16px 24px;border-top:1px solid #e5e7eb;color:#6b7280;font-size:12px\">\n              © ${new Date().getFullYear()} Open-Eye Africa Technologies. All rights reserved.\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n  \n</body>\n</html>`\n  }\n\n  private resolveUrl(u?: string): string | undefined {\n    if (!u) return undefined\n    const s = String(u).trim()\n    if (!s) return undefined\n    if (/^https?:\\/\\//i.test(s)) return s\n    if (s.startsWith(\"/\")) {\n      const base = process.env.NEXT_PUBLIC_BASE_URL\n        || (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : undefined)\n        || process.env.BASE_URL\n        || \"http://localhost:3000\"\n      return `${base}${s}`\n    }\n    return s\n  }\n\n  async sendEmail(params: { to: string; subject: string; html: string }) {\n    if (!this.transporter || !this.isVerified) return false\n\n    try {\n      const isFullDoc = /^\\s*<!DOCTYPE html>/i.test(params.html)\n      const htmlOut = isFullDoc ? params.html : this.buildHtmlTemplate({ title: params.subject, bodyHtml: params.html })\n      await this.transporter.sendMail({ from: process.env.SMTP_FROM || process.env.GMAIL_USER, to: params.to, subject: params.subject, html: htmlOut })\n      console.log(`[EmailService] Email sent to ${params.to}`)\n      return true\n    } catch (err) {\n      console.error(`[EmailService] Failed to send email to ${params.to}:`, err)\n      return false\n    }\n  }\n\n  async sendContractAwardEmail(params: ContractAwardParams) {\n    if (!this.transporter || !this.isVerified) return false\n\n    const formatNaira = (v: number) => `NGN ${new Intl.NumberFormat(\"en-NG\", { maximumFractionDigits: 0 }).format(v)}`\n    const ctaText = params.isPasswordSetup ? \"Log In\" : undefined\n    const ctaUrl = params.isPasswordSetup ? params.loginUrl : undefined\n    const credsBlock = !params.isPasswordSetup && params.loginEmail && params.tempPassword\n      ? `<div style=\"margin-top:8px\"><div style=\"font-weight:600;color:#1f2937\">Login Email: ${params.loginEmail}</div><div style=\"color:#1f2937\">Temporary Password: ${params.tempPassword}</div></div>`\n      : \"\"\n    const bodyHtml = `\n              <p style=\"margin:0 0 12px 0\">Dear ${params.companyName},</p>\n              <p style=\"margin:0 0 12px 0\">Your bid has been approved for <strong>${params.projectName}</strong>.</p>\n              <div style=\"margin:16px 0;padding:12px;border:1px solid #e5e7eb;border-radius:8px;background:#fafafa\">\n                <div style=\"margin:4px 0\"><span style=\"color:#6b7280\">Budget:</span> <span style=\"font-weight:600\">${formatNaira(params.estimatedBudget)}</span></div>\n                <div style=\"margin:4px 0\"><span style=\"color:#6b7280\">Duration:</span> <span style=\"font-weight:600\">${params.estimatedDuration} days</span></div>\n              </div>\n              ${credsBlock}\n              <p style=\"margin:16px 0\">Attached is your contract document.</p>`\n    const htmlContent = this.buildHtmlTemplate({ preheader: `Contract Award – ${params.projectName}`, title: `Contract Award Notification – ${params.projectName}`, bodyHtml, ctaText, ctaUrl })\n\n    try {\n      const attachments = params.contractPdfBuffer\n        ? [\n            {\n              filename: `Contract_Award_${params.projectName.replace(/\\s+/g, \"_\")}.pdf`,\n              content: params.contractPdfBuffer,\n              contentType: \"application/pdf\",\n            },\n          ]\n        : []\n      await this.transporter.sendMail({\n        from: process.env.SMTP_FROM || process.env.GMAIL_USER,\n        to: params.to,\n        subject: `Contract Award - ${params.projectName}`,\n        html: htmlContent,\n        attachments,\n      })\n      console.log(`[EmailService] Contract award email sent to ${params.to}`)\n      return true\n    } catch (err) {\n      console.error(`[EmailService] Failed to send contract award email to ${params.to}:`, err)\n      return false\n    }\n  }\n\n  async sendMeetingInviteEmail(params: { to: string; subject: string; html: string; icsContent: string }) {\n    if (!this.transporter || !this.isVerified) return false\n    try {\n      await this.transporter.sendMail({\n        from: process.env.SMTP_FROM || process.env.GMAIL_USER,\n        to: params.to,\n        subject: params.subject,\n        html: params.html,\n        attachments: [\n          {\n            filename: \"meeting-invite.ics\",\n            content: params.icsContent,\n            contentType: \"text/calendar; charset=utf-8; method=REQUEST\",\n          },\n        ],\n      })\n      console.log(`[EmailService] Meeting invite sent to ${params.to}`)\n      return true\n    } catch (err) {\n      console.error(`[EmailService] Failed to send meeting invite to ${params.to}:`, err)\n      return false\n    }\n  }\n\n  async sendPasswordResetEmail(email: string, name: string, resetUrl: string) {\n    if (!this.transporter || !this.isVerified) return false\n    const bodyHtml = `\n              <p style=\"margin:0 0 12px 0\">Dear ${name},</p>\n              <p style=\"margin:0 0 12px 0\">Click the button below to reset your password.</p>\n              <p style=\"margin:0 0 12px 0;color:#6b7280\">This link will expire in 24 hours.</p>`\n    const html = this.buildHtmlTemplate({ preheader: \"Password Reset\", title: \"Password Reset\", bodyHtml, ctaText: \"Reset Password\", ctaUrl: resetUrl })\n\n    try {\n      await this.transporter.sendMail({ from: process.env.SMTP_FROM || process.env.GMAIL_USER, to: email, subject: \"Password Reset Request\", html })\n      console.log(`[EmailService] Password reset email sent to ${email}`)\n      return true\n    } catch (err) {\n      console.error(`[EmailService] Failed to send password reset email to ${email}:`, err)\n      return false\n    }\n  }\n\n  async sendVerificationEmail(email: string, name: string, verifyUrl: string) {\n    if (!this.transporter || !this.isVerified) return false\n    const bodyHtml = `\n              <p style=\"margin:0 0 12px 0\">Dear ${name},</p>\n              <p style=\"margin:0 0 12px 0\">Please confirm your email address to activate your account.</p>\n              <p style=\"margin:16px 0;color:#6b7280\">This link will expire in 24 hours.</p>`\n    const html = this.buildHtmlTemplate({ preheader: \"Verify your email\", title: \"Verify your email\", bodyHtml, ctaText: \"Verify Email\", ctaUrl: verifyUrl })\n    try {\n      await this.transporter.sendMail({ from: process.env.SMTP_FROM || process.env.GMAIL_USER, to: email, subject: \"Verify your email\", html })\n      console.log(`[EmailService] Verification email sent to ${email}`)\n      return true\n    } catch (err) {\n      console.error(`[EmailService] Failed to send verification email to ${email}:`, err)\n      return false\n    }\n  }\n\n  async generateContractAwardPDF(bid: Bid, ownerName: string, projectTitle: string) {\n    const pdf = await PDFDocument.create()\n    let page = pdf.addPage([595.28, 841.89])\n    const font = await pdf.embedFont(StandardFonts.TimesRoman)\n    const margin = 40\n    const primaryColor = rgb(0.9176, 0.3451, 0.0471)\n    const textColor = rgb(0.1216, 0.1608, 0.2157)\n    const lightGray = rgb(0.4196, 0.4549, 0.5020)\n    let width = page.getSize().width\n    let height = page.getSize().height\n    let contentWidth = width - margin * 2\n    let cursorY = height - margin\n    const lineSize = 12\n    const lineGap = Math.round(lineSize * 0.3)\n\n    const newPage = () => {\n      page = pdf.addPage([595.28, 841.89])\n      width = page.getSize().width\n      height = page.getSize().height\n      contentWidth = width - margin * 2\n      cursorY = height - margin\n    }\n\n    const ensureSpace = (needed: number) => {\n      if (cursorY - needed < margin) newPage()\n    }\n\n    const drawJustifiedLine = (words: string[], size: number, color: any, justify: boolean) => {\n      ensureSpace(size + lineGap)\n      let x = margin\n      const spaceW = font.widthOfTextAtSize(\" \", size)\n      const wordWidths = words.map((w) => font.widthOfTextAtSize(w, size))\n      const totalWords = wordWidths.reduce((a, b) => a + b, 0)\n      const gaps = Math.max(words.length - 1, 0)\n      const baseTotalSpaces = gaps * spaceW\n      const remaining = contentWidth - (totalWords + baseTotalSpaces)\n      const extra = justify && gaps > 0 && remaining > 0 ? remaining / gaps : 0\n      for (let i = 0; i < words.length; i++) {\n        const w = words[i]\n        page.drawText(w, { x, y: cursorY - size, size, font, color })\n        x += wordWidths[i]\n        if (i < words.length - 1) x += spaceW + extra\n      }\n      cursorY -= size + lineGap\n    }\n\n    const wrapToLines = (t: string, size: number) => {\n      const words = String(t).split(/\\s+/).filter(Boolean)\n      const lines: string[] = []\n      let cur: string[] = []\n      let curWidth = 0\n      const spaceW = font.widthOfTextAtSize(\" \", size)\n      for (const w of words) {\n        const wWidth = font.widthOfTextAtSize(w, size)\n        const testWidth = curWidth + (cur.length ? spaceW : 0) + wWidth\n        if (testWidth <= contentWidth) {\n          cur.push(w)\n          curWidth = testWidth\n        } else {\n          if (cur.length) lines.push(cur.join(\" \"))\n          cur = [w]\n          curWidth = wWidth\n        }\n      }\n      if (cur.length) lines.push(cur.join(\" \"))\n      return lines.map((ln) => ln.trim())\n    }\n\n    const awardDate = new Date().toLocaleDateString(\"en-GB\", { day: \"2-digit\", month: \"short\", year: \"numeric\" })\n    const budgetNum = Number((bid as any).amount || 0)\n    const formatNaira = (v: number) => `NGN ${new Intl.NumberFormat(\"en-NG\", { maximumFractionDigits: 0 }).format(v)}`\n    const budgetFmt = formatNaira(budgetNum)\n    const amountInWords = (n: number) => {\n      const units = [\"zero\",\"one\",\"two\",\"three\",\"four\",\"five\",\"six\",\"seven\",\"eight\",\"nine\",\"ten\",\"eleven\",\"twelve\",\"thirteen\",\"fourteen\",\"fifteen\",\"sixteen\",\"seventeen\",\"eighteen\",\"nineteen\"]\n      const tens = [\"\", \"\", \"twenty\", \"thirty\", \"forty\", \"fifty\", \"sixty\", \"seventy\", \"eighty\", \"ninety\"]\n      const toWords = (x: number): string => {\n        if (x < 20) return units[x]\n        if (x < 100) return `${tens[Math.floor(x/10)]}${x%10 ? \"-\" + units[x%10] : \"\"}`\n        if (x < 1000) return `${units[Math.floor(x/100)]} hundred${x%100 ? \" and \" + toWords(x%100) : \"\"}`\n        if (x < 1000000) return `${toWords(Math.floor(x/1000))} thousand${x%1000 ? \" \" + toWords(x%1000) : \"\"}`\n        if (x < 1000000000) return `${toWords(Math.floor(x/1000000))} million${x%1000000 ? \" \" + toWords(x%1000000) : \"\"}`\n        return `${toWords(Math.floor(x/1000000000))} billion${x%1000000000 ? \" \" + toWords(x%1000000000) : \"\"}`\n      }\n      return toWords(Math.floor(n))\n    }\n\n    ensureSpace(22 + 10)\n    page.drawText(\"CONTRACT AWARD AGREEMENT\", { x: margin, y: cursorY - 22, size: 22, font, color: primaryColor })\n    cursorY -= 22 + 10\n    const sub = `(Issued electronically through the ${process.env.NEXT_PUBLIC_PLATFORM_NAME || \"O-BIS\"} Construction Management System)`\n    const subLines = wrapToLines(sub, 10)\n    for (let i = 0; i < subLines.length; i++) {\n      const words = subLines[i].split(/\\s+/)\n      drawJustifiedLine(words, 10, lightGray, false)\n    }\n    cursorY -= 6\n\n    try {\n      const fallback = path.join(process.cwd(), \"public\", \"icon.svg.png\")\n      const logoPath = process.env.COMPANY_LOGO_PATH || fallback\n      const fs = await import(\"fs/promises\")\n      const buf = await fs.readFile(logoPath)\n      let img\n      if (/\\.png$/i.test(logoPath)) img = await pdf.embedPng(buf)\n      else img = await pdf.embedJpg(buf)\n      const logoMargin = 20\n      const iw = 64\n      const ih = 64\n      const lx = width - logoMargin - iw\n      const ly = height - logoMargin - ih\n      page.drawImage(img, { x: lx, y: ly, width: iw, height: ih })\n    } catch {}\n\n    const templateRaw = process.env.CONTRACT_TEMPLATE_TEXT || \"Client: {{CLIENT_NAME}}\\nAuthorized Manager: {{AUTHORIZED_MANAGER}}\\nContractor: {{CONTRACTOR_NAME}}\\nRecitals: This Agreement is generated on {{AWARD_DATE}} for {{PROJECT_TITLE}}.\\nScope: The Contractor shall execute all work associated with {{PROJECT_TITLE}}.\\nContract Sum: {{CONTRACT_SUM}} ({{CONTRACT_SUM_WORDS}}).\\nDuration: {{CONTRACT_DURATION}} days.\\nPayment Terms: Based on verified milestones.\\nObligations: Maintain standards; mobilize resources; safety compliance; provide updates.\\nChange Orders: Variations must be approved in-platform.\\nTermination: For non-performance or non-compliance.\\nAcceptance: Digital acceptance is legally binding.\\nExecution: Auto-generated and binding without physical signatures.\\nAuthorized By: {{AUTHORIZED_MANAGER}}\\nAccepted By: {{CONTRACTOR_NAME}}\"\n\n    const replacements: Record<string, string> = {\n      \"{{CLIENT_NAME}}\": String(process.env.COMPANY_NAME || (bid as any).companyName || \"Client\"),\n      \"{{COMPANY_ADDRESS}}\": String(process.env.COMPANY_ADDRESS || \"\"),\n      \"{{COMPANY_EMAIL}}\": String(process.env.COMPANY_EMAIL || (bid as any).email || \"\"),\n      \"{{AUTHORIZED_MANAGER}}\": String(process.env.MANAGER_NAME || ownerName || \"Manager\"),\n      \"{{CONTRACTOR_NAME}}\": String((bid as any).bidderName || \"Contractor\"),\n      \"{{PROJECT_TITLE}}\": String(projectTitle || \"Project\"),\n      \"{{CONTRACT_SUM}}\": String(budgetFmt),\n      \"{{CONTRACT_SUM_WORDS}}\": String(amountInWords(budgetNum)),\n      \"{{CONTRACT_DURATION}}\": String((bid as any).duration || 0),\n      \"{{AWARD_DATE}}\": String(awardDate),\n      \"{{PLATFORM_NAME}}\": String(process.env.NEXT_PUBLIC_PLATFORM_NAME || \"O-BIS\"),\n    }\n\n    let templateText = templateRaw\n    for (const k of Object.keys(replacements)) {\n      templateText = templateText.split(k).join(replacements[k])\n    }\n\n    const sanitizeText = (s: string) => {\n      return s.replace(/\\u20A6/g, \"NGN \").replace(/[^\\x00-\\x7F]+/g, \"\")\n    }\n    templateText = sanitizeText(templateText)\n\n    const blocks = String(templateText).split(/\\n{2,}/)\n    for (const b of blocks) {\n      const lines = wrapToLines(sanitizeText(b), lineSize)\n      if (!lines.length) continue\n      const firstLineWords = lines[0].split(/\\s+/)\n      const firstLineHeight = lineSize + lineGap\n      if (cursorY - firstLineHeight < margin) newPage()\n      for (let i = 0; i < lines.length; i++) {\n        const words = lines[i].split(/\\s+/)\n        const justify = i < lines.length - 1\n        drawJustifiedLine(words, lineSize, textColor, justify)\n      }\n      cursorY -= Math.max(lineGap, 8)\n    }\n\n    const mName = String(process.env.MANAGER_NAME || ownerName || \"Manager\")\n    const cName = String((bid as any).bidderName || \"Contractor\")\n    const sigBlockHeight = 160\n    ensureSpace(sigBlockHeight)\n    page.drawText(\"IN WITNESS WHEREOF\", { x: margin, y: cursorY - 18, size: 18, font, color: primaryColor })\n    cursorY -= 18 + 14\n    const colW = (contentWidth - 20) / 2\n    const leftX = margin\n    const rightX = margin + colW + 20\n    page.drawText(\"Authorized By:\", { x: leftX, y: cursorY - lineSize, size: lineSize, font, color: textColor })\n    cursorY -= lineSize + lineGap\n    page.drawText(mName, { x: leftX, y: cursorY - lineSize, size: lineSize, font, color: textColor })\n    const sigYLeft = cursorY - lineSize - 6\n    page.drawRectangle({ x: leftX, y: sigYLeft, width: colW - 20, height: 1, color: lightGray })\n    cursorY = sigYLeft - 14\n    page.drawText(\"Signature\", { x: leftX, y: cursorY - 10, size: 10, font, color: lightGray })\n    const tempY = cursorY\n    cursorY = tempY + lineSize + 4\n    page.drawText(\"Accepted By:\", { x: rightX, y: tempY - lineSize, size: lineSize, font, color: textColor })\n    page.drawText(cName, { x: rightX, y: tempY - lineSize - lineSize - lineGap, size: lineSize, font, color: textColor })\n    const sigYRight = tempY - lineSize - lineSize - lineGap - 6\n    page.drawRectangle({ x: rightX, y: sigYRight, width: colW - 20, height: 1, color: lightGray })\n    page.drawText(\"Signature\", { x: rightX, y: sigYRight - 14, size: 10, font, color: lightGray })\n\n    const out = await pdf.save()\n    return Buffer.from(out)\n  }\n\n  async generateSimplePDF(_: Bid, __: string, ___: string) {\n    const pdf = await PDFDocument.create()\n    const page = pdf.addPage([595.28, 841.89])\n    const font = await pdf.embedFont(StandardFonts.Helvetica)\n    page.drawText(\"Contract Award\", { x: 40, y: page.getSize().height - 60, size: 20, font, color: rgb(0.9176, 0.3451, 0.0471) })\n    const out = await pdf.save()\n    return Buffer.from(out)\n  }\n}\n\nexport const emailService = new EmailService()\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 842, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/auth/reset.ts"],"sourcesContent":["import * as jwt from \"jsonwebtoken\"\nimport { prisma } from \"@/lib/db\"\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nexport async function issueResetToken(userId: string, expiresIn = process.env.JWT_EXPIRES_IN || \"24h\"): Promise<{ token: string; recordDate: string; recordTime: string; expiresAt: string }> {\n  const secret = process.env.JWT_SECRET || \"\"\n  if (!secret) throw new Error(\"Missing JWT_SECRET\")\n  const now = new Date()\n  const token = jwt.sign({ sub: userId, type: \"password_reset\" } as jwt.JwtPayload, secret as jwt.Secret, { expiresIn } as jwt.SignOptions)\n  const decoded = jwt.decode(token) as any\n  const expMs = decoded?.exp ? decoded.exp * 1000 : now.getTime() + 24 * 60 * 60 * 1000\n  const expiresAt = new Date(expMs).toISOString()\n  const recordDate = fmtDate(now)\n  const recordTime = fmtTime(now)\n\n  await (prisma as any).passwordResetToken.create({ data: { token, userId, issuedAt: now, expiresAt: new Date(expiresAt), used: false, recordDate, recordTime } })\n  return { token, recordDate, recordTime, expiresAt }\n}\n\nexport async function validateResetToken(token: string): Promise<{ valid: boolean; userId?: string; reason?: string }> {\n  const secret = process.env.JWT_SECRET || \"\"\n  if (!secret) return { valid: false, reason: \"Missing JWT_SECRET\" }\n  try {\n    const payload = jwt.verify(token, secret as jwt.Secret) as any\n    if (payload?.type !== \"password_reset\") return { valid: false, reason: \"Invalid token type\" }\n    const rec = await (prisma as any).passwordResetToken.findUnique({ where: { token } })\n    if (!rec) return { valid: false, reason: \"Token not found\" }\n    if (rec.used) return { valid: false, reason: \"Token already used\" }\n    if (new Date(rec.expiresAt).getTime() < Date.now()) return { valid: false, reason: \"Token expired\" }\n    return { valid: true, userId: rec.userId }\n  } catch (e: any) {\n    return { valid: false, reason: e?.message || \"Invalid token\" }\n  }\n}\n\nexport async function consumeResetToken(token: string): Promise<void> {\n  await (prisma as any).passwordResetToken.update({ where: { token }, data: { used: true } })\n}\n\nexport async function issueVerificationToken(userId: string, expiresIn = process.env.JWT_EXPIRES_IN || \"24h\"): Promise<{ token: string; recordDate: string; recordTime: string; expiresAt: string }> {\n  const secret = process.env.JWT_SECRET || \"\"\n  if (!secret) throw new Error(\"Missing JWT_SECRET\")\n  const now = new Date()\n  const token = (jwt as any).sign({ sub: userId, type: \"email_verification\" }, secret, { expiresIn })\n  const decoded: any = (jwt as any).decode(token)\n  const expMs = decoded?.exp ? decoded.exp * 1000 : now.getTime() + 24 * 60 * 60 * 1000\n  const expiresAt = new Date(expMs).toISOString()\n  const recordDate = fmtDate(now)\n  const recordTime = fmtTime(now)\n  const m = (prisma as any).emailVerificationToken\n  const alt = (prisma as any).passwordResetToken\n  if (m && typeof m.create === \"function\") {\n    await m.create({ data: { token, userId, issuedAt: now, expiresAt: new Date(expiresAt), used: false, recordDate, recordTime } })\n  } else if (alt && typeof alt.create === \"function\") {\n    await alt.create({ data: { token, userId, issuedAt: now, expiresAt: new Date(expiresAt), used: false, recordDate, recordTime } })\n  } else {\n    throw new Error(\"Verification token storage unavailable\")\n  }\n  return { token, recordDate, recordTime, expiresAt }\n}\n\nexport async function validateVerificationToken(token: string): Promise<{ valid: boolean; userId?: string; reason?: string }> {\n  const secret = process.env.JWT_SECRET || \"\"\n  if (!secret) return { valid: false, reason: \"Missing JWT_SECRET\" }\n  try {\n    const payload: any = (jwt as any).verify(token, secret)\n    if (payload?.type !== \"email_verification\") return { valid: false, reason: \"Invalid token type\" }\n    const m = (prisma as any).emailVerificationToken\n    const alt = (prisma as any).passwordResetToken\n    const rec = m && typeof m.findUnique === \"function\" ? await m.findUnique({ where: { token } }) : alt && typeof alt.findUnique === \"function\" ? await alt.findUnique({ where: { token } }) : null\n    if (!rec) return { valid: false, reason: \"Token not found\" }\n    if (rec.used) return { valid: false, reason: \"Token already used\" }\n    if (new Date(rec.expiresAt).getTime() < Date.now()) return { valid: false, reason: \"Token expired\" }\n    return { valid: true, userId: rec.userId }\n  } catch (e: any) {\n    return { valid: false, reason: e?.message || \"Invalid token\" }\n  }\n}\n\nexport async function consumeVerificationToken(token: string): Promise<void> {\n  const m = (prisma as any).emailVerificationToken\n  const alt = (prisma as any).passwordResetToken\n  if (m && typeof m.update === \"function\") {\n    await m.update({ where: { token }, data: { used: true } })\n    return\n  }\n  if (alt && typeof alt.update === \"function\") {\n    await alt.update({ where: { token }, data: { used: true } })\n    return\n  }\n  throw new Error(\"Verification token storage unavailable\")\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1082, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/file-db.ts"],"sourcesContent":["import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport type { PublicProcurementRequest, Quote, ContractorComplaint, VendorProfile, Bid, Project, Milestone, DailyReport } from \"./database-schema\"\n\nexport type StoredUser = {\n  id: string\n  name: string\n  email: string\n  role: \"manager\" | \"contractor\" | \"vendor\"\n  company?: string\n  passwordHash: string\n  createdAt: string\n  updatedAt: string\n}\n\nconst dataDir = path.join(process.cwd(), \"data\")\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nasync function ensureDir() {\n  await fs.mkdir(dataDir, { recursive: true })\n}\n\nfunction filePath(name: string) {\n  return path.join(dataDir, `${name}.json`)\n}\n\nasync function readJson<T>(name: string, defaultValue: T): Promise<T> {\n  await ensureDir()\n  const fp = filePath(name)\n  try {\n    const buf = await fs.readFile(fp, \"utf8\")\n    return JSON.parse(buf) as T\n  } catch (e: any) {\n    if (e && (e.code === \"ENOENT\" || e.code === \"ERR_MODULE_NOT_FOUND\")) {\n      await fs.writeFile(fp, JSON.stringify(defaultValue, null, 2), \"utf8\")\n      return defaultValue\n    }\n    throw e\n  }\n}\n\nasync function writeJson<T>(name: string, data: T): Promise<void> {\n  await ensureDir()\n  const fp = filePath(name)\n  await fs.writeFile(fp, JSON.stringify(data, null, 2), \"utf8\")\n}\n\nexport async function getUsers(): Promise<StoredUser[]> {\n  return readJson<StoredUser[]>(\"users\", [])\n}\n\nexport async function findUserByEmail(email: string): Promise<StoredUser | undefined> {\n  const users = await getUsers()\n  return users.find((u) => u.email.toLowerCase() === email.toLowerCase())\n}\n\nexport async function updateUserPasswordById(userId: string, newHash: string): Promise<StoredUser | undefined> {\n  const users = await getUsers()\n  const next = users.map((u) => (u.id === userId ? { ...u, passwordHash: newHash, updatedAt: new Date().toISOString() } : u))\n  await writeJson(\"users\", next)\n  return next.find((u) => u.id === userId)\n}\n\ntype ResetTokenRecord = { token: string; userId: string; issuedAt: string; expiresAt: string; used: boolean; recordDate: string; recordTime: string }\n\nexport async function getResetTokens(): Promise<ResetTokenRecord[]> {\n  return readJson<ResetTokenRecord[]>(\"reset_tokens\", [])\n}\n\nexport async function saveResetTokens(items: ResetTokenRecord[]): Promise<void> {\n  await writeJson(\"reset_tokens\", items)\n}\n\nexport async function createUser(\n  user: Omit<StoredUser, \"id\" | \"createdAt\" | \"updatedAt\">,\n): Promise<StoredUser> {\n  const users = await getUsers()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newUser: StoredUser = { ...user, id: `${Date.now()}`, createdAt: iso, updatedAt: iso } as StoredUser & { recordDate: string; recordTime: string }\n  ;(newUser as any).recordDate = fmtDate(now)\n  ;(newUser as any).recordTime = fmtTime(now)\n  await writeJson(\"users\", [newUser, ...users])\n  return newUser\n}\n\nexport function sanitizeUser(u: StoredUser) {\n  const { passwordHash, ...rest } = u\n  return rest\n}\n\ntype BasicProfile = {\n  id: string\n  userId: string\n  email: string\n  companyName?: string\n  createdAt: string\n  updatedAt: string\n}\n\nexport async function createRoleProfile(user: StoredUser): Promise<void> {\n  const now = new Date()\n  const iso = now.toISOString()\n  const profile: BasicProfile = {\n    id: `${user.role}-${Date.now()}`,\n    userId: user.id,\n    email: user.email,\n    companyName: user.company,\n    createdAt: iso,\n    updatedAt: iso,\n  }\n  ;(profile as any).recordDate = fmtDate(now)\n  ;(profile as any).recordTime = fmtTime(now)\n  if (user.role === \"vendor\") {\n    const arr = await readJson<BasicProfile[]>(\"vendor_profiles\", [])\n    await writeJson(\"vendor_profiles\", [profile, ...arr])\n    return\n  }\n  if (user.role === \"manager\") {\n    const arr = await readJson<BasicProfile[]>(\"managers\", [])\n    await writeJson(\"managers\", [profile, ...arr])\n    return\n  }\n  if (user.role === \"contractor\") {\n    const arr = await readJson<BasicProfile[]>(\"contractors\", [])\n    await writeJson(\"contractors\", [profile, ...arr])\n    return\n  }\n}\n\nexport async function getProcurements(): Promise<PublicProcurementRequest[]> {\n  return readJson<PublicProcurementRequest[]>(\"public_procurements\", [])\n}\n\nexport async function saveProcurements(items: PublicProcurementRequest[]): Promise<void> {\n  await writeJson(\"public_procurements\", items)\n}\n\nexport async function getProcurementById(id: string): Promise<PublicProcurementRequest | undefined> {\n  const arr = await getProcurements()\n  return arr.find((p) => p.id === id)\n}\n\nexport async function addQuoteToProcurement(procurementId: string, quote: Quote): Promise<PublicProcurementRequest | undefined> {\n  const arr = await getProcurements()\n  const next = arr.map((p) => {\n    if (p.id === procurementId) {\n      const updated: PublicProcurementRequest = { ...p, quotes: [...(p.quotes || []), quote], status: \"quoted\" }\n      return updated\n    }\n    return p\n  })\n  await saveProcurements(next)\n  return next.find((p) => p.id === procurementId)\n}\n\nexport async function getVendorProfiles(): Promise<VendorProfile[]> {\n  return readJson<VendorProfile[]>(\"vendor_profiles\", [])\n}\n\nexport async function saveVendorProfiles(items: VendorProfile[]): Promise<void> {\n  await writeJson(\"vendor_profiles\", items)\n}\n\nexport async function findVendorProfileById(id: string): Promise<VendorProfile | undefined> {\n  const arr = await getVendorProfiles()\n  return arr.find((v) => v.id === id)\n}\n\nexport async function createVendorProfile(profile: VendorProfile): Promise<VendorProfile> {\n  const arr = await getVendorProfiles()\n  const next = [profile, ...arr]\n  await saveVendorProfiles(next)\n  return profile\n}\n\nexport async function getComplaints(): Promise<ContractorComplaint[]> {\n  return readJson<ContractorComplaint[]>(\"contractor_complaints\", [])\n}\n\nexport async function saveComplaints(items: ContractorComplaint[]): Promise<void> {\n  await writeJson(\"contractor_complaints\", items)\n}\n\nexport async function createComplaint(input: Omit<ContractorComplaint, \"id\" | \"filedAt\">): Promise<ContractorComplaint> {\n  const arr = await getComplaints()\n  const now = new Date()\n  const iso = now.toISOString()\n  const id = `complaint-${Date.now()}`\n  const complaint: ContractorComplaint = { ...input, id, filedAt: iso }\n  ;(complaint as any).recordDate = fmtDate(now)\n  ;(complaint as any).recordTime = fmtTime(now)\n  await saveComplaints([complaint, ...arr])\n  return complaint\n}\n\nexport async function updateComplaintStatus(id: string, status: ContractorComplaint[\"status\"]): Promise<ContractorComplaint | undefined> {\n  const arr = await getComplaints()\n  const now = new Date()\n  const next = arr.map((c) => (c.id === id ? ({ ...(c as any), status, acknowledgedAt: status === \"acknowledged\" ? now.toISOString() : c.acknowledgedAt, recordDate: fmtDate(now), recordTime: fmtTime(now) }) : c))\n  await saveComplaints(next)\n  return next.find((c) => c.id === id)\n}\n\nexport async function getComplaintsByManager(managerId: string): Promise<ContractorComplaint[]> {\n  const arr = await getComplaints()\n  return arr.filter((c) => c.managerId === managerId)\n}\n\nexport async function getBids(): Promise<Bid[]> {\n  return readJson<Bid[]>(\"bids\", [])\n}\n\nexport async function saveBids(items: Bid[]): Promise<void> {\n  await writeJson(\"bids\", items)\n}\n\nexport async function getBidsByProjectId(projectId: string | number): Promise<Bid[]> {\n  const arr = await getBids()\n  return arr.filter((b) => String(b.projectId) === String(projectId))\n}\n\nexport async function getBidById(id: string): Promise<Bid | undefined> {\n  const arr = await getBids()\n  return arr.find((b) => b.id === id)\n}\n\nexport async function createBid(projectId: string | number, bid: Omit<Bid, \"id\" | \"projectId\" | \"status\" | \"submittedAt\">): Promise<Bid> {\n  const arr = await getBids()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newBid: Bid = {\n    ...bid,\n    id: `bid-${Date.now()}`,\n    projectId: String(projectId),\n    status: \"New\",\n    submittedAt: iso,\n  }\n  ;(newBid as any).recordDate = fmtDate(now)\n  ;(newBid as any).recordTime = fmtTime(now)\n  await saveBids([newBid, ...arr])\n  return newBid\n}\n\nexport async function updateBidById(id: string, updates: Partial<Bid>): Promise<Bid | undefined> {\n  const arr = await getBids()\n  const now = new Date()\n  const next = arr.map((b) => (b.id === id ? ({ ...(b as any), ...(updates as any), recordDate: fmtDate(now), recordTime: fmtTime(now) }) : b))\n  await saveBids(next)\n  return next.find((b) => b.id === id)\n}\n\nexport async function deleteBidById(id: string): Promise<void> {\n  const arr = await getBids()\n  await saveBids(arr.filter((b) => b.id !== id))\n}\n\n// ===================== Bid Invitations =====================\nexport type BidInvitationRecord = {\n  id: string\n  bidId: string\n  projectId: string | number\n  meetingTitle: string\n  date: string\n  time: string\n  googleMeetLink: string\n  message?: string\n  attendees: string[]\n  sentTo: string[]\n  createdAt: string\n  recordDate: string\n  recordTime: string\n}\n\nexport async function getBidInvitations(): Promise<BidInvitationRecord[]> {\n  return readJson<BidInvitationRecord[]>(\"bidInvitations\", [])\n}\n\nexport async function saveBidInvitations(items: BidInvitationRecord[]): Promise<void> {\n  await writeJson(\"bidInvitations\", items)\n}\n\nexport async function getBidInvitationsByBidId(bidId: string): Promise<BidInvitationRecord[]> {\n  const arr = await getBidInvitations()\n  return arr.filter((r) => r.bidId === bidId)\n}\n\nexport async function addBidInvitation(record: Omit<BidInvitationRecord, \"id\" | \"createdAt\" | \"recordDate\" | \"recordTime\">): Promise<BidInvitationRecord> {\n  const arr = await getBidInvitations()\n  const now = new Date()\n  const iso = now.toISOString()\n  const item: BidInvitationRecord = {\n    ...record,\n    id: `inv-${Date.now()}`,\n    createdAt: iso,\n    recordDate: fmtDate(now),\n    recordTime: fmtTime(now),\n  }\n  await saveBidInvitations([item, ...arr])\n  return item\n}\n\nexport async function getProjects(): Promise<Project[]> {\n  return readJson<Project[]>(\"projects\", [])\n}\n\nexport async function saveProjects(items: Project[]): Promise<void> {\n  await writeJson(\"projects\", items)\n}\n\nexport async function getProjectById(id: string | number): Promise<Project | undefined> {\n  const arr = await getProjects()\n  return arr.find((p) => String(p.id) === String(id))\n}\n\nexport async function createProject(project: Omit<Project, \"id\" | \"createdAt\">): Promise<Project> {\n  const arr = await getProjects()\n  const id = Date.now()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newProject: Project = { ...project, id, createdAt: iso }\n  ;(newProject as any).recordDate = fmtDate(now)\n  ;(newProject as any).recordTime = fmtTime(now)\n  await saveProjects([newProject, ...arr])\n  return newProject\n}\n\nexport async function updateProjectById(id: string | number, updates: Partial<Project>): Promise<Project | undefined> {\n  const arr = await getProjects()\n  const now = new Date()\n  const next = arr.map((p) => (String(p.id) === String(id) ? ({ ...(p as any), ...(updates as any), recordDate: fmtDate(now), recordTime: fmtTime(now) }) : p))\n  await saveProjects(next)\n  return next.find((p) => String(p.id) === String(id))\n}\n\n// ===================== Milestones =====================\nexport async function getMilestones(): Promise<Milestone[]> {\n  return readJson<Milestone[]>(\"milestones\", [])\n}\n\nexport async function saveMilestones(items: Milestone[]): Promise<void> {\n  await writeJson(\"milestones\", items)\n}\n\nexport async function getMilestonesByProjectId(projectId: string | number): Promise<Milestone[]> {\n  const arr = await getMilestones()\n  return arr.filter((m) => String(m.projectId) === String(projectId))\n}\n\nexport async function setProjectMilestones(projectId: string | number, items: Omit<Milestone, \"id\" | \"projectId\" | \"progress\" | \"status\">[]): Promise<Milestone[]> {\n  const existing = await getMilestones()\n  const filtered = existing.filter((m) => String(m.projectId) !== String(projectId))\n  const nowItems: Milestone[] = items.map((i) => ({\n    id: `ms-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n    projectId: String(projectId),\n    name: i.name,\n    startDate: i.startDate,\n    endDate: i.endDate,\n    weight: i.weight,\n    progress: 0,\n    status: \"Pending\" as Milestone[\"status\"],\n  }))\n  await saveMilestones([...nowItems, ...filtered])\n  return nowItems\n}\n\nexport async function updateMilestoneProgress(projectId: string | number, milestoneId: string, newProgress: number): Promise<Milestone | undefined> {\n  const arr = await getMilestones()\n  const next = arr.map((m) => {\n    if (m.id === milestoneId && String(m.projectId) === String(projectId)) {\n      const progress = Math.max(m.progress, Math.min(100, newProgress))\n      const status = (progress >= 100 ? \"Completed\" : progress > 0 ? \"In Progress\" : \"Pending\") as Milestone[\"status\"]\n      return { ...m, progress, status }\n    }\n    return m\n  })\n  await saveMilestones(next)\n  return next.find((m) => m.id === milestoneId)\n}\n\n// ===================== Daily Reports =====================\nexport async function getDailyReports(): Promise<DailyReport[]> {\n  return readJson<DailyReport[]>(\"daily_reports\", [])\n}\n\nexport async function saveDailyReports(items: DailyReport[]): Promise<void> {\n  await writeJson(\"daily_reports\", items)\n}\n\nexport async function getDailyReportsByProjectId(projectId: string | number): Promise<DailyReport[]> {\n  const arr = await getDailyReports()\n  return arr.filter((r) => String(r.projectId) === String(projectId))\n}\n\nexport async function createDailyReport(report: Omit<DailyReport, \"id\">): Promise<DailyReport> {\n  const arr = await getDailyReports()\n  const now = new Date()\n  const newReport: DailyReport = { ...report, id: `dr-${Date.now()}` }\n  ;(newReport as any).recordDate = fmtDate(now)\n  ;(newReport as any).recordTime = fmtTime(now)\n  await saveDailyReports([newReport, ...arr])\n  return newReport\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1582, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/auth/signup/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/db\"\nimport { hashPassword } from \"@/lib/auth/password\"\nimport { emailService } from \"@/lib/email-service\"\nimport { issueVerificationToken } from \"@/lib/auth/reset\"\nimport { findUserByEmail, createUser, createRoleProfile, sanitizeUser } from \"@/lib/file-db\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { name, email, password, role, company } = body\n\n    // Input validation\n    if (!name || !email || !password || !role) {\n      return NextResponse.json({ error: \"Name, email, password, and role are required\" }, { status: 400 })\n    }\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(email)) {\n      return NextResponse.json({ error: \"Invalid email format\" }, { status: 400 })\n    }\n\n    // Validate password strength\n    if (password.length < 8) {\n      return NextResponse.json({ error: \"Password must be at least 8 characters\" }, { status: 400 })\n    }\n\n    // Validate role\n    const validRoles = [\"manager\", \"vendor\", \"contractor\"]\n    if (!validRoles.includes(role)) {\n      return NextResponse.json({ error: \"Invalid role\" }, { status: 400 })\n    }\n\n    const hasDb = Boolean(process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL)\n    if (hasDb) {\n      try {\n        const existing = await prisma.user.findUnique({ where: { email } })\n        if (existing) return NextResponse.json({ error: \"Email already registered\" }, { status: 409 })\n        const passwordHash = await hashPassword(password)\n        const now = new Date()\n        const recordDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, \"0\")}-${String(now.getDate()).padStart(2, \"0\")}`\n        const recordTime = `${String(now.getHours()).padStart(2, \"0\")}:${String(now.getMinutes()).padStart(2, \"0\")}`\n        const user = await prisma.user.create({ data: { name, email, role, company, passwordHash, recordDate, recordTime } })\n        if (role === \"manager\") {\n          await prisma.manager.create({ data: { userId: user.id, company: company || null, recordDate, recordTime } })\n        } else if (role === \"contractor\") {\n          await prisma.contractor.create({ data: { userId: user.id, recordDate, recordTime } })\n        } else if (role === \"vendor\") {\n          await prisma.vendor.create({ data: { userId: user.id, company: company || null, recordDate, recordTime } })\n        }\n        try {\n          const { token } = await issueVerificationToken(user.id)\n          const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || `${new URL(request.url).origin}`\n          const verifyUrl = `${baseUrl}/verify?token=${encodeURIComponent(token)}`\n          const ok = await emailService.sendVerificationEmail(user.email, user.name, verifyUrl)\n          if (!ok) {\n            console.warn(\"Verification email not sent (email service not ready)\")\n          }\n        } catch (e) {\n          console.error(\"Failed to issue verification token or send email:\", e)\n        }\n        return NextResponse.json({ id: user.id, name: user.name, email: user.email, role: user.role, company: user.company, isVerified: (user as any).isVerified ?? false })\n      } catch {\n        // Fallback to file DB when Prisma is unreachable\n        const existing = await findUserByEmail(email)\n        if (existing) return NextResponse.json({ error: \"Email already registered\" }, { status: 409 })\n        const passwordHash = await hashPassword(password)\n        const created = await createUser({ name, email, role, company, passwordHash })\n        await createRoleProfile(created)\n        const user = sanitizeUser(created)\n        return NextResponse.json({ id: user.id, name: user.name, email: user.email, role: user.role, company: (user as any).company, isVerified: (user as any).isVerified ?? false })\n      }\n    } else {\n      const existing = await findUserByEmail(email)\n      if (existing) return NextResponse.json({ error: \"Email already registered\" }, { status: 409 })\n      const passwordHash = await hashPassword(password)\n      const created = await createUser({ name, email, role, company, passwordHash })\n      await createRoleProfile(created)\n      const user = sanitizeUser(created)\n      return NextResponse.json({ id: user.id, name: user.name, email: user.email, role: user.role, company: (user as any).company, isVerified: (user as any).isVerified ?? false })\n    }\n  } catch (error) {\n    const msg = (error as any)?.message ? String((error as any).message) : \"Internal server error\"\n    console.error(\"Sign-up error:\", msg)\n    return NextResponse.json({ error: msg }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}