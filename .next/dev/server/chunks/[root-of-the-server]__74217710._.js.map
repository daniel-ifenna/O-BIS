{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient }\n\nconst dbUrl = process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL || \"\"\n\nfunction createPrismaOrMock(): PrismaClient | any {\n  if (dbUrl) {\n    return new PrismaClient({\n      datasources: {\n        db: { url: dbUrl },\n      },\n    })\n  }\n  const warn = (op: string) => {\n    throw new Error(`Database unavailable: set DATABASE_URL before calling ${op}`)\n  }\n  return new Proxy(\n    {},\n    {\n      get(_, prop) {\n        if (prop === \"$use\") return () => {}\n        if (prop === \"$transaction\") return () => warn(\"$transaction\")\n        return () => warn(String(prop))\n      },\n    },\n  ) as PrismaClient\n}\n\nexport const prisma = globalForPrisma.prisma || createPrismaOrMock()\n\nif (!globalForPrisma.prisma) globalForPrisma.prisma = prisma\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nconst TARGET_MODELS = new Set([\n  \"User\",\n  \"Contractor\",\n  \"Vendor\",\n  \"Manager\",\n  \"Project\",\n  \"Bid\",\n  \"BidInvitation\",\n  \"ProcurementRequest\",\n  \"EscrowWalletTransaction\",\n  \"FileStorageRecord\",\n  \"PaymentRequest\",\n  \"Milestone\",\n  \"DailyReport\",\n  \"VendorQuote\",\n])\n\nif (typeof (prisma as any).$use === \"function\") (prisma as any).$use(async (params: any, next: any) => {\n  const now = new Date()\n  const date = fmtDate(now)\n  const time = fmtTime(now)\n  const modelMatches = TARGET_MODELS.has(params.model || \"\")\n  const preventDeletes = String(process.env.ALLOW_DELETE || \"\").toLowerCase() !== \"true\"\n  if (preventDeletes && (params.action === \"delete\" || params.action === \"deleteMany\")) {\n    throw new Error(\"Delete operations are disabled\")\n  }\n\n  if (modelMatches) {\n    if (params.action === \"create\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"createMany\") {\n      const data = params.args.data\n      if (Array.isArray(data)) {\n        params.args.data = data.map((item: any) => ({ ...(item || {}), recordDate: date, recordTime: time }))\n      } else {\n        params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n      }\n    } else if (params.action === \"update\" || params.action === \"upsert\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"updateMany\") {\n      const data = params.args.data\n      params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n    }\n  }\n\n  return next(params)\n})\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,MAAM,QAAQ,QAAQ,GAAG,CAAC,sBAAsB,IAAI,QAAQ,GAAG,CAAC,YAAY,IAAI;AAEhF,SAAS;IACP,IAAI,OAAO;QACT,OAAO,IAAI,6IAAY,CAAC;YACtB,aAAa;gBACX,IAAI;oBAAE,KAAK;gBAAM;YACnB;QACF;IACF;IACA,MAAM,OAAO,CAAC;QACZ,MAAM,IAAI,MAAM,CAAC,sDAAsD,EAAE,IAAI;IAC/E;IACA,OAAO,IAAI,MACT,CAAC,GACD;QACE,KAAI,CAAC,EAAE,IAAI;YACT,IAAI,SAAS,QAAQ,OAAO,KAAO;YACnC,IAAI,SAAS,gBAAgB,OAAO,IAAM,KAAK;YAC/C,OAAO,IAAM,KAAK,OAAO;QAC3B;IACF;AAEJ;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,IAAI,CAAC,gBAAgB,MAAM,EAAE,gBAAgB,MAAM,GAAG;AAEtD,SAAS,QAAQ,CAAO;IACtB,MAAM,IAAI,EAAE,WAAW;IACvB,MAAM,IAAI,OAAO,EAAE,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IAC/C,MAAM,MAAM,OAAO,EAAE,OAAO,IAAI,QAAQ,CAAC,GAAG;IAC5C,OAAO,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,KAAK;AAC3B;AAEA,SAAS,QAAQ,CAAO;IACtB,MAAM,IAAI,OAAO,EAAE,QAAQ,IAAI,QAAQ,CAAC,GAAG;IAC3C,MAAM,MAAM,OAAO,EAAE,UAAU,IAAI,QAAQ,CAAC,GAAG;IAC/C,OAAO,GAAG,EAAE,CAAC,EAAE,KAAK;AACtB;AAEA,MAAM,gBAAgB,IAAI,IAAI;IAC5B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,IAAI,OAAO,AAAC,OAAe,IAAI,KAAK,YAAY,AAAC,OAAe,IAAI,CAAC,OAAO,QAAa;IACvF,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,QAAQ;IACrB,MAAM,OAAO,QAAQ;IACrB,MAAM,eAAe,cAAc,GAAG,CAAC,OAAO,KAAK,IAAI;IACvD,MAAM,iBAAiB,OAAO,QAAQ,GAAG,CAAC,YAAY,IAAI,IAAI,WAAW,OAAO;IAChF,IAAI,kBAAkB,CAAC,OAAO,MAAM,KAAK,YAAY,OAAO,MAAM,KAAK,YAAY,GAAG;QACpF,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,cAAc;QAChB,IAAI,OAAO,MAAM,KAAK,UAAU;YAC9B,OAAO,IAAI,CAAC,IAAI,GAAG;gBAAE,GAAI,OAAO,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC;gBAAG,YAAY;gBAAM,YAAY;YAAK;QACvF,OAAO,IAAI,OAAO,MAAM,KAAK,cAAc;YACzC,MAAM,OAAO,OAAO,IAAI,CAAC,IAAI;YAC7B,IAAI,MAAM,OAAO,CAAC,OAAO;gBACvB,OAAO,IAAI,CAAC,IAAI,GAAG,KAAK,GAAG,CAAC,CAAC,OAAc,CAAC;wBAAE,GAAI,QAAQ,CAAC,CAAC;wBAAG,YAAY;wBAAM,YAAY;oBAAK,CAAC;YACrG,OAAO;gBACL,OAAO,IAAI,CAAC,IAAI,GAAG;oBAAE,GAAI,QAAQ,CAAC,CAAC;oBAAG,YAAY;oBAAM,YAAY;gBAAK;YAC3E;QACF,OAAO,IAAI,OAAO,MAAM,KAAK,YAAY,OAAO,MAAM,KAAK,UAAU;YACnE,OAAO,IAAI,CAAC,IAAI,GAAG;gBAAE,GAAI,OAAO,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC;gBAAG,YAAY;gBAAM,YAAY;YAAK;QACvF,OAAO,IAAI,OAAO,MAAM,KAAK,cAAc;YACzC,MAAM,OAAO,OAAO,IAAI,CAAC,IAAI;YAC7B,OAAO,IAAI,CAAC,IAAI,GAAG;gBAAE,GAAI,QAAQ,CAAC,CAAC;gBAAG,YAAY;gBAAM,YAAY;YAAK;QAC3E;IACF;IAEA,OAAO,KAAK;AACd"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/file-db.ts"],"sourcesContent":["import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport type { PublicProcurementRequest, Quote, ContractorComplaint, VendorProfile, Bid, Project, Milestone, DailyReport } from \"./database-schema\"\n\nexport type StoredUser = {\n  id: string\n  name: string\n  email: string\n  role: \"manager\" | \"contractor\" | \"vendor\"\n  company?: string\n  passwordHash: string\n  createdAt: string\n  updatedAt: string\n}\n\nconst dataDir = path.join(process.cwd(), \"data\")\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nasync function ensureDir() {\n  await fs.mkdir(dataDir, { recursive: true })\n}\n\nfunction filePath(name: string) {\n  return path.join(dataDir, `${name}.json`)\n}\n\nasync function readJson<T>(name: string, defaultValue: T): Promise<T> {\n  await ensureDir()\n  const fp = filePath(name)\n  try {\n    const buf = await fs.readFile(fp, \"utf8\")\n    return JSON.parse(buf) as T\n  } catch (e: any) {\n    if (e && (e.code === \"ENOENT\" || e.code === \"ERR_MODULE_NOT_FOUND\")) {\n      await fs.writeFile(fp, JSON.stringify(defaultValue, null, 2), \"utf8\")\n      return defaultValue\n    }\n    throw e\n  }\n}\n\nasync function writeJson<T>(name: string, data: T): Promise<void> {\n  await ensureDir()\n  const fp = filePath(name)\n  await fs.writeFile(fp, JSON.stringify(data, null, 2), \"utf8\")\n}\n\nexport async function getUsers(): Promise<StoredUser[]> {\n  return readJson<StoredUser[]>(\"users\", [])\n}\n\nexport async function findUserByEmail(email: string): Promise<StoredUser | undefined> {\n  const users = await getUsers()\n  return users.find((u) => u.email.toLowerCase() === email.toLowerCase())\n}\n\nexport async function updateUserPasswordById(userId: string, newHash: string): Promise<StoredUser | undefined> {\n  const users = await getUsers()\n  const next = users.map((u) => (u.id === userId ? { ...u, passwordHash: newHash, updatedAt: new Date().toISOString() } : u))\n  await writeJson(\"users\", next)\n  return next.find((u) => u.id === userId)\n}\n\ntype ResetTokenRecord = { token: string; userId: string; issuedAt: string; expiresAt: string; used: boolean; recordDate: string; recordTime: string }\n\nexport async function getResetTokens(): Promise<ResetTokenRecord[]> {\n  return readJson<ResetTokenRecord[]>(\"reset_tokens\", [])\n}\n\nexport async function saveResetTokens(items: ResetTokenRecord[]): Promise<void> {\n  await writeJson(\"reset_tokens\", items)\n}\n\nexport async function createUser(\n  user: Omit<StoredUser, \"id\" | \"createdAt\" | \"updatedAt\">,\n): Promise<StoredUser> {\n  const users = await getUsers()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newUser: StoredUser = { ...user, id: `${Date.now()}`, createdAt: iso, updatedAt: iso } as StoredUser & { recordDate: string; recordTime: string }\n  ;(newUser as any).recordDate = fmtDate(now)\n  ;(newUser as any).recordTime = fmtTime(now)\n  await writeJson(\"users\", [newUser, ...users])\n  return newUser\n}\n\nexport function sanitizeUser(u: StoredUser) {\n  const { passwordHash, ...rest } = u\n  return rest\n}\n\ntype BasicProfile = {\n  id: string\n  userId: string\n  email: string\n  companyName?: string\n  createdAt: string\n  updatedAt: string\n}\n\nexport async function createRoleProfile(user: StoredUser): Promise<void> {\n  const now = new Date()\n  const iso = now.toISOString()\n  const profile: BasicProfile = {\n    id: `${user.role}-${Date.now()}`,\n    userId: user.id,\n    email: user.email,\n    companyName: user.company,\n    createdAt: iso,\n    updatedAt: iso,\n  }\n  ;(profile as any).recordDate = fmtDate(now)\n  ;(profile as any).recordTime = fmtTime(now)\n  if (user.role === \"vendor\") {\n    const arr = await readJson<BasicProfile[]>(\"vendor_profiles\", [])\n    await writeJson(\"vendor_profiles\", [profile, ...arr])\n    return\n  }\n  if (user.role === \"manager\") {\n    const arr = await readJson<BasicProfile[]>(\"managers\", [])\n    await writeJson(\"managers\", [profile, ...arr])\n    return\n  }\n  if (user.role === \"contractor\") {\n    const arr = await readJson<BasicProfile[]>(\"contractors\", [])\n    await writeJson(\"contractors\", [profile, ...arr])\n    return\n  }\n}\n\nexport async function getProcurements(): Promise<PublicProcurementRequest[]> {\n  return readJson<PublicProcurementRequest[]>(\"public_procurements\", [])\n}\n\nexport async function saveProcurements(items: PublicProcurementRequest[]): Promise<void> {\n  await writeJson(\"public_procurements\", items)\n}\n\nexport async function getProcurementById(id: string): Promise<PublicProcurementRequest | undefined> {\n  const arr = await getProcurements()\n  return arr.find((p) => p.id === id)\n}\n\nexport async function addQuoteToProcurement(procurementId: string, quote: Quote): Promise<PublicProcurementRequest | undefined> {\n  const arr = await getProcurements()\n  const next = arr.map((p) => {\n    if (p.id === procurementId) {\n      const updated: PublicProcurementRequest = { ...p, quotes: [...(p.quotes || []), quote], status: \"quoted\" }\n      return updated\n    }\n    return p\n  })\n  await saveProcurements(next)\n  return next.find((p) => p.id === procurementId)\n}\n\nexport async function getVendorProfiles(): Promise<VendorProfile[]> {\n  return readJson<VendorProfile[]>(\"vendor_profiles\", [])\n}\n\nexport async function saveVendorProfiles(items: VendorProfile[]): Promise<void> {\n  await writeJson(\"vendor_profiles\", items)\n}\n\nexport async function findVendorProfileById(id: string): Promise<VendorProfile | undefined> {\n  const arr = await getVendorProfiles()\n  return arr.find((v) => v.id === id)\n}\n\nexport async function createVendorProfile(profile: VendorProfile): Promise<VendorProfile> {\n  const arr = await getVendorProfiles()\n  const next = [profile, ...arr]\n  await saveVendorProfiles(next)\n  return profile\n}\n\nexport async function getComplaints(): Promise<ContractorComplaint[]> {\n  return readJson<ContractorComplaint[]>(\"contractor_complaints\", [])\n}\n\nexport async function saveComplaints(items: ContractorComplaint[]): Promise<void> {\n  await writeJson(\"contractor_complaints\", items)\n}\n\nexport async function createComplaint(input: Omit<ContractorComplaint, \"id\" | \"filedAt\">): Promise<ContractorComplaint> {\n  const arr = await getComplaints()\n  const now = new Date()\n  const iso = now.toISOString()\n  const id = `complaint-${Date.now()}`\n  const complaint: ContractorComplaint = { ...input, id, filedAt: iso }\n  ;(complaint as any).recordDate = fmtDate(now)\n  ;(complaint as any).recordTime = fmtTime(now)\n  await saveComplaints([complaint, ...arr])\n  return complaint\n}\n\nexport async function updateComplaintStatus(id: string, status: ContractorComplaint[\"status\"]): Promise<ContractorComplaint | undefined> {\n  const arr = await getComplaints()\n  const now = new Date()\n  const next = arr.map((c) => (c.id === id ? ({ ...(c as any), status, acknowledgedAt: status === \"acknowledged\" ? now.toISOString() : c.acknowledgedAt, recordDate: fmtDate(now), recordTime: fmtTime(now) }) : c))\n  await saveComplaints(next)\n  return next.find((c) => c.id === id)\n}\n\nexport async function getComplaintsByManager(managerId: string): Promise<ContractorComplaint[]> {\n  const arr = await getComplaints()\n  return arr.filter((c) => c.managerId === managerId)\n}\n\nexport async function getBids(): Promise<Bid[]> {\n  return readJson<Bid[]>(\"bids\", [])\n}\n\nexport async function saveBids(items: Bid[]): Promise<void> {\n  await writeJson(\"bids\", items)\n}\n\nexport async function getBidsByProjectId(projectId: string | number): Promise<Bid[]> {\n  const arr = await getBids()\n  return arr.filter((b) => String(b.projectId) === String(projectId))\n}\n\nexport async function getBidById(id: string): Promise<Bid | undefined> {\n  const arr = await getBids()\n  return arr.find((b) => b.id === id)\n}\n\nexport async function createBid(projectId: string | number, bid: Omit<Bid, \"id\" | \"projectId\" | \"status\" | \"submittedAt\">): Promise<Bid> {\n  const arr = await getBids()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newBid: Bid = {\n    ...bid,\n    id: `bid-${Date.now()}`,\n    projectId: String(projectId),\n    status: \"New\",\n    submittedAt: iso,\n  }\n  ;(newBid as any).recordDate = fmtDate(now)\n  ;(newBid as any).recordTime = fmtTime(now)\n  await saveBids([newBid, ...arr])\n  return newBid\n}\n\nexport async function updateBidById(id: string, updates: Partial<Bid>): Promise<Bid | undefined> {\n  const arr = await getBids()\n  const now = new Date()\n  const next = arr.map((b) => (b.id === id ? ({ ...(b as any), ...(updates as any), recordDate: fmtDate(now), recordTime: fmtTime(now) }) : b))\n  await saveBids(next)\n  return next.find((b) => b.id === id)\n}\n\nexport async function deleteBidById(id: string): Promise<void> {\n  const arr = await getBids()\n  await saveBids(arr.filter((b) => b.id !== id))\n}\n\n// ===================== Bid Invitations =====================\nexport type BidInvitationRecord = {\n  id: string\n  bidId: string\n  projectId: string | number\n  meetingTitle: string\n  date: string\n  time: string\n  googleMeetLink: string\n  message?: string\n  attendees: string[]\n  sentTo: string[]\n  createdAt: string\n  recordDate: string\n  recordTime: string\n}\n\nexport async function getBidInvitations(): Promise<BidInvitationRecord[]> {\n  return readJson<BidInvitationRecord[]>(\"bidInvitations\", [])\n}\n\nexport async function saveBidInvitations(items: BidInvitationRecord[]): Promise<void> {\n  await writeJson(\"bidInvitations\", items)\n}\n\nexport async function getBidInvitationsByBidId(bidId: string): Promise<BidInvitationRecord[]> {\n  const arr = await getBidInvitations()\n  return arr.filter((r) => r.bidId === bidId)\n}\n\nexport async function addBidInvitation(record: Omit<BidInvitationRecord, \"id\" | \"createdAt\" | \"recordDate\" | \"recordTime\">): Promise<BidInvitationRecord> {\n  const arr = await getBidInvitations()\n  const now = new Date()\n  const iso = now.toISOString()\n  const item: BidInvitationRecord = {\n    ...record,\n    id: `inv-${Date.now()}`,\n    createdAt: iso,\n    recordDate: fmtDate(now),\n    recordTime: fmtTime(now),\n  }\n  await saveBidInvitations([item, ...arr])\n  return item\n}\n\nexport async function getProjects(): Promise<Project[]> {\n  return readJson<Project[]>(\"projects\", [])\n}\n\nexport async function saveProjects(items: Project[]): Promise<void> {\n  await writeJson(\"projects\", items)\n}\n\nexport async function getProjectById(id: string | number): Promise<Project | undefined> {\n  const arr = await getProjects()\n  return arr.find((p) => String(p.id) === String(id))\n}\n\nexport async function createProject(project: Omit<Project, \"id\" | \"createdAt\">): Promise<Project> {\n  const arr = await getProjects()\n  const id = Date.now()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newProject: Project = { ...project, id, createdAt: iso }\n  ;(newProject as any).recordDate = fmtDate(now)\n  ;(newProject as any).recordTime = fmtTime(now)\n  await saveProjects([newProject, ...arr])\n  return newProject\n}\n\nexport async function updateProjectById(id: string | number, updates: Partial<Project>): Promise<Project | undefined> {\n  const arr = await getProjects()\n  const now = new Date()\n  const next = arr.map((p) => (String(p.id) === String(id) ? ({ ...(p as any), ...(updates as any), recordDate: fmtDate(now), recordTime: fmtTime(now) }) : p))\n  await saveProjects(next)\n  return next.find((p) => String(p.id) === String(id))\n}\n\n// ===================== Milestones =====================\nexport async function getMilestones(): Promise<Milestone[]> {\n  return readJson<Milestone[]>(\"milestones\", [])\n}\n\nexport async function saveMilestones(items: Milestone[]): Promise<void> {\n  await writeJson(\"milestones\", items)\n}\n\nexport async function getMilestonesByProjectId(projectId: string | number): Promise<Milestone[]> {\n  const arr = await getMilestones()\n  return arr.filter((m) => String(m.projectId) === String(projectId))\n}\n\nexport async function setProjectMilestones(projectId: string | number, items: Omit<Milestone, \"id\" | \"projectId\" | \"progress\" | \"status\">[]): Promise<Milestone[]> {\n  const existing = await getMilestones()\n  const filtered = existing.filter((m) => String(m.projectId) !== String(projectId))\n  const nowItems: Milestone[] = items.map((i) => ({\n    id: `ms-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n    projectId: String(projectId),\n    name: i.name,\n    startDate: i.startDate,\n    endDate: i.endDate,\n    weight: i.weight,\n    progress: 0,\n    status: \"Pending\" as Milestone[\"status\"],\n  }))\n  await saveMilestones([...nowItems, ...filtered])\n  return nowItems\n}\n\nexport async function updateMilestoneProgress(projectId: string | number, milestoneId: string, newProgress: number): Promise<Milestone | undefined> {\n  const arr = await getMilestones()\n  const next = arr.map((m) => {\n    if (m.id === milestoneId && String(m.projectId) === String(projectId)) {\n      const progress = Math.max(m.progress, Math.min(100, newProgress))\n      const status = (progress >= 100 ? \"Completed\" : progress > 0 ? \"In Progress\" : \"Pending\") as Milestone[\"status\"]\n      return { ...m, progress, status }\n    }\n    return m\n  })\n  await saveMilestones(next)\n  return next.find((m) => m.id === milestoneId)\n}\n\n// ===================== Daily Reports =====================\nexport async function getDailyReports(): Promise<DailyReport[]> {\n  return readJson<DailyReport[]>(\"daily_reports\", [])\n}\n\nexport async function saveDailyReports(items: DailyReport[]): Promise<void> {\n  await writeJson(\"daily_reports\", items)\n}\n\nexport async function getDailyReportsByProjectId(projectId: string | number): Promise<DailyReport[]> {\n  const arr = await getDailyReports()\n  return arr.filter((r) => String(r.projectId) === String(projectId))\n}\n\nexport async function createDailyReport(report: Omit<DailyReport, \"id\">): Promise<DailyReport> {\n  const arr = await getDailyReports()\n  const now = new Date()\n  const newReport: DailyReport = { ...report, id: `dr-${Date.now()}` }\n  ;(newReport as any).recordDate = fmtDate(now)\n  ;(newReport as any).recordTime = fmtTime(now)\n  await saveDailyReports([newReport, ...arr])\n  return newReport\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 668, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/projects/%5Bid%5D/route.ts"],"sourcesContent":["import { NextResponse, NextRequest } from \"next/server\"\nimport { prisma } from \"@/lib/db\"\nimport { updateProjectById as updateProjectFile, getProjectById as getProjectFile } from \"@/lib/file-db\"\n \n\nexport async function GET(_: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const { id } = await params\n    const p = await prisma.project.findUnique({ where: { id }, include: { _count: { select: { bids: true } }, files: true } })\n    if (!p) {\n      return NextResponse.json({ error: \"Not found\" }, { status: 404 })\n    }\n    let storage: any = null\n    try { storage = (await import(\"@/lib/storage\")).createFirebaseStorageFromEnv() } catch {}\n    const docs = (async () => {\n      const pick = (cat: string) => p.files.find((f: any) => String(f.category).toLowerCase() === cat)\n      const nameFromPath = (path?: string) => {\n        if (!path) return undefined\n        const base = path.split(\"/\").pop() || \"\"\n        const idx = base.indexOf(\"-\")\n        return idx >= 0 ? base.slice(idx + 1) : base\n      }\n      const itb = pick(\"bidding_documents\")\n      const specs = pick(\"technical_proposals\")\n      const boq = pick(\"procurement_specifications\")\n      const financial = pick(\"financial_proposals\")\n      const withUrl = async (rec?: any) => {\n        if (!rec) return { name: undefined, url: undefined }\n        const name = nameFromPath(rec.path)\n        let url = rec.url\n        if (!url && rec.path && storage) {\n          try { url = await storage.getSignedUrl(rec.path, 3600) } catch { try { url = storage.getPublicUrl(rec.path) } catch {} }\n        }\n        return { name, url }\n      }\n      const itbInfo = await withUrl(itb)\n      const specsInfo = await withUrl(specs)\n      const boqInfo = await withUrl(boq)\n      const financialInfo = await withUrl(financial)\n      return {\n        itb: itbInfo.name,\n        itbUrl: itbInfo.url,\n        specs: specsInfo.name,\n        specsUrl: specsInfo.url,\n        boq: boqInfo.name,\n        boqUrl: boqInfo.url,\n        financial: financialInfo.name,\n        financialUrl: financialInfo.url,\n      }\n    })()\n    const item: any = { ...p, bids: Number((p as any)._count?.bids || 0), budget: String(p.budget ?? \"\"), documents: await docs }\n    return NextResponse.json(item)\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to load project\" }, { status: 500 })\n  }\n}\n\nexport async function PATCH(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const body = await request.json().catch(() => ({}))\n    const cleanNum = (v: any) => {\n      const s = String(v ?? \"\")\n      const n = Number(s.replace(/[^0-9.\\-]/g, \"\"))\n      return Number.isFinite(n) ? String(n) : undefined\n    }\n    const allowedStatuses = new Set([\"Published\", \"Bidding\", \"Closed\", \"Awarded\", \"In Progress\", \"Completed\"]) as Set<string>\n    const updates: any = {}\n    if (typeof body.status === \"string\" && allowedStatuses.has(body.status)) updates.status = body.status as any\n    if (typeof body.managerId === \"string\") updates.managerId = body.managerId || null\n    if (typeof body.contractorId === \"string\") updates.contractorId = body.contractorId || null\n    if (typeof body.title === \"string\") updates.title = body.title\n    if (typeof body.location === \"string\") updates.location = body.location\n    if (typeof body.budget !== \"undefined\") {\n      const b = cleanNum(body.budget)\n      updates.budget = b ?? null\n    }\n    if (typeof body.category === \"string\") updates.category = body.category\n    if (typeof body.description === \"string\") updates.description = body.description\n    if (typeof body.bidDays !== \"undefined\") updates.bidDays = body.bidDays ? Number(body.bidDays) : null\n    if (typeof body.maxBids !== \"undefined\") updates.maxBids = body.maxBids ? Number(body.maxBids) : null\n    if (typeof body.acceptedBidDays !== \"undefined\") updates.acceptedBidDays = body.acceptedBidDays ? Number(body.acceptedBidDays) : null\n\n    try {\n      const { id } = await params\n      const updated = await prisma.project.update({ where: { id }, data: updates })\n      const withCount = await prisma.project.findUnique({ where: { id }, include: { _count: { select: { bids: true } } } })\n      const item: any = { ...withCount, bids: Number((withCount as any)?._count?.bids || 0), budget: String(withCount?.budget ?? \"\") }\n      return NextResponse.json(item)\n    } catch (err: any) {\n      const { id } = await params\n      try {\n        const updated = await updateProjectFile(id, updates)\n        if (!updated) return NextResponse.json({ error: \"Failed to update project\" }, { status: 500 })\n        const item: any = { ...updated, bids: Number((updated as any).bids || 0), budget: String((updated as any).budget ?? \"\") }\n        return NextResponse.json(item)\n      } catch (e) {\n        console.error(\"PATCH /api/projects/\", id, JSON.stringify({ body, updates }), String(err?.message || err))\n        return NextResponse.json({ error: \"Failed to update project\" }, { status: 500 })\n      }\n    }\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to update project\" }, { status: 500 })\n  }\n}\n\nexport async function DELETE(_: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    ;(process.env as any).ALLOW_DELETE = \"true\"\n    const { id } = await params\n    const proj = await prisma.project.findUnique({ where: { id }, include: { paymentRequests: true } })\n    if (!proj) return NextResponse.json({ error: \"Project not found\" }, { status: 404 })\n    if (proj.status === \"Awarded\" || proj.status === \"Completed\" || proj.contractorId) {\n      return NextResponse.json({ error: \"Cannot delete awarded or completed projects\" }, { status: 409 })\n    }\n    const hasActivePayments = (proj.paymentRequests || []).some((p: any) => String(p.status) !== \"REJECTED\")\n    if (hasActivePayments) {\n      return NextResponse.json({ error: \"Cannot delete project with active payment requests\" }, { status: 409 })\n    }\n    await prisma.bidInvitation.deleteMany({ where: { projectId: id } })\n    const procurements = await prisma.procurementRequest.findMany({ where: { projectId: id }, select: { id: true } })\n    const procurementIds = procurements.map((p: { id: string }) => p.id)\n    if (procurementIds.length) {\n      await prisma.vendorQuote.deleteMany({ where: { procurementId: { in: procurementIds } } })\n    }\n    await prisma.dailyReport.deleteMany({ where: { projectId: id } })\n    await prisma.milestone.deleteMany({ where: { projectId: id } })\n    await prisma.paymentRequest.deleteMany({ where: { projectId: id } })\n    await prisma.bid.deleteMany({ where: { projectId: id } })\n    await prisma.procurementRequest.deleteMany({ where: { projectId: id } })\n    await prisma.escrowWalletTransaction.deleteMany({ where: { projectId: id } })\n    await prisma.fileStorageRecord.deleteMany({ where: { projectId: id } })\n    await prisma.project.delete({ where: { id } })\n    return NextResponse.json({ ok: true })\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to delete project\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}