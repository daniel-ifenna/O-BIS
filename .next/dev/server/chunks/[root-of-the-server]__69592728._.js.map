{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient }\n\nconst dbUrl = process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL || \"\"\n\nfunction createPrismaOrMock(): PrismaClient | any {\n  if (dbUrl) {\n    return new PrismaClient({\n      datasources: {\n        db: { url: dbUrl },\n      },\n    })\n  }\n  const warn = (op: string) => {\n    throw new Error(`Database unavailable: set DATABASE_URL before calling ${op}`)\n  }\n  return new Proxy(\n    {},\n    {\n      get(_, prop) {\n        if (prop === \"$use\") return () => {}\n        if (prop === \"$transaction\") return () => warn(\"$transaction\")\n        return () => warn(String(prop))\n      },\n    },\n  ) as PrismaClient\n}\n\nexport const prisma = globalForPrisma.prisma || createPrismaOrMock()\n\nif (!globalForPrisma.prisma) globalForPrisma.prisma = prisma\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nconst TARGET_MODELS = new Set([\n  \"User\",\n  \"Contractor\",\n  \"Vendor\",\n  \"Manager\",\n  \"Project\",\n  \"Bid\",\n  \"BidInvitation\",\n  \"ProcurementRequest\",\n  \"EscrowWalletTransaction\",\n  \"FileStorageRecord\",\n  \"PaymentRequest\",\n  \"Milestone\",\n  \"DailyReport\",\n  \"VendorQuote\",\n])\n\nif (typeof (prisma as any).$use === \"function\") (prisma as any).$use(async (params: any, next: any) => {\n  const now = new Date()\n  const date = fmtDate(now)\n  const time = fmtTime(now)\n  const modelMatches = TARGET_MODELS.has(params.model || \"\")\n  const preventDeletes = String(process.env.ALLOW_DELETE || \"\").toLowerCase() !== \"true\"\n  if (preventDeletes && (params.action === \"delete\" || params.action === \"deleteMany\")) {\n    throw new Error(\"Delete operations are disabled\")\n  }\n\n  if (modelMatches) {\n    if (params.action === \"create\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"createMany\") {\n      const data = params.args.data\n      if (Array.isArray(data)) {\n        params.args.data = data.map((item: any) => ({ ...(item || {}), recordDate: date, recordTime: time }))\n      } else {\n        params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n      }\n    } else if (params.action === \"update\" || params.action === \"upsert\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"updateMany\") {\n      const data = params.args.data\n      params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n    }\n  }\n\n  return next(params)\n})\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/procurements/public/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nexport const runtime = \"nodejs\"\nimport { prisma } from \"@/lib/db\"\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\n\nexport async function GET() {\n  try {\n    const items = await (prisma as any).procurementRequest.findMany({\n      where: { isPublic: true },\n      orderBy: { createdAt: \"desc\" },\n      include: { quotes: true },\n    })\n    const normalized = items.map((p: any) => ({\n      ...p,\n      requestedDate: p.requestedDate ? new Date(p.requestedDate).toISOString().slice(0, 10) : \"\",\n      createdAt: p.createdAt ? new Date(p.createdAt).toISOString() : \"\",\n      quotes: Array.isArray(p.quotes)\n        ? p.quotes.map((q: any) => ({\n            ...q,\n            pricePerUnit: String(q.pricePerUnit),\n            totalPrice: String(q.totalPrice),\n            deliveryDate: q.deliveryDate ? new Date(q.deliveryDate).toISOString().slice(0, 10) : \"\",\n          }))\n        : [],\n    }))\n    if (normalized.length > 0) return NextResponse.json(normalized)\n    try {\n      const fp = path.join(process.cwd(), \"data\", \"public_procurements.json\")\n      const txt = await fs.readFile(fp, \"utf8\")\n      const arr = JSON.parse(txt)\n      const mapped = (Array.isArray(arr) ? arr : []).filter((p: any) => !!p.isPublic).map((p: any) => ({\n        ...p,\n        requestedDate: p.requestedDate ? String(p.requestedDate).slice(0, 10) : \"\",\n        createdAt: p.createdAt ? String(p.createdAt) : \"\",\n        quotes: Array.isArray(p.quotes)\n          ? p.quotes.map((q: any) => ({\n              ...q,\n              pricePerUnit: String(q.pricePerUnit),\n              totalPrice: String(q.totalPrice),\n              deliveryDate: q.deliveryDate ? String(q.deliveryDate).slice(0, 10) : \"\",\n            }))\n          : [],\n      }))\n      return NextResponse.json(mapped)\n    } catch {}\n    return NextResponse.json([])\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to load procurements\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;AACA;;AAHO,MAAM,UAAU;;;;AAKhB,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM,AAAC,qHAAM,CAAS,kBAAkB,CAAC,QAAQ,CAAC;YAC9D,OAAO;gBAAE,UAAU;YAAK;YACxB,SAAS;gBAAE,WAAW;YAAO;YAC7B,SAAS;gBAAE,QAAQ;YAAK;QAC1B;QACA,MAAM,aAAa,MAAM,GAAG,CAAC,CAAC,IAAW,CAAC;gBACxC,GAAG,CAAC;gBACJ,eAAe,EAAE,aAAa,GAAG,IAAI,KAAK,EAAE,aAAa,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG,MAAM;gBACxF,WAAW,EAAE,SAAS,GAAG,IAAI,KAAK,EAAE,SAAS,EAAE,WAAW,KAAK;gBAC/D,QAAQ,MAAM,OAAO,CAAC,EAAE,MAAM,IAC1B,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;wBACxB,GAAG,CAAC;wBACJ,cAAc,OAAO,EAAE,YAAY;wBACnC,YAAY,OAAO,EAAE,UAAU;wBAC/B,cAAc,EAAE,YAAY,GAAG,IAAI,KAAK,EAAE,YAAY,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG,MAAM;oBACvF,CAAC,KACD,EAAE;YACR,CAAC;QACD,IAAI,WAAW,MAAM,GAAG,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;QACpD,IAAI;YACF,MAAM,KAAK,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ;YAC5C,MAAM,MAAM,MAAM,yGAAE,CAAC,QAAQ,CAAC,IAAI;YAClC,MAAM,MAAM,KAAK,KAAK,CAAC;YACvB,MAAM,SAAS,CAAC,MAAM,OAAO,CAAC,OAAO,MAAM,EAAE,EAAE,MAAM,CAAC,CAAC,IAAW,CAAC,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,CAAC,IAAW,CAAC;oBAC/F,GAAG,CAAC;oBACJ,eAAe,EAAE,aAAa,GAAG,OAAO,EAAE,aAAa,EAAE,KAAK,CAAC,GAAG,MAAM;oBACxE,WAAW,EAAE,SAAS,GAAG,OAAO,EAAE,SAAS,IAAI;oBAC/C,QAAQ,MAAM,OAAO,CAAC,EAAE,MAAM,IAC1B,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;4BACxB,GAAG,CAAC;4BACJ,cAAc,OAAO,EAAE,YAAY;4BACnC,YAAY,OAAO,EAAE,UAAU;4BAC/B,cAAc,EAAE,YAAY,GAAG,OAAO,EAAE,YAAY,EAAE,KAAK,CAAC,GAAG,MAAM;wBACvE,CAAC,KACD,EAAE;gBACR,CAAC;YACD,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B,EAAE,OAAM,CAAC;QACT,OAAO,gJAAY,CAAC,IAAI,CAAC,EAAE;IAC7B,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;IACnF;AACF"}}]
}