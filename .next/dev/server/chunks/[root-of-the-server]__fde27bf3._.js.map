{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/file-db.ts"],"sourcesContent":["import { promises as fs } from \"fs\"\nimport path from \"path\"\nimport type { PublicProcurementRequest, Quote, ContractorComplaint, VendorProfile, Bid, Project, Milestone, DailyReport } from \"./database-schema\"\n\nexport type StoredUser = {\n  id: string\n  name: string\n  email: string\n  role: \"manager\" | \"contractor\" | \"vendor\"\n  company?: string\n  passwordHash: string\n  createdAt: string\n  updatedAt: string\n}\n\nconst dataDir = path.join(process.cwd(), \"data\")\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nasync function ensureDir() {\n  await fs.mkdir(dataDir, { recursive: true })\n}\n\nfunction filePath(name: string) {\n  return path.join(dataDir, `${name}.json`)\n}\n\nasync function readJson<T>(name: string, defaultValue: T): Promise<T> {\n  await ensureDir()\n  const fp = filePath(name)\n  try {\n    const buf = await fs.readFile(fp, \"utf8\")\n    return JSON.parse(buf) as T\n  } catch (e: any) {\n    if (e && (e.code === \"ENOENT\" || e.code === \"ERR_MODULE_NOT_FOUND\")) {\n      await fs.writeFile(fp, JSON.stringify(defaultValue, null, 2), \"utf8\")\n      return defaultValue\n    }\n    throw e\n  }\n}\n\nasync function writeJson<T>(name: string, data: T): Promise<void> {\n  await ensureDir()\n  const fp = filePath(name)\n  await fs.writeFile(fp, JSON.stringify(data, null, 2), \"utf8\")\n}\n\nexport async function getUsers(): Promise<StoredUser[]> {\n  return readJson<StoredUser[]>(\"users\", [])\n}\n\nexport async function findUserByEmail(email: string): Promise<StoredUser | undefined> {\n  const users = await getUsers()\n  return users.find((u) => u.email.toLowerCase() === email.toLowerCase())\n}\n\nexport async function updateUserPasswordById(userId: string, newHash: string): Promise<StoredUser | undefined> {\n  const users = await getUsers()\n  const next = users.map((u) => (u.id === userId ? { ...u, passwordHash: newHash, updatedAt: new Date().toISOString() } : u))\n  await writeJson(\"users\", next)\n  return next.find((u) => u.id === userId)\n}\n\ntype ResetTokenRecord = { token: string; userId: string; issuedAt: string; expiresAt: string; used: boolean; recordDate: string; recordTime: string }\n\nexport async function getResetTokens(): Promise<ResetTokenRecord[]> {\n  return readJson<ResetTokenRecord[]>(\"reset_tokens\", [])\n}\n\nexport async function saveResetTokens(items: ResetTokenRecord[]): Promise<void> {\n  await writeJson(\"reset_tokens\", items)\n}\n\nexport async function createUser(\n  user: Omit<StoredUser, \"id\" | \"createdAt\" | \"updatedAt\">,\n): Promise<StoredUser> {\n  const users = await getUsers()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newUser: StoredUser = { ...user, id: `${Date.now()}`, createdAt: iso, updatedAt: iso } as StoredUser & { recordDate: string; recordTime: string }\n  ;(newUser as any).recordDate = fmtDate(now)\n  ;(newUser as any).recordTime = fmtTime(now)\n  await writeJson(\"users\", [newUser, ...users])\n  return newUser\n}\n\nexport function sanitizeUser(u: StoredUser) {\n  const { passwordHash, ...rest } = u\n  return rest\n}\n\ntype BasicProfile = {\n  id: string\n  userId: string\n  email: string\n  companyName?: string\n  createdAt: string\n  updatedAt: string\n}\n\nexport async function createRoleProfile(user: StoredUser): Promise<void> {\n  const now = new Date()\n  const iso = now.toISOString()\n  const profile: BasicProfile = {\n    id: `${user.role}-${Date.now()}`,\n    userId: user.id,\n    email: user.email,\n    companyName: user.company,\n    createdAt: iso,\n    updatedAt: iso,\n  }\n  ;(profile as any).recordDate = fmtDate(now)\n  ;(profile as any).recordTime = fmtTime(now)\n  if (user.role === \"vendor\") {\n    const arr = await readJson<BasicProfile[]>(\"vendor_profiles\", [])\n    await writeJson(\"vendor_profiles\", [profile, ...arr])\n    return\n  }\n  if (user.role === \"manager\") {\n    const arr = await readJson<BasicProfile[]>(\"managers\", [])\n    await writeJson(\"managers\", [profile, ...arr])\n    return\n  }\n  if (user.role === \"contractor\") {\n    const arr = await readJson<BasicProfile[]>(\"contractors\", [])\n    await writeJson(\"contractors\", [profile, ...arr])\n    return\n  }\n}\n\nexport async function getProcurements(): Promise<PublicProcurementRequest[]> {\n  return readJson<PublicProcurementRequest[]>(\"public_procurements\", [])\n}\n\nexport async function saveProcurements(items: PublicProcurementRequest[]): Promise<void> {\n  await writeJson(\"public_procurements\", items)\n}\n\nexport async function getProcurementById(id: string): Promise<PublicProcurementRequest | undefined> {\n  const arr = await getProcurements()\n  return arr.find((p) => p.id === id)\n}\n\nexport async function addQuoteToProcurement(procurementId: string, quote: Quote): Promise<PublicProcurementRequest | undefined> {\n  const arr = await getProcurements()\n  const next = arr.map((p) => {\n    if (p.id === procurementId) {\n      const updated: PublicProcurementRequest = { ...p, quotes: [...(p.quotes || []), quote], status: \"quoted\" }\n      return updated\n    }\n    return p\n  })\n  await saveProcurements(next)\n  return next.find((p) => p.id === procurementId)\n}\n\nexport async function getVendorProfiles(): Promise<VendorProfile[]> {\n  return readJson<VendorProfile[]>(\"vendor_profiles\", [])\n}\n\nexport async function saveVendorProfiles(items: VendorProfile[]): Promise<void> {\n  await writeJson(\"vendor_profiles\", items)\n}\n\nexport async function findVendorProfileById(id: string): Promise<VendorProfile | undefined> {\n  const arr = await getVendorProfiles()\n  return arr.find((v) => v.id === id)\n}\n\nexport async function createVendorProfile(profile: VendorProfile): Promise<VendorProfile> {\n  const arr = await getVendorProfiles()\n  const next = [profile, ...arr]\n  await saveVendorProfiles(next)\n  return profile\n}\n\nexport async function getComplaints(): Promise<ContractorComplaint[]> {\n  return readJson<ContractorComplaint[]>(\"contractor_complaints\", [])\n}\n\nexport async function saveComplaints(items: ContractorComplaint[]): Promise<void> {\n  await writeJson(\"contractor_complaints\", items)\n}\n\nexport async function createComplaint(input: Omit<ContractorComplaint, \"id\" | \"filedAt\">): Promise<ContractorComplaint> {\n  const arr = await getComplaints()\n  const now = new Date()\n  const iso = now.toISOString()\n  const id = `complaint-${Date.now()}`\n  const complaint: ContractorComplaint = { ...input, id, filedAt: iso }\n  ;(complaint as any).recordDate = fmtDate(now)\n  ;(complaint as any).recordTime = fmtTime(now)\n  await saveComplaints([complaint, ...arr])\n  return complaint\n}\n\nexport async function updateComplaintStatus(id: string, status: ContractorComplaint[\"status\"]): Promise<ContractorComplaint | undefined> {\n  const arr = await getComplaints()\n  const now = new Date()\n  const next = arr.map((c) => (c.id === id ? ({ ...(c as any), status, acknowledgedAt: status === \"acknowledged\" ? now.toISOString() : c.acknowledgedAt, recordDate: fmtDate(now), recordTime: fmtTime(now) }) : c))\n  await saveComplaints(next)\n  return next.find((c) => c.id === id)\n}\n\nexport async function getComplaintsByManager(managerId: string): Promise<ContractorComplaint[]> {\n  const arr = await getComplaints()\n  return arr.filter((c) => c.managerId === managerId)\n}\n\nexport async function getBids(): Promise<Bid[]> {\n  return readJson<Bid[]>(\"bids\", [])\n}\n\nexport async function saveBids(items: Bid[]): Promise<void> {\n  await writeJson(\"bids\", items)\n}\n\nexport async function getBidsByProjectId(projectId: string | number): Promise<Bid[]> {\n  const arr = await getBids()\n  return arr.filter((b) => String(b.projectId) === String(projectId))\n}\n\nexport async function getBidById(id: string): Promise<Bid | undefined> {\n  const arr = await getBids()\n  return arr.find((b) => b.id === id)\n}\n\nexport async function createBid(projectId: string | number, bid: Omit<Bid, \"id\" | \"projectId\" | \"status\" | \"submittedAt\">): Promise<Bid> {\n  const arr = await getBids()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newBid: Bid = {\n    ...bid,\n    id: `bid-${Date.now()}`,\n    projectId: String(projectId),\n    status: \"New\",\n    submittedAt: iso,\n  }\n  ;(newBid as any).recordDate = fmtDate(now)\n  ;(newBid as any).recordTime = fmtTime(now)\n  await saveBids([newBid, ...arr])\n  return newBid\n}\n\nexport async function updateBidById(id: string, updates: Partial<Bid>): Promise<Bid | undefined> {\n  const arr = await getBids()\n  const now = new Date()\n  const next = arr.map((b) => (b.id === id ? ({ ...(b as any), ...(updates as any), recordDate: fmtDate(now), recordTime: fmtTime(now) }) : b))\n  await saveBids(next)\n  return next.find((b) => b.id === id)\n}\n\nexport async function deleteBidById(id: string): Promise<void> {\n  const arr = await getBids()\n  await saveBids(arr.filter((b) => b.id !== id))\n}\n\n// ===================== Bid Invitations =====================\nexport type BidInvitationRecord = {\n  id: string\n  bidId: string\n  projectId: string | number\n  meetingTitle: string\n  date: string\n  time: string\n  googleMeetLink: string\n  message?: string\n  attendees: string[]\n  sentTo: string[]\n  createdAt: string\n  recordDate: string\n  recordTime: string\n}\n\nexport async function getBidInvitations(): Promise<BidInvitationRecord[]> {\n  return readJson<BidInvitationRecord[]>(\"bidInvitations\", [])\n}\n\nexport async function saveBidInvitations(items: BidInvitationRecord[]): Promise<void> {\n  await writeJson(\"bidInvitations\", items)\n}\n\nexport async function getBidInvitationsByBidId(bidId: string): Promise<BidInvitationRecord[]> {\n  const arr = await getBidInvitations()\n  return arr.filter((r) => r.bidId === bidId)\n}\n\nexport async function addBidInvitation(record: Omit<BidInvitationRecord, \"id\" | \"createdAt\" | \"recordDate\" | \"recordTime\">): Promise<BidInvitationRecord> {\n  const arr = await getBidInvitations()\n  const now = new Date()\n  const iso = now.toISOString()\n  const item: BidInvitationRecord = {\n    ...record,\n    id: `inv-${Date.now()}`,\n    createdAt: iso,\n    recordDate: fmtDate(now),\n    recordTime: fmtTime(now),\n  }\n  await saveBidInvitations([item, ...arr])\n  return item\n}\n\nexport async function getProjects(): Promise<Project[]> {\n  return readJson<Project[]>(\"projects\", [])\n}\n\nexport async function saveProjects(items: Project[]): Promise<void> {\n  await writeJson(\"projects\", items)\n}\n\nexport async function getProjectById(id: string | number): Promise<Project | undefined> {\n  const arr = await getProjects()\n  return arr.find((p) => String(p.id) === String(id))\n}\n\nexport async function createProject(project: Omit<Project, \"id\" | \"createdAt\">): Promise<Project> {\n  const arr = await getProjects()\n  const id = Date.now()\n  const now = new Date()\n  const iso = now.toISOString()\n  const newProject: Project = { ...project, id, createdAt: iso }\n  ;(newProject as any).recordDate = fmtDate(now)\n  ;(newProject as any).recordTime = fmtTime(now)\n  await saveProjects([newProject, ...arr])\n  return newProject\n}\n\nexport async function updateProjectById(id: string | number, updates: Partial<Project>): Promise<Project | undefined> {\n  const arr = await getProjects()\n  const now = new Date()\n  const next = arr.map((p) => (String(p.id) === String(id) ? ({ ...(p as any), ...(updates as any), recordDate: fmtDate(now), recordTime: fmtTime(now) }) : p))\n  await saveProjects(next)\n  return next.find((p) => String(p.id) === String(id))\n}\n\n// ===================== Milestones =====================\nexport async function getMilestones(): Promise<Milestone[]> {\n  return readJson<Milestone[]>(\"milestones\", [])\n}\n\nexport async function saveMilestones(items: Milestone[]): Promise<void> {\n  await writeJson(\"milestones\", items)\n}\n\nexport async function getMilestonesByProjectId(projectId: string | number): Promise<Milestone[]> {\n  const arr = await getMilestones()\n  return arr.filter((m) => String(m.projectId) === String(projectId))\n}\n\nexport async function setProjectMilestones(projectId: string | number, items: Omit<Milestone, \"id\" | \"projectId\" | \"progress\" | \"status\">[]): Promise<Milestone[]> {\n  const existing = await getMilestones()\n  const filtered = existing.filter((m) => String(m.projectId) !== String(projectId))\n  const nowItems: Milestone[] = items.map((i) => ({\n    id: `ms-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,\n    projectId: String(projectId),\n    name: i.name,\n    startDate: i.startDate,\n    endDate: i.endDate,\n    weight: i.weight,\n    progress: 0,\n    status: \"Pending\" as Milestone[\"status\"],\n  }))\n  await saveMilestones([...nowItems, ...filtered])\n  return nowItems\n}\n\nexport async function updateMilestoneProgress(projectId: string | number, milestoneId: string, newProgress: number): Promise<Milestone | undefined> {\n  const arr = await getMilestones()\n  const next = arr.map((m) => {\n    if (m.id === milestoneId && String(m.projectId) === String(projectId)) {\n      const progress = Math.max(m.progress, Math.min(100, newProgress))\n      const status = (progress >= 100 ? \"Completed\" : progress > 0 ? \"In Progress\" : \"Pending\") as Milestone[\"status\"]\n      return { ...m, progress, status }\n    }\n    return m\n  })\n  await saveMilestones(next)\n  return next.find((m) => m.id === milestoneId)\n}\n\n// ===================== Daily Reports =====================\nexport async function getDailyReports(): Promise<DailyReport[]> {\n  return readJson<DailyReport[]>(\"daily_reports\", [])\n}\n\nexport async function saveDailyReports(items: DailyReport[]): Promise<void> {\n  await writeJson(\"daily_reports\", items)\n}\n\nexport async function getDailyReportsByProjectId(projectId: string | number): Promise<DailyReport[]> {\n  const arr = await getDailyReports()\n  return arr.filter((r) => String(r.projectId) === String(projectId))\n}\n\nexport async function createDailyReport(report: Omit<DailyReport, \"id\">): Promise<DailyReport> {\n  const arr = await getDailyReports()\n  const now = new Date()\n  const newReport: DailyReport = { ...report, id: `dr-${Date.now()}` }\n  ;(newReport as any).recordDate = fmtDate(now)\n  ;(newReport as any).recordTime = fmtTime(now)\n  await saveDailyReports([newReport, ...arr])\n  return newReport\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 552, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/complaints/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { createComplaint } from \"@/lib/file-db\"\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json()\n    const required = [\"projectId\", \"contractorId\", \"contractorName\", \"managerId\", \"category\", \"subject\", \"description\", \"severity\"]\n    for (const k of required) if (!body[k]) return NextResponse.json({ error: `${k} is required` }, { status: 400 })\n    const created = await createComplaint({\n      projectId: String(body.projectId),\n      contractorId: String(body.contractorId),\n      contractorName: String(body.contractorName),\n      managerId: String(body.managerId),\n      category: body.category,\n      subject: body.subject,\n      description: body.description,\n      severity: body.severity,\n      attachments: Array.isArray(body.attachments) ? body.attachments : undefined,\n      status: \"open\",\n      acknowledgedAt: undefined,\n      acknowledgedBy: undefined,\n      resolution: undefined,\n      resolvedAt: undefined,\n      feedback: undefined,\n    })\n    return NextResponse.json(created, { status: 201 })\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to create complaint\" }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,WAAW;YAAC;YAAa;YAAgB;YAAkB;YAAa;YAAY;YAAW;YAAe;SAAW;QAC/H,KAAK,MAAM,KAAK,SAAU,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,GAAG,EAAE,YAAY,CAAC;QAAC,GAAG;YAAE,QAAQ;QAAI;QAC9G,MAAM,UAAU,MAAM,IAAA,sIAAe,EAAC;YACpC,WAAW,OAAO,KAAK,SAAS;YAChC,cAAc,OAAO,KAAK,YAAY;YACtC,gBAAgB,OAAO,KAAK,cAAc;YAC1C,WAAW,OAAO,KAAK,SAAS;YAChC,UAAU,KAAK,QAAQ;YACvB,SAAS,KAAK,OAAO;YACrB,aAAa,KAAK,WAAW;YAC7B,UAAU,KAAK,QAAQ;YACvB,aAAa,MAAM,OAAO,CAAC,KAAK,WAAW,IAAI,KAAK,WAAW,GAAG;YAClE,QAAQ;YACR,gBAAgB;YAChB,gBAAgB;YAChB,YAAY;YACZ,YAAY;YACZ,UAAU;QACZ;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS;YAAE,QAAQ;QAAI;IAClD,EAAE,OAAO,GAAG;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;AACF"}}]
}