{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient }\n\nconst dbUrl = process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL || \"\"\n\nfunction createPrismaOrMock(): PrismaClient | any {\n  if (dbUrl) {\n    return new PrismaClient({\n      datasources: {\n        db: { url: dbUrl },\n      },\n    })\n  }\n  const warn = (op: string) => {\n    throw new Error(`Database unavailable: set DATABASE_URL before calling ${op}`)\n  }\n  return new Proxy(\n    {},\n    {\n      get(_, prop) {\n        if (prop === \"$use\") return () => {}\n        if (prop === \"$transaction\") return () => warn(\"$transaction\")\n        return () => warn(String(prop))\n      },\n    },\n  ) as PrismaClient\n}\n\nexport const prisma = globalForPrisma.prisma || createPrismaOrMock()\n\nif (!globalForPrisma.prisma) globalForPrisma.prisma = prisma\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nconst TARGET_MODELS = new Set([\n  \"User\",\n  \"Contractor\",\n  \"Vendor\",\n  \"Manager\",\n  \"Project\",\n  \"Bid\",\n  \"BidInvitation\",\n  \"ProcurementRequest\",\n  \"EscrowWalletTransaction\",\n  \"FileStorageRecord\",\n  \"PaymentRequest\",\n  \"Milestone\",\n  \"DailyReport\",\n  \"VendorQuote\",\n])\n\nif (typeof (prisma as any).$use === \"function\") (prisma as any).$use(async (params: any, next: any) => {\n  const now = new Date()\n  const date = fmtDate(now)\n  const time = fmtTime(now)\n  const modelMatches = TARGET_MODELS.has(params.model || \"\")\n  const preventDeletes = String(process.env.ALLOW_DELETE || \"\").toLowerCase() !== \"true\"\n  if (preventDeletes && (params.action === \"delete\" || params.action === \"deleteMany\")) {\n    throw new Error(\"Delete operations are disabled\")\n  }\n\n  if (modelMatches) {\n    if (params.action === \"create\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"createMany\") {\n      const data = params.args.data\n      if (Array.isArray(data)) {\n        params.args.data = data.map((item: any) => ({ ...(item || {}), recordDate: date, recordTime: time }))\n      } else {\n        params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n      }\n    } else if (params.action === \"update\" || params.action === \"upsert\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"updateMany\") {\n      const data = params.args.data\n      params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n    }\n  }\n\n  return next(params)\n})\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,MAAM,QAAQ,QAAQ,GAAG,CAAC,sBAAsB,IAAI,QAAQ,GAAG,CAAC,YAAY,IAAI;AAEhF,SAAS;IACP,IAAI,OAAO;QACT,OAAO,IAAI,6IAAY,CAAC;YACtB,aAAa;gBACX,IAAI;oBAAE,KAAK;gBAAM;YACnB;QACF;IACF;IACA,MAAM,OAAO,CAAC;QACZ,MAAM,IAAI,MAAM,CAAC,sDAAsD,EAAE,IAAI;IAC/E;IACA,OAAO,IAAI,MACT,CAAC,GACD;QACE,KAAI,CAAC,EAAE,IAAI;YACT,IAAI,SAAS,QAAQ,OAAO,KAAO;YACnC,IAAI,SAAS,gBAAgB,OAAO,IAAM,KAAK;YAC/C,OAAO,IAAM,KAAK,OAAO;QAC3B;IACF;AAEJ;AAEO,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,IAAI,CAAC,gBAAgB,MAAM,EAAE,gBAAgB,MAAM,GAAG;AAEtD,SAAS,QAAQ,CAAO;IACtB,MAAM,IAAI,EAAE,WAAW;IACvB,MAAM,IAAI,OAAO,EAAE,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG;IAC/C,MAAM,MAAM,OAAO,EAAE,OAAO,IAAI,QAAQ,CAAC,GAAG;IAC5C,OAAO,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,EAAE,KAAK;AAC3B;AAEA,SAAS,QAAQ,CAAO;IACtB,MAAM,IAAI,OAAO,EAAE,QAAQ,IAAI,QAAQ,CAAC,GAAG;IAC3C,MAAM,MAAM,OAAO,EAAE,UAAU,IAAI,QAAQ,CAAC,GAAG;IAC/C,OAAO,GAAG,EAAE,CAAC,EAAE,KAAK;AACtB;AAEA,MAAM,gBAAgB,IAAI,IAAI;IAC5B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,IAAI,OAAO,AAAC,OAAe,IAAI,KAAK,YAAY,AAAC,OAAe,IAAI,CAAC,OAAO,QAAa;IACvF,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,QAAQ;IACrB,MAAM,OAAO,QAAQ;IACrB,MAAM,eAAe,cAAc,GAAG,CAAC,OAAO,KAAK,IAAI;IACvD,MAAM,iBAAiB,OAAO,QAAQ,GAAG,CAAC,YAAY,IAAI,IAAI,WAAW,OAAO;IAChF,IAAI,kBAAkB,CAAC,OAAO,MAAM,KAAK,YAAY,OAAO,MAAM,KAAK,YAAY,GAAG;QACpF,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,cAAc;QAChB,IAAI,OAAO,MAAM,KAAK,UAAU;YAC9B,OAAO,IAAI,CAAC,IAAI,GAAG;gBAAE,GAAI,OAAO,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC;gBAAG,YAAY;gBAAM,YAAY;YAAK;QACvF,OAAO,IAAI,OAAO,MAAM,KAAK,cAAc;YACzC,MAAM,OAAO,OAAO,IAAI,CAAC,IAAI;YAC7B,IAAI,MAAM,OAAO,CAAC,OAAO;gBACvB,OAAO,IAAI,CAAC,IAAI,GAAG,KAAK,GAAG,CAAC,CAAC,OAAc,CAAC;wBAAE,GAAI,QAAQ,CAAC,CAAC;wBAAG,YAAY;wBAAM,YAAY;oBAAK,CAAC;YACrG,OAAO;gBACL,OAAO,IAAI,CAAC,IAAI,GAAG;oBAAE,GAAI,QAAQ,CAAC,CAAC;oBAAG,YAAY;oBAAM,YAAY;gBAAK;YAC3E;QACF,OAAO,IAAI,OAAO,MAAM,KAAK,YAAY,OAAO,MAAM,KAAK,UAAU;YACnE,OAAO,IAAI,CAAC,IAAI,GAAG;gBAAE,GAAI,OAAO,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC;gBAAG,YAAY;gBAAM,YAAY;YAAK;QACvF,OAAO,IAAI,OAAO,MAAM,KAAK,cAAc;YACzC,MAAM,OAAO,OAAO,IAAI,CAAC,IAAI;YAC7B,OAAO,IAAI,CAAC,IAAI,GAAG;gBAAE,GAAI,QAAQ,CAAC,CAAC;gBAAG,YAAY;gBAAM,YAAY;YAAK;QAC3E;IACF;IAEA,OAAO,KAAK;AACd"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/storage.ts"],"sourcesContent":["import admin from \"firebase-admin\"\nimport type { Bucket } from \"@google-cloud/storage\"\n\nexport type StorageCategory =\n  | \"bidding-documents\"\n  | \"technical-proposals\"\n  | \"financial-proposals\"\n  | \"procurement-specifications\"\n  | \"vendor-quotations\"\n  | \"contracts\"\n  | \"progress-photos\"\n  | \"proof-of-delivery\"\n\nexport type FirebaseConfig = {\n  projectId: string\n  clientEmail: string\n  privateKey: string\n  bucket: string\n}\n\nexport type UploadOptions = {\n  category: StorageCategory\n  filename: string\n  contentType: string\n  projectId?: string\n  bidId?: string\n  procurementId?: string\n  vendorId?: string\n  userId?: string\n  cacheControl?: string\n  makePublic?: boolean\n  gzip?: boolean\n  metadata?: Record<string, string>\n}\n\nexport type UploadResult = {\n  path: string\n  size: number\n  contentType: string\n  md5Hash?: string\n  generation?: string\n  etag?: string\n  mediaLink?: string\n  publicUrl?: string\n  signedUrl?: string\n}\n\nconst allowedMime = new Set<string>([\n  \"application/pdf\",\n  \"application/msword\",\n  \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n  \"application/vnd.ms-excel\",\n  \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\",\n  \"text/csv\",\n  \"image/jpeg\",\n  \"image/png\",\n])\n\nfunction sanitize(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/[^a-z0-9_.-]+/g, \"-\")\n    .replace(/-+/g, \"-\")\n    .replace(/^-|-$|^\\.|\\.$/g, \"\")\n}\n\nfunction ts(): string {\n  return new Date().toISOString().replace(/[^0-9]/g, \"\")\n}\n\nfunction buildPath(o: UploadOptions): string {\n  const parts: string[] = [o.category]\n  if (o.projectId) parts.push(`project_${o.projectId}`)\n  if (o.bidId) parts.push(`bid_${o.bidId}`)\n  if (o.procurementId) parts.push(`proc_${o.procurementId}`)\n  if (o.vendorId) parts.push(`vendor_${o.vendorId}`)\n  if (o.userId) parts.push(`user_${o.userId}`)\n  const name = `${ts()}-${sanitize(o.filename)}`\n  parts.push(name)\n  return parts.join(\"/\")\n}\n\nclass FirebaseStorage {\n  private bucket: Bucket\n\n  constructor(cfg: FirebaseConfig) {\n    if (!admin.apps.length) {\n      admin.initializeApp({\n        credential: admin.credential.cert({\n          projectId: cfg.projectId,\n          clientEmail: cfg.clientEmail,\n          privateKey: cfg.privateKey.replace(/\\\\n/g, \"\\n\"),\n        }),\n        storageBucket: cfg.bucket,\n      })\n    }\n    this.bucket = admin.storage().bucket(cfg.bucket)\n  }\n\n  async uploadBuffer(buf: Buffer, opts: UploadOptions): Promise<UploadResult> {\n    if (!allowedMime.has(opts.contentType)) throw new Error(\"Unsupported content type\")\n    const path = buildPath(opts)\n    const file = this.bucket.file(path)\n    await file.save(buf, {\n      contentType: opts.contentType,\n      gzip: opts.gzip ?? true,\n      resumable: false,\n      metadata: { cacheControl: opts.cacheControl ?? \"public, max-age=31536000\", metadata: opts.metadata },\n    })\n    if (opts.makePublic) await file.makePublic()\n    const [meta] = await file.getMetadata()\n    const res: UploadResult = {\n      path,\n      size: Number(meta.size || 0),\n      contentType: meta.contentType || opts.contentType,\n      md5Hash: meta.md5Hash,\n      generation: meta.generation ? String(meta.generation) : undefined,\n      etag: meta.etag,\n      mediaLink: meta.mediaLink,\n      publicUrl: opts.makePublic ? this.getPublicUrl(path) : undefined,\n    }\n    return res\n  }\n\n  async uploadStream(readable: NodeJS.ReadableStream, opts: UploadOptions): Promise<UploadResult> {\n    if (!allowedMime.has(opts.contentType)) throw new Error(\"Unsupported content type\")\n    const path = buildPath(opts)\n    const file = this.bucket.file(path)\n    const ws = file.createWriteStream({\n      contentType: opts.contentType,\n      gzip: opts.gzip ?? true,\n      resumable: false,\n      metadata: { cacheControl: opts.cacheControl ?? \"public, max-age=31536000\", metadata: opts.metadata },\n    })\n    return new Promise<UploadResult>((resolve, reject) => {\n      ws.on(\"error\", reject)\n      ws.on(\"finish\", async () => {\n        try {\n          if (opts.makePublic) await file.makePublic()\n          const [meta] = await file.getMetadata()\n          resolve({\n            path,\n            size: Number(meta.size || 0),\n            contentType: meta.contentType || opts.contentType,\n            md5Hash: meta.md5Hash,\n            generation: meta.generation ? String(meta.generation) : undefined,\n            etag: meta.etag,\n            mediaLink: meta.mediaLink,\n            publicUrl: opts.makePublic ? this.getPublicUrl(path) : undefined,\n          })\n        } catch (e) {\n          reject(e)\n        }\n      })\n      readable.pipe(ws)\n    })\n  }\n\n  async getSignedUrl(path: string, expiresInSeconds: number = 3600): Promise<string> {\n    const file = this.bucket.file(path)\n    const options = { action: \"read\", expires: Date.now() + expiresInSeconds * 1000 } as any\n    const [url] = await file.getSignedUrl(options)\n    return url\n  }\n\n  getPublicUrl(path: string): string {\n    return `https://storage.googleapis.com/${this.bucket.name}/${path}`\n  }\n\n  async delete(path: string): Promise<void> {\n    const file = this.bucket.file(path)\n    await file.delete({ ignoreNotFound: true })\n  }\n\n  async exists(path: string): Promise<boolean> {\n    const file = this.bucket.file(path)\n    const [ok] = await file.exists()\n    return ok\n  }\n\n  async copy(srcPath: string, destPath: string): Promise<void> {\n    const src = this.bucket.file(srcPath)\n    const dest = this.bucket.file(destPath)\n    await src.copy(dest)\n  }\n\n  async move(srcPath: string, destPath: string): Promise<void> {\n    await this.copy(srcPath, destPath)\n    await this.delete(srcPath)\n  }\n\n  async getMetadata(path: string): Promise<Record<string, unknown>> {\n    const file = this.bucket.file(path)\n    const [meta] = await file.getMetadata()\n    return meta\n  }\n}\n\nexport function createFirebaseStorageFromEnv(): FirebaseStorage {\n  const projectId = process.env.FIREBASE_PROJECT_ID || \"\"\n  const clientEmail = process.env.FIREBASE_CLIENT_EMAIL || \"\"\n  const privateKey = (process.env.FIREBASE_PRIVATE_KEY || \"\").replace(/\\r?\\n/g, \"\\n\")\n  const bucket = process.env.FIREBASE_STORAGE_BUCKET || \"\"\n  if (!projectId || !clientEmail || !privateKey || !bucket) throw new Error(\"Missing Firebase credentials\")\n  return new FirebaseStorage({ projectId, clientEmail, privateKey, bucket })\n}\n\nexport { FirebaseStorage }\n"],"names":[],"mappings":";;;;;;AAAA;;AA+CA,MAAM,cAAc,IAAI,IAAY;IAClC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,SAAS,SAAS,IAAY;IAC5B,OAAO,KACJ,WAAW,GACX,OAAO,CAAC,kBAAkB,KAC1B,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,kBAAkB;AAC/B;AAEA,SAAS;IACP,OAAO,IAAI,OAAO,WAAW,GAAG,OAAO,CAAC,WAAW;AACrD;AAEA,SAAS,UAAU,CAAgB;IACjC,MAAM,QAAkB;QAAC,EAAE,QAAQ;KAAC;IACpC,IAAI,EAAE,SAAS,EAAE,MAAM,IAAI,CAAC,CAAC,QAAQ,EAAE,EAAE,SAAS,EAAE;IACpD,IAAI,EAAE,KAAK,EAAE,MAAM,IAAI,CAAC,CAAC,IAAI,EAAE,EAAE,KAAK,EAAE;IACxC,IAAI,EAAE,aAAa,EAAE,MAAM,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,aAAa,EAAE;IACzD,IAAI,EAAE,QAAQ,EAAE,MAAM,IAAI,CAAC,CAAC,OAAO,EAAE,EAAE,QAAQ,EAAE;IACjD,IAAI,EAAE,MAAM,EAAE,MAAM,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,MAAM,EAAE;IAC3C,MAAM,OAAO,GAAG,KAAK,CAAC,EAAE,SAAS,EAAE,QAAQ,GAAG;IAC9C,MAAM,IAAI,CAAC;IACX,OAAO,MAAM,IAAI,CAAC;AACpB;AAEA,MAAM;IACI,OAAc;IAEtB,YAAY,GAAmB,CAAE;QAC/B,IAAI,CAAC,sIAAK,CAAC,IAAI,CAAC,MAAM,EAAE;YACtB,sIAAK,CAAC,aAAa,CAAC;gBAClB,YAAY,sIAAK,CAAC,UAAU,CAAC,IAAI,CAAC;oBAChC,WAAW,IAAI,SAAS;oBACxB,aAAa,IAAI,WAAW;oBAC5B,YAAY,IAAI,UAAU,CAAC,OAAO,CAAC,QAAQ;gBAC7C;gBACA,eAAe,IAAI,MAAM;YAC3B;QACF;QACA,IAAI,CAAC,MAAM,GAAG,sIAAK,CAAC,OAAO,GAAG,MAAM,CAAC,IAAI,MAAM;IACjD;IAEA,MAAM,aAAa,GAAW,EAAE,IAAmB,EAAyB;QAC1E,IAAI,CAAC,YAAY,GAAG,CAAC,KAAK,WAAW,GAAG,MAAM,IAAI,MAAM;QACxD,MAAM,OAAO,UAAU;QACvB,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,KAAK,IAAI,CAAC,KAAK;YACnB,aAAa,KAAK,WAAW;YAC7B,MAAM,KAAK,IAAI,IAAI;YACnB,WAAW;YACX,UAAU;gBAAE,cAAc,KAAK,YAAY,IAAI;gBAA4B,UAAU,KAAK,QAAQ;YAAC;QACrG;QACA,IAAI,KAAK,UAAU,EAAE,MAAM,KAAK,UAAU;QAC1C,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,WAAW;QACrC,MAAM,MAAoB;YACxB;YACA,MAAM,OAAO,KAAK,IAAI,IAAI;YAC1B,aAAa,KAAK,WAAW,IAAI,KAAK,WAAW;YACjD,SAAS,KAAK,OAAO;YACrB,YAAY,KAAK,UAAU,GAAG,OAAO,KAAK,UAAU,IAAI;YACxD,MAAM,KAAK,IAAI;YACf,WAAW,KAAK,SAAS;YACzB,WAAW,KAAK,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ;QACzD;QACA,OAAO;IACT;IAEA,MAAM,aAAa,QAA+B,EAAE,IAAmB,EAAyB;QAC9F,IAAI,CAAC,YAAY,GAAG,CAAC,KAAK,WAAW,GAAG,MAAM,IAAI,MAAM;QACxD,MAAM,OAAO,UAAU;QACvB,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,KAAK,KAAK,iBAAiB,CAAC;YAChC,aAAa,KAAK,WAAW;YAC7B,MAAM,KAAK,IAAI,IAAI;YACnB,WAAW;YACX,UAAU;gBAAE,cAAc,KAAK,YAAY,IAAI;gBAA4B,UAAU,KAAK,QAAQ;YAAC;QACrG;QACA,OAAO,IAAI,QAAsB,CAAC,SAAS;YACzC,GAAG,EAAE,CAAC,SAAS;YACf,GAAG,EAAE,CAAC,UAAU;gBACd,IAAI;oBACF,IAAI,KAAK,UAAU,EAAE,MAAM,KAAK,UAAU;oBAC1C,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,WAAW;oBACrC,QAAQ;wBACN;wBACA,MAAM,OAAO,KAAK,IAAI,IAAI;wBAC1B,aAAa,KAAK,WAAW,IAAI,KAAK,WAAW;wBACjD,SAAS,KAAK,OAAO;wBACrB,YAAY,KAAK,UAAU,GAAG,OAAO,KAAK,UAAU,IAAI;wBACxD,MAAM,KAAK,IAAI;wBACf,WAAW,KAAK,SAAS;wBACzB,WAAW,KAAK,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ;oBACzD;gBACF,EAAE,OAAO,GAAG;oBACV,OAAO;gBACT;YACF;YACA,SAAS,IAAI,CAAC;QAChB;IACF;IAEA,MAAM,aAAa,IAAY,EAAE,mBAA2B,IAAI,EAAmB;QACjF,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,UAAU;YAAE,QAAQ;YAAQ,SAAS,KAAK,GAAG,KAAK,mBAAmB;QAAK;QAChF,MAAM,CAAC,IAAI,GAAG,MAAM,KAAK,YAAY,CAAC;QACtC,OAAO;IACT;IAEA,aAAa,IAAY,EAAU;QACjC,OAAO,CAAC,+BAA+B,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM;IACrE;IAEA,MAAM,OAAO,IAAY,EAAiB;QACxC,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,KAAK,MAAM,CAAC;YAAE,gBAAgB;QAAK;IAC3C;IAEA,MAAM,OAAO,IAAY,EAAoB;QAC3C,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,CAAC,GAAG,GAAG,MAAM,KAAK,MAAM;QAC9B,OAAO;IACT;IAEA,MAAM,KAAK,OAAe,EAAE,QAAgB,EAAiB;QAC3D,MAAM,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC7B,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,IAAI,IAAI,CAAC;IACjB;IAEA,MAAM,KAAK,OAAe,EAAE,QAAgB,EAAiB;QAC3D,MAAM,IAAI,CAAC,IAAI,CAAC,SAAS;QACzB,MAAM,IAAI,CAAC,MAAM,CAAC;IACpB;IAEA,MAAM,YAAY,IAAY,EAAoC;QAChE,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAC9B,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,WAAW;QACrC,OAAO;IACT;AACF;AAEO,SAAS;IACd,MAAM,YAAY,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IACrD,MAAM,cAAc,QAAQ,GAAG,CAAC,qBAAqB,IAAI;IACzD,MAAM,aAAa,CAAC,QAAQ,GAAG,CAAC,oBAAoB,IAAI,EAAE,EAAE,OAAO,CAAC,UAAU;IAC9E,MAAM,SAAS,QAAQ,GAAG,CAAC,uBAAuB,IAAI;IACtD,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,cAAc,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC1E,OAAO,IAAI,gBAAgB;QAAE;QAAW;QAAa;QAAY;IAAO;AAC1E"}},
    {"offset": {"line": 333, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/projects/%5Bid%5D/bids/route.ts"],"sourcesContent":["import { NextResponse, NextRequest } from \"next/server\"\nimport { prisma } from \"@/lib/db\"\nimport { createFirebaseStorageFromEnv } from \"@/lib/storage\"\n \n \n\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const body = await request.json()\n    const required = [\"bidderName\", \"companyName\", \"email\", \"amount\", \"duration\"]\n    for (const k of required) if (!body[k]) return NextResponse.json({ error: `${k} is required` }, { status: 400 })\n\n    const uploads = body.uploads || {}\n    const requireUploads = String(process.env.REQUIRE_BID_UPLOADS || \"\").toLowerCase() === \"true\"\n    const proposalDocs: unknown = uploads?.proposal\n    if (requireUploads) {\n      if (!Array.isArray(proposalDocs) || proposalDocs.length === 0) {\n        return NextResponse.json({ error: \"proposal upload is required\" }, { status: 400 })\n      }\n    }\n\n    const isUuid = (s: string) => /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(s)\n    const { id } = await params\n    let project = await prisma.project.findUnique({ where: { id } }).catch(() => null)\n    if (!project && !isUuid(id)) {\n      try {\n        const alt = await (prisma as any).project.findFirst({ where: { title: { equals: id, mode: \"insensitive\" } } })\n        if (alt) project = alt\n      } catch {}\n    }\n    if (!project) {\n      try {\n        const latest = await prisma.project.findFirst({ orderBy: { createdAt: \"desc\" } })\n        if (latest) project = latest\n      } catch {}\n    }\n    if (!project) {\n      try {\n        const { getProjectById } = await import(\"@/lib/file-db\")\n        const fileProj = await getProjectById(id)\n        if (fileProj) project = fileProj as any\n      } catch {}\n    }\n    if (!project) return NextResponse.json({ error: \"Project not found\" }, { status: 404 })\n    if ([\"Closed\", \"Awarded\", \"Completed\"].includes(project.status)) {\n      return NextResponse.json({ error: \"Bidding closed\" }, { status: 403 })\n    }\n\n    const maxBids = Number(project.maxBids || 0)\n    if (maxBids > 0) {\n      const countDb = await prisma.bid.count({ where: { projectId: id } }).catch(() => 0)\n      const currentCount = countDb\n      if (currentCount >= maxBids) {\n        return NextResponse.json({ error: \"Submission limit reached\" }, { status: 403 })\n      }\n    }\n\n    const bidDays = Number(project.bidDays || 0)\n    if (bidDays > 0 && project.createdAt) {\n      const closeDate = new Date(new Date(project.createdAt).getTime() + bidDays * 24 * 60 * 60 * 1000)\n      if (new Date() > closeDate) return NextResponse.json({ error: \"Submission window ended\" }, { status: 403 })\n    }\n\n    const rawAmount = String(body.amount)\n    const amountStr = rawAmount.replace(/[^0-9.]/g, \"\")\n    if (!amountStr || isNaN(Number(amountStr))) return NextResponse.json({ error: \"amount must be numeric\" }, { status: 400 })\n    const durationNum = Number(String(body.duration))\n    if (!Number.isFinite(durationNum) || durationNum <= 0) return NextResponse.json({ error: \"duration must be a positive number\" }, { status: 400 })\n\n    const now = new Date()\n    const y = now.getFullYear()\n    const m = String(now.getMonth() + 1).padStart(2, \"0\")\n    const d = String(now.getDate()).padStart(2, \"0\")\n    const h = String(now.getHours()).padStart(2, \"0\")\n    const min = String(now.getMinutes()).padStart(2, \"0\")\n    const recordDate = `${y}-${m}-${d}`\n    const recordTime = `${h}:${min}`\n    let contractorId: string | null = null\n    if (typeof body.contractorId === \"string\" && body.contractorId && body.contractorId !== \"public\") {\n      try {\n        const exists = await prisma.contractor.findUnique({ where: { id: body.contractorId } })\n        if (exists) contractorId = body.contractorId\n      } catch {}\n    }\n\n    const targetProjectId = (project as any)?.id || id\n    try {\n      const createdDb = await prisma.bid.create({\n        data: {\n          projectId: targetProjectId,\n          contractorId,\n          bidderName: String(body.bidderName),\n          companyName: String(body.companyName),\n          email: String(body.email),\n          phone: body.phone ? String(body.phone) : null,\n          address: body.address ? String(body.address) : null,\n          amount: String(amountStr),\n          duration: durationNum,\n          message: body.message || null,\n          status: \"New\",\n          recordDate,\n          recordTime,\n        },\n      })\n      // Persist uploads (data URLs) into storage and FileStorageRecord\n      {\n        const storage = (() => { try { return createFirebaseStorageFromEnv() } catch { return null } })()\n        const saveArray = async (label: string, category: \"technical-proposals\" | \"financial-proposals\" | \"procurement-specifications\", arr?: unknown) => {\n          if (!Array.isArray(arr)) return [] as string[]\n          const urls: string[] = []\n          for (let i = 0; i < arr.length; i++) {\n            const v = arr[i]\n            if (typeof v !== \"string\") continue\n            const m = /^data:([^;]+);base64,(.+)$/i.exec(v)\n            if (!m) continue\n            const contentType = m[1]\n            const base64 = m[2]\n            const buffer = (() => { try { return Buffer.from(base64, \"base64\") } catch { return Buffer.from(\"\") } })()\n            try {\n              if (storage) {\n                const up = await storage.uploadBuffer(buffer, {\n                  category,\n                  filename: `${label}_${i + 1}.pdf`,\n                  contentType,\n                  projectId: targetProjectId,\n                  bidId: createdDb.id,\n                  makePublic: true,\n                })\n                const publicUrl = up.publicUrl || storage.getPublicUrl(up.path)\n                await prisma.fileStorageRecord.create({\n                  data: {\n                    category: category.replace(/-/g, \"_\") as any,\n                    url: publicUrl,\n                    path: up.path,\n                    contentType: up.contentType,\n                    size: up.size,\n                    projectId: targetProjectId,\n                    bidId: createdDb.id,\n                    recordDate,\n                    recordTime,\n                  },\n                })\n                urls.push(publicUrl)\n              } else {\n                await prisma.fileStorageRecord.create({\n                  data: {\n                    category: category.replace(/-/g, \"_\") as any,\n                    url: v,\n                    path: \"\",\n                    contentType,\n                    size: buffer.length || 0,\n                    projectId: targetProjectId,\n                    bidId: createdDb.id,\n                    recordDate,\n                    recordTime,\n                  },\n                })\n                urls.push(v)\n              }\n            } catch {\n              urls.push(v)\n            }\n          }\n          return urls\n        }\n        const uploadsObj = (body.uploads || {}) as any\n        const uploadedProposal = await saveArray(\"proposal\", \"technical-proposals\", uploadsObj.proposal)\n        const uploadedProfile = await saveArray(\"profile\", \"technical-proposals\", uploadsObj.profile)\n        const uploadedSpecs = await saveArray(\"specs\", \"procurement-specifications\", uploadsObj.specs)\n        const uploadedTax = await saveArray(\"tax\", \"financial-proposals\", uploadsObj.tax)\n        const uploadedBond = await saveArray(\"bond\", \"financial-proposals\", uploadsObj.bond)\n        const uploadedAdditional = await saveArray(\"additional\", \"technical-proposals\", uploadsObj.additional)\n        ;(createdDb as any).uploads = {\n          proposal: uploadedProposal,\n          profile: uploadedProfile,\n          specs: uploadedSpecs,\n          tax: uploadedTax,\n          bond: uploadedBond,\n          additional: uploadedAdditional,\n        }\n        ;(createdDb as any).subcontractors = Array.isArray(body.subcontractors) ? body.subcontractors : []\n      }\n      try {\n        await prisma.project.update({\n          where: { id: targetProjectId },\n          data: {\n            status: ((project as any).status === \"Published\" ? \"Bidding\" : (project as any).status) as any,\n          },\n        })\n      } catch {}\n      return NextResponse.json(createdDb, { status: 201 })\n    } catch (e: any) {\n      // Fallback to file DB when Prisma is unavailable\n      try {\n        const { createBid, saveBids } = await import(\"@/lib/file-db\")\n        const createdFile = await createBid(targetProjectId, {\n          bidderName: String(body.bidderName),\n          companyName: String(body.companyName),\n          email: String(body.email),\n          phone: body.phone ? String(body.phone) : \"\",\n          address: body.address ? String(body.address) : \"\",\n          amount: String(amountStr),\n          duration: durationNum,\n          message: body.message || \"\",\n          contractorId: String(body.contractorId || \"\"),\n        } as any)\n        return NextResponse.json(createdFile, { status: 201 })\n      } catch (err) {\n        console.error(\"POST /api/projects/\", id, \"bids\", JSON.stringify({ body }), String(e?.message || e))\n        return NextResponse.json({ error: \"Failed to submit bid\" }, { status: 500 })\n      }\n    }\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to submit bid\" }, { status: 500 })\n  }\n}\n\nexport async function GET(_: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const { id } = await params\n    const storage = (() => {\n      try { return createFirebaseStorageFromEnv() } catch { return null }\n    })()\n    const items = await prisma.bid.findMany({ where: { projectId: id }, orderBy: { submittedAt: \"desc\" }, include: { files: true } })\n    const nameFromPath = (path?: string) => {\n      if (!path) return \"\"\n      const base = path.split(\"/\").pop() || \"\"\n      const idx = base.indexOf(\"-\")\n      return idx >= 0 ? base.slice(idx + 1) : base\n    }\n    const withUrl = (rec: any) => {\n      let url = rec.url\n      if (!url && rec.path && storage) {\n        try { url = storage.getPublicUrl(rec.path) } catch {}\n      }\n      return url\n    }\n    const mapped = items.map((b: any) => {\n      const uploads: Record<string, string[]> = { proposal: [], profile: [], specs: [], tax: [], bond: [], additional: [] }\n      for (const f of (b.files || [])) {\n        const name = nameFromPath(f.path).toLowerCase()\n        const url = withUrl(f)\n        if (!url) continue\n        if (name.startsWith(\"proposal\")) uploads.proposal.push(url)\n        else if (name.startsWith(\"profile\")) uploads.profile.push(url)\n        else if (name.startsWith(\"specs\")) uploads.specs.push(url)\n        else if (name.startsWith(\"tax\")) uploads.tax.push(url)\n        else if (name.startsWith(\"bond\")) uploads.bond.push(url)\n        else if (name.startsWith(\"additional\")) uploads.additional.push(url)\n      }\n      return { ...b, uploads }\n    })\n    return NextResponse.json(mapped)\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to load project bids\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}