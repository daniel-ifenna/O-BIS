{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient }\n\nconst dbUrl = process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL || \"\"\n\nfunction createPrismaOrMock(): PrismaClient | any {\n  if (dbUrl) {\n    return new PrismaClient({\n      datasources: {\n        db: { url: dbUrl },\n      },\n    })\n  }\n  const warn = (op: string) => {\n    throw new Error(`Database unavailable: set DATABASE_URL before calling ${op}`)\n  }\n  return new Proxy(\n    {},\n    {\n      get(_, prop) {\n        if (prop === \"$use\") return () => {}\n        if (prop === \"$transaction\") return () => warn(\"$transaction\")\n        return () => warn(String(prop))\n      },\n    },\n  ) as PrismaClient\n}\n\nexport const prisma = globalForPrisma.prisma || createPrismaOrMock()\n\nif (!globalForPrisma.prisma) globalForPrisma.prisma = prisma\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nconst TARGET_MODELS = new Set([\n  \"User\",\n  \"Contractor\",\n  \"Vendor\",\n  \"Manager\",\n  \"Project\",\n  \"Bid\",\n  \"BidInvitation\",\n  \"ProcurementRequest\",\n  \"EscrowWalletTransaction\",\n  \"FileStorageRecord\",\n  \"PaymentRequest\",\n  \"Milestone\",\n  \"DailyReport\",\n  \"VendorQuote\",\n])\n\nif (typeof (prisma as any).$use === \"function\") (prisma as any).$use(async (params: any, next: any) => {\n  const now = new Date()\n  const date = fmtDate(now)\n  const time = fmtTime(now)\n  const modelMatches = TARGET_MODELS.has(params.model || \"\")\n  const preventDeletes = String(process.env.ALLOW_DELETE || \"\").toLowerCase() !== \"true\"\n  if (preventDeletes && (params.action === \"delete\" || params.action === \"deleteMany\")) {\n    throw new Error(\"Delete operations are disabled\")\n  }\n\n  if (modelMatches) {\n    if (params.action === \"create\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"createMany\") {\n      const data = params.args.data\n      if (Array.isArray(data)) {\n        params.args.data = data.map((item: any) => ({ ...(item || {}), recordDate: date, recordTime: time }))\n      } else {\n        params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n      }\n    } else if (params.action === \"update\" || params.action === \"upsert\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"updateMany\") {\n      const data = params.args.data\n      params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n    }\n  }\n\n  return next(params)\n})\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 180, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/auth/jwt.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\"\n\ntype Payload = { sub: string; role: \"manager\" | \"contractor\" | \"vendor\" }\n\nexport function signToken(payload: Payload, expiresIn: string = process.env.JWT_EXPIRES_IN || \"1h\") {\n  const secret = process.env.JWT_SECRET || \"\"\n  if (!secret) throw new Error(\"Missing JWT_SECRET\")\n  return jwt.sign(payload, secret as jwt.Secret, { algorithm: \"HS256\", expiresIn } as jwt.SignOptions)\n}\n\nexport function verifyToken(token: string): Payload | null {\n  const secret = process.env.JWT_SECRET || \"\"\n  if (!secret) throw new Error(\"Missing JWT_SECRET\")\n  try {\n    return jwt.verify(token, secret) as Payload\n  } catch {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAIO,SAAS,UAAU,OAAgB,EAAE,YAAoB,QAAQ,GAAG,CAAC,cAAc,IAAI,IAAI;IAChG,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC7B,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,QAAsB;QAAE,WAAW;QAAS;IAAU;AACjF;AAEO,SAAS,YAAY,KAAa;IACvC,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU,IAAI;IACzC,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC7B,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/security/bank.ts"],"sourcesContent":["import crypto from \"crypto\"\n\nconst ALGO = \"aes-256-gcm\"\n\nfunction getKey() {\n  const keyB64 = process.env.PAYMENT_ENCRYPTION_KEY || \"\"\n  if (!keyB64) throw new Error(\"Missing PAYMENT_ENCRYPTION_KEY\")\n  const key = Buffer.from(keyB64, \"base64\")\n  if (key.length !== 32) throw new Error(\"PAYMENT_ENCRYPTION_KEY must be 32 bytes base64\")\n  return key\n}\n\nexport function encryptAccountNumber(accountNumber: string): string {\n  const key = getKey()\n  const iv = crypto.randomBytes(12)\n  const cipher = crypto.createCipheriv(ALGO, key, iv)\n  const enc = Buffer.concat([cipher.update(accountNumber, \"utf8\"), cipher.final()])\n  const tag = cipher.getAuthTag()\n  return Buffer.concat([iv, tag, enc]).toString(\"base64\")\n}\n\nexport function decryptAccountNumber(encB64: string): string {\n  const key = getKey()\n  const buf = Buffer.from(encB64, \"base64\")\n  const iv = buf.subarray(0, 12)\n  const tag = buf.subarray(12, 28)\n  const data = buf.subarray(28)\n  const decipher = crypto.createDecipheriv(ALGO, key, iv)\n  decipher.setAuthTag(tag)\n  const dec = Buffer.concat([decipher.update(data), decipher.final()])\n  return dec.toString(\"utf8\")\n}\n\nexport function maskAccountNumber(encB64: string): string {\n  try {\n    const dec = decryptAccountNumber(encB64)\n    const last4 = dec.slice(-4)\n    return `**** **** **** ${last4}`\n  } catch {\n    return \"**** **** **** ****\"\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,OAAO;AAEb,SAAS;IACP,MAAM,SAAS,QAAQ,GAAG,CAAC,sBAAsB,IAAI;IACrD,IAAI,CAAC,QAAQ,MAAM,IAAI,MAAM;IAC7B,MAAM,MAAM,OAAO,IAAI,CAAC,QAAQ;IAChC,IAAI,IAAI,MAAM,KAAK,IAAI,MAAM,IAAI,MAAM;IACvC,OAAO;AACT;AAEO,SAAS,qBAAqB,aAAqB;IACxD,MAAM,MAAM;IACZ,MAAM,KAAK,gHAAM,CAAC,WAAW,CAAC;IAC9B,MAAM,SAAS,gHAAM,CAAC,cAAc,CAAC,MAAM,KAAK;IAChD,MAAM,MAAM,OAAO,MAAM,CAAC;QAAC,OAAO,MAAM,CAAC,eAAe;QAAS,OAAO,KAAK;KAAG;IAChF,MAAM,MAAM,OAAO,UAAU;IAC7B,OAAO,OAAO,MAAM,CAAC;QAAC;QAAI;QAAK;KAAI,EAAE,QAAQ,CAAC;AAChD;AAEO,SAAS,qBAAqB,MAAc;IACjD,MAAM,MAAM;IACZ,MAAM,MAAM,OAAO,IAAI,CAAC,QAAQ;IAChC,MAAM,KAAK,IAAI,QAAQ,CAAC,GAAG;IAC3B,MAAM,MAAM,IAAI,QAAQ,CAAC,IAAI;IAC7B,MAAM,OAAO,IAAI,QAAQ,CAAC;IAC1B,MAAM,WAAW,gHAAM,CAAC,gBAAgB,CAAC,MAAM,KAAK;IACpD,SAAS,UAAU,CAAC;IACpB,MAAM,MAAM,OAAO,MAAM,CAAC;QAAC,SAAS,MAAM,CAAC;QAAO,SAAS,KAAK;KAAG;IACnE,OAAO,IAAI,QAAQ,CAAC;AACtB;AAEO,SAAS,kBAAkB,MAAc;IAC9C,IAAI;QACF,MAAM,MAAM,qBAAqB;QACjC,MAAM,QAAQ,IAAI,KAAK,CAAC,CAAC;QACzB,OAAO,CAAC,eAAe,EAAE,OAAO;IAClC,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 269, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/manager/payments/requests/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma } from \"@/lib/db\"\nimport { verifyToken } from \"@/lib/auth/jwt\"\nimport { maskAccountNumber } from \"@/lib/security/bank\"\n\nexport async function GET(request: Request) {\n  try {\n    const auth = request.headers.get(\"authorization\") || \"\"\n    const m = /^Bearer\\s+(.+)$/i.exec(auth)\n    if (!m) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    const payload = verifyToken(m[1])\n    if (!payload || payload.role !== \"manager\") return NextResponse.json({ error: \"Forbidden\" }, { status: 403 })\n    const url = new URL(request.url)\n    const status = url.searchParams.get(\"status\") as any\n    const where = status ? { status } : {}\n    const items = await prisma.paymentRequest.findMany({ where, orderBy: { requestedAt: \"desc\" }, include: { user: true } })\n    const normalized = items.map((r: any) => ({\n      id: r.id,\n      projectId: r.projectId || \"\",\n      requesterRole: r.userType as any,\n      requesterId: r.userId,\n      requesterName: (r as any).user?.name || \"\",\n      amount: String(r.amount),\n      type: r.proofUrl ? \"Delivery Confirmation\" : \"Milestone Completion\",\n      proofUrl: r.proofUrl || \"\",\n      status: r.status === \"APPROVED\" ? \"Approved\" : r.status === \"REJECTED\" ? \"Declined\" : r.status === \"PENDING\" ? \"Pending\" : String(r.status),\n      requestedAt: r.requestedAt?.toISOString?.() || (r.requestedAt as any) || \"\",\n      reviewedAt: r.reviewedAt?.toISOString?.() || undefined,\n      reviewedBy: r.reviewedBy || undefined,\n      notes: r.rejectionReason || undefined,\n      recordDate: r.recordDate || undefined,\n      recordTime: r.recordTime || undefined,\n      accountMasked: maskAccountNumber(r.accountNumberEnc),\n    }))\n    return NextResponse.json(normalized)\n  } catch (e: any) {\n    return NextResponse.json({ error: String(e?.message || \"Failed to load requests\") }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB;QACrD,MAAM,IAAI,mBAAmB,IAAI,CAAC;QAClC,IAAI,CAAC,GAAG,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;QAC1E,MAAM,UAAU,IAAA,mIAAW,EAAC,CAAC,CAAC,EAAE;QAChC,IAAI,CAAC,WAAW,QAAQ,IAAI,KAAK,WAAW,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAY,GAAG;YAAE,QAAQ;QAAI;QAC3G,MAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;QAC/B,MAAM,SAAS,IAAI,YAAY,CAAC,GAAG,CAAC;QACpC,MAAM,QAAQ,SAAS;YAAE;QAAO,IAAI,CAAC;QACrC,MAAM,QAAQ,MAAM,qHAAM,CAAC,cAAc,CAAC,QAAQ,CAAC;YAAE;YAAO,SAAS;gBAAE,aAAa;YAAO;YAAG,SAAS;gBAAE,MAAM;YAAK;QAAE;QACtH,MAAM,aAAa,MAAM,GAAG,CAAC,CAAC,IAAW,CAAC;gBACxC,IAAI,EAAE,EAAE;gBACR,WAAW,EAAE,SAAS,IAAI;gBAC1B,eAAe,EAAE,QAAQ;gBACzB,aAAa,EAAE,MAAM;gBACrB,eAAe,AAAC,EAAU,IAAI,EAAE,QAAQ;gBACxC,QAAQ,OAAO,EAAE,MAAM;gBACvB,MAAM,EAAE,QAAQ,GAAG,0BAA0B;gBAC7C,UAAU,EAAE,QAAQ,IAAI;gBACxB,QAAQ,EAAE,MAAM,KAAK,aAAa,aAAa,EAAE,MAAM,KAAK,aAAa,aAAa,EAAE,MAAM,KAAK,YAAY,YAAY,OAAO,EAAE,MAAM;gBAC1I,aAAa,EAAE,WAAW,EAAE,mBAAoB,EAAE,WAAW,IAAY;gBACzE,YAAY,EAAE,UAAU,EAAE,mBAAmB;gBAC7C,YAAY,EAAE,UAAU,IAAI;gBAC5B,OAAO,EAAE,eAAe,IAAI;gBAC5B,YAAY,EAAE,UAAU,IAAI;gBAC5B,YAAY,EAAE,UAAU,IAAI;gBAC5B,eAAe,IAAA,8IAAiB,EAAC,EAAE,gBAAgB;YACrD,CAAC;QACD,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO,GAAG,WAAW;QAA2B,GAAG;YAAE,QAAQ;QAAI;IACrG;AACF"}}]
}