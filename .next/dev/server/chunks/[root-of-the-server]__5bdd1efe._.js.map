{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient }\n\nconst dbUrl = process.env.DATABASE_URL_PGBOUNCER || process.env.DATABASE_URL || \"\"\n\nfunction createPrismaOrMock(): PrismaClient | any {\n  if (dbUrl) {\n    return new PrismaClient({\n      datasources: {\n        db: { url: dbUrl },\n      },\n    })\n  }\n  const warn = (op: string) => {\n    throw new Error(`Database unavailable: set DATABASE_URL before calling ${op}`)\n  }\n  return new Proxy(\n    {},\n    {\n      get(_, prop) {\n        if (prop === \"$use\") return () => {}\n        if (prop === \"$transaction\") return () => warn(\"$transaction\")\n        return () => warn(String(prop))\n      },\n    },\n  ) as PrismaClient\n}\n\nexport const prisma = globalForPrisma.prisma || createPrismaOrMock()\n\nif (!globalForPrisma.prisma) globalForPrisma.prisma = prisma\n\nfunction fmtDate(d: Date): string {\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, \"0\")\n  const day = String(d.getDate()).padStart(2, \"0\")\n  return `${y}-${m}-${day}`\n}\n\nfunction fmtTime(d: Date): string {\n  const h = String(d.getHours()).padStart(2, \"0\")\n  const min = String(d.getMinutes()).padStart(2, \"0\")\n  return `${h}:${min}`\n}\n\nconst TARGET_MODELS = new Set([\n  \"User\",\n  \"Contractor\",\n  \"Vendor\",\n  \"Manager\",\n  \"Project\",\n  \"Bid\",\n  \"BidInvitation\",\n  \"ProcurementRequest\",\n  \"EscrowWalletTransaction\",\n  \"FileStorageRecord\",\n  \"PaymentRequest\",\n  \"Milestone\",\n  \"DailyReport\",\n  \"VendorQuote\",\n])\n\nif (typeof (prisma as any).$use === \"function\") (prisma as any).$use(async (params: any, next: any) => {\n  const now = new Date()\n  const date = fmtDate(now)\n  const time = fmtTime(now)\n  const modelMatches = TARGET_MODELS.has(params.model || \"\")\n  const preventDeletes = String(process.env.ALLOW_DELETE || \"\").toLowerCase() !== \"true\"\n  if (preventDeletes && (params.action === \"delete\" || params.action === \"deleteMany\")) {\n    throw new Error(\"Delete operations are disabled\")\n  }\n\n  if (modelMatches) {\n    if (params.action === \"create\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"createMany\") {\n      const data = params.args.data\n      if (Array.isArray(data)) {\n        params.args.data = data.map((item: any) => ({ ...(item || {}), recordDate: date, recordTime: time }))\n      } else {\n        params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n      }\n    } else if (params.action === \"update\" || params.action === \"upsert\") {\n      params.args.data = { ...(params.args.data || {}), recordDate: date, recordTime: time }\n    } else if (params.action === \"updateMany\") {\n      const data = params.args.data\n      params.args.data = { ...(data || {}), recordDate: date, recordTime: time }\n    }\n  }\n\n  return next(params)\n})\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Downloads/constructionplatform%20%281%29/app/api/procurements/%5Bid%5D/quotes/route.ts"],"sourcesContent":["import { NextResponse, NextRequest } from \"next/server\"\nexport const runtime = \"nodejs\"\nimport { prisma } from \"@/lib/db\"\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\n\nexport async function GET(_: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const { id } = await params\n    const items = await (prisma as any).vendorQuote.findMany({ where: { procurementId: id }, orderBy: { submittedAt: \"desc\" } })\n    return NextResponse.json(items)\n  } catch (e) {\n    try {\n      const { id } = await params\n      const fp = path.join(process.cwd(), \"data\", \"public_procurements.json\")\n      const txt = await fs.readFile(fp, \"utf8\")\n      const arr = JSON.parse(txt)\n      const item = (Array.isArray(arr) ? arr : []).find((p: any) => String(p.id) === String(id))\n      const quotes = Array.isArray(item?.quotes) ? item.quotes : []\n      return NextResponse.json(quotes)\n    } catch {\n      return NextResponse.json({ error: \"Failed to load quotes\" }, { status: 500 })\n    }\n  }\n}\n\nexport async function POST(request: NextRequest, { params }: { params: Promise<{ id: string }> }) {\n  try {\n    const body = await request.json()\n    const required = [\"vendorName\", \"vendorEmail\", \"pricePerUnit\", \"deliveryDays\", \"deliveryDate\"]\n    for (const k of required) if (!body[k]) return NextResponse.json({ error: `${k} is required` }, { status: 400 })\n    const now = new Date()\n    const y = now.getFullYear()\n    const m = String(now.getMonth() + 1).padStart(2, \"0\")\n    const d = String(now.getDate()).padStart(2, \"0\")\n    const h = String(now.getHours()).padStart(2, \"0\")\n    const min = String(now.getMinutes()).padStart(2, \"0\")\n    const recordDate = `${y}-${m}-${d}`\n    const recordTime = `${h}:${min}`\n    try {\n      const { id } = await params\n      const proc = await (prisma as any).procurementRequest.findUnique({ where: { id } })\n      if (proc) {\n        const created = await (prisma as any).vendorQuote.create({\n          data: {\n            procurementId: id,\n            vendorId: body.vendorId || null,\n            vendorName: String(body.vendorName),\n            vendorEmail: String(body.vendorEmail),\n            vendorPhone: body.vendorPhone ? String(body.vendorPhone) : null,\n            pricePerUnit: String(body.pricePerUnit),\n            totalPrice: body.totalPrice ? String(body.totalPrice) : String(Number(body.pricePerUnit) * Number(body.quantity || 0)),\n            deliveryDays: Number.parseInt(String(body.deliveryDays)),\n            deliveryDate: new Date(String(body.deliveryDate)),\n            status: \"pending\",\n            proposalUrl: body.proposalUrl || null,\n            complianceScore: body.complianceScore ? Number(body.complianceScore) : null,\n            notes: body.notes || null,\n            recordDate,\n            recordTime,\n          },\n        })\n        const normalized = {\n          ...created,\n          pricePerUnit: String((created as any).pricePerUnit),\n          totalPrice: String((created as any).totalPrice),\n          deliveryDate: created.deliveryDate ? new Date(created.deliveryDate).toISOString().slice(0, 10) : \"\",\n          recordDate,\n          recordTime,\n        }\n        return NextResponse.json(normalized, { status: 201 })\n      }\n    } catch {}\n    try {\n      const { id } = await params\n      const fp = path.join(process.cwd(), \"data\", \"public_procurements.json\")\n      const txt = await fs.readFile(fp, \"utf8\")\n      const arr = JSON.parse(txt)\n      const idx = (Array.isArray(arr) ? arr : []).findIndex((p: any) => String(p.id) === String(id))\n      if (idx < 0) return NextResponse.json({ error: \"Procurement not found\" }, { status: 404 })\n      const created = {\n        id: `vq-${Date.now()}`,\n        procurementId: id,\n        vendorId: body.vendorId || null,\n        vendorName: String(body.vendorName),\n        vendorEmail: String(body.vendorEmail),\n        vendorPhone: body.vendorPhone ? String(body.vendorPhone) : null,\n        pricePerUnit: String(body.pricePerUnit),\n        totalPrice: body.totalPrice ? String(body.totalPrice) : String(Number(body.pricePerUnit) * Number(body.quantity || 0)),\n        deliveryDays: Number.parseInt(String(body.deliveryDays)),\n        deliveryDate: String(body.deliveryDate),\n        status: \"pending\",\n        proposalUrl: body.proposalUrl || null,\n        complianceScore: body.complianceScore ? Number(body.complianceScore) : null,\n        notes: body.notes || null,\n        submittedAt: now.toISOString(),\n        recordDate,\n        recordTime,\n      }\n      const currentQuotes = Array.isArray(arr[idx].quotes) ? arr[idx].quotes : []\n      arr[idx].quotes = [created, ...currentQuotes]\n      await fs.writeFile(fp, JSON.stringify(arr, null, 2), \"utf8\")\n      const normalized = {\n        ...created,\n        deliveryDate: new Date(String(body.deliveryDate)).toISOString().slice(0, 10),\n      }\n      return NextResponse.json(normalized, { status: 201 })\n    } catch {\n      return NextResponse.json({ error: \"Failed to submit quote\" }, { status: 500 })\n    }\n  } catch (e) {\n    return NextResponse.json({ error: \"Failed to submit quote\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}